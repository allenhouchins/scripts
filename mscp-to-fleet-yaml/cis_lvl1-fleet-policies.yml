# Fleet policies for macOS 26.0: Security Configuration - CIS Apple macOS 26.0 Tahoe v1.0.0 Benchmark (Level 1) - DRAFT
# Generated from macOS Security Compliance Project

apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files to Not Contain Access Control Lists
  platforms: macOS
  platform: darwin
  description: 'The audit log files MUST not contain access control lists (ACLs).

    This rule ensures that audit information and audit files are configured to be readable and writable only by system administrators, thereby preventing unauthorized access, modification, and deletion of files.'
  resolution: /bin/chmod -RN /var/audit
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folder to Not Contain Access Control Lists
  platforms: macOS
  platform: darwin
  description: 'The audit log folder MUST not contain access control lists (ACLs).

    Audit logs contain sensitive data about the system and users. This rule ensures that the audit service is configured to create log folders that are readable and writable only by system administrators in order to prevent normal users from reading audit logs.'
  resolution: /bin/chmod -N /var/audit
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Security Auditing
  platforms: macOS
  platform: darwin
  description: 'The information system MUST be configured to generate audit records.

    Audit records establish what types of events have occurred, when they occurred, and which users were involved. These records aid an organization in their efforts to establish, correlate, and investigate the events leading up to an outage or attack.

    The content required to be captured in an audit record varies based on the impact level of an organization''s system. Content that may be necessary to satisfy this requirement includes, for example, time stamps, source addresses, destination addresses, user identifiers, event descriptions, success/fail indications, filenames involved, and access or flow control rules invoked.

    The information system initiates session audits at system start-up.

    NOTE: Security auditing is NOT enabled by default on macOS Tahoe.'
  resolution: 'if [[ ! -e /etc/security/auditcontrol ]] && [[ -e /etc/security/auditcontrol.example ]];then

    /bin/cp /etc/security/auditcontrol.example /etc/security/auditcontrol

    fi

    /bin/launchctl enable system/com.apple.auditd

    /bin/launchctl bootstrap system /System/Library/LaunchDaemons/com.apple.auditd.plist

    /usr/sbin/audit -i'
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control to Not Contain Access Control Lists
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ not contain Access Control Lists (ACLs).
  resolution: /bin/chmod -N /etc/security/audit_control
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control Group to Wheel
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ have the group set to wheel.
  resolution: /usr/bin/chgrp wheel /etc/security/audit_control
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control Owner to Mode 440 or Less Permissive
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ be configured so that it is readable only by the root user and group wheel.
  resolution: /bin/chmod 440 /etc/security/audit_control
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control Owner to Root
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ have the owner set to root.
  resolution: /usr/sbin/chown root /etc/security/audit_control
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files Group to Wheel
  platforms: macOS
  platform: darwin
  description: 'Audit log files MUST have the group set to wheel.

    The audit service MUST be configured to create log files with the correct group ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log files are set to be readable and writable only by system administrators, the risk is mitigated.'
  resolution: /usr/bin/chgrp -R wheel /var/audit/*
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files to Mode 440 or Less Permissive
  platforms: macOS
  platform: darwin
  description: The audit service MUST be configured to create log files that are readable only by the root user and group wheel. To achieve this, audit log files MUST be configured to mode 440 or less permissive; thereby preventing normal users from reading, modifying or deleting audit logs.
  resolution: /bin/chmod 440 /var/audit/*
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files to be Owned by Root
  platforms: macOS
  platform: darwin
  description: 'Audit log files MUST be owned by root.

    The audit service MUST be configured to create log files with the correct ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log files are set to only be readable and writable by system administrators, the risk is mitigated.'
  resolution: /usr/sbin/chown -R root /var/audit/*
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folders Group to Wheel
  platforms: macOS
  platform: darwin
  description: 'Audit log files MUST have the group set to wheel.

    The audit service MUST be configured to create log files with the correct group ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log files are set to be readable and writable only by system administrators, the risk is mitigated.'
  resolution: /usr/bin/chgrp wheel /var/audit
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folders to be Owned by Root
  platforms: macOS
  platform: darwin
  description: 'Audit log folders MUST be owned by root.

    The audit service MUST be configured to create log folders with the correct ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log folders are set to only be readable and writable by system administrators, the risk is mitigated.'
  resolution: /usr/sbin/chown root /var/audit
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folders to Mode 700 or Less Permissive
  platforms: macOS
  platform: darwin
  description: 'The audit log folder MUST be configured to mode 700 or less permissive so that only the root user is able to read, write, and execute changes to folders.

    Because audit logs contain sensitive data about the system and users, the audit service MUST be configured to mode 700 or less permissive; thereby preventing normal users from reading, modifying or deleting audit logs.'
  resolution: /bin/chmod 700 /var/audit
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Retention to $ODV
  platforms: macOS
  platform: darwin
  description: 'The audit service MUST be configured to require records be kept for a organizational defined value before deletion, unless the system uses a central audit record storage facility.

    When "expire-after" is set to "$ODV", the audit service will not delete audit logs until the log data criteria is met.'
  resolution: /usr/bin/sed -i.bak 's/^expire-after.*/expire-after:$ODV/' /etc/security/audit_control; /usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' OR path LIKE '/etc/security/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable AirDrop
  platforms: macOS
  platform: darwin
  description: 'AirDrop MUST be disabled to prevent file transfers to or from unauthorized devices.

    AirDrop allows users to share and receive files from other nearby Apple devices.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowAirDrop' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.1.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Must Use an Approved Antivirus Program
  platforms: macOS
  platform: darwin
  description: 'An approved antivirus product MUST be installed and configured to run.

    Malicious software can establish a base on individual desktops and servers. Employing an automated mechanism to detect this type of software will aid in elimination of the software from the operating system.'''
  resolution: '/bin/launchctl load -w /Library/Apple/System/Library/LaunchDaemons/com.apple.XProtect.daemon.scan.plist

    /bin/launchctl load -w /Library/Apple/System/Library/LaunchDaemons/com.apple.XprotectFramework.PluginService.plist

    NOTE: These services cannot be unloaded or loaded while System Integrity Protection (SIP) is enabled.'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.10 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Authenticated Root
  platforms: macOS
  platform: darwin
  description: 'Authenticated Root MUST be enabled.

    When Authenticated Root is enabled the macOS is booted from a signed volume that is cryptographically protected to prevent tampering with the system volume.

    NOTE: Authenticated Root is enabled by default on macOS systems.

    WARNING: If more than one partition with macOS is detected, the csrutil command will hang awaiting input.'
  resolution: '/usr/bin/csrutil authenticated-root enable

    NOTE: To re-enable "Authenticated Root", boot the affected system into "Recovery" mode, launch "Terminal" from the "Utilities" menu, and run the command.'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Installation of XProtect Remediator and Gatekeeper Updates Automatically
  platforms: macOS
  platform: darwin
  description: 'Software Update MUST be configured to update XProtect Remediator and Gatekeeper automatically.

    This setting enforces definition updates for XProtect Remediator and Gatekeeper; with this setting in place, new malware and adware that Apple has added to the list of malware or untrusted software will not execute. These updates do not require the computer to be restarted.

    link:https://support.apple.com/en-us/HT207005[]

    NOTE: Software update will automatically update XProtect Remediator and Gatekeeper by default in the macOS.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND name='ConfigDataInstall' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Gatekeeper
  platforms: macOS
  platform: darwin
  description: 'Gatekeeper MUST be enabled.

    Gatekeeper is a security feature that ensures that applications are digitally signed by an Apple-issued certificate before they are permitted to run. Digital signatures allow the macOS host to verify that the application has not been modified by a malicious third party.

    Administrator users will still have the option to override these settings on a case-by-case basis.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.systempolicy.control' AND name='EnableAssessment' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Remove Guest Folder if Present
  platforms: macOS
  platform: darwin
  description: The guest folder MUST be deleted if present.
  resolution: /bin/rm -Rf /Users/Guest
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.9 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Secure User's Home Folders
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to prevent access to other user''s home folders.

    The default behavior of macOS is to allow all valid users access to the top level of every other user''s home folder while restricting access only to the Apple default folders within.'
  resolution: 'IFS=$''\n''

    for userDirs in $( /usr/bin/find /System/Volumes/Data/Users -mindepth 1 -maxdepth 1 -type d ! \( -perm 700 -o -perm 711 \) | /usr/bin/grep -v "Shared" | /usr/bin/grep -v "Guest" ); do

    /bin/chmod og-rwx "$userDirs"

    done

    unset IFS'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Built-in Web Server
  platforms: macOS
  platform: darwin
  description: 'The built-in web server which is managed by launchd is a non-essential service built into macOS and MUST be disabled and not running.

    NOTE: The built in web server service is disabled at startup by default macOS.'
  resolution: '/usr/sbin/apachectl stop 2>/dev/null

    /bin/launchctl disable system/org.apache.httpd'
  query: SELECT 1 FROM launchd WHERE name LIKE '%audit%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_4.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Install.log Retention to $ODV
  platforms: macOS
  platform: darwin
  description: The install.log MUST be configured to require records be kept for a organizational defined value before deletion, unless the system uses a central audit record storage facility.
  resolution: '/usr/bin/sed -i '''' "s/\ file \/var\/log\/install.log./\* file \/var\/log\/install.log format=''\$\(\(Time\)\(JZ\)\) \$Host \$\(Sender\)\[\$\(PID\\)\]: \$Message'' rotate=utc compress filemax=50M sizeonly ttl=$ODV/g" /etc/asl/com.apple.install

    NOTE: If there are multiple configuration files in /etc/asl that are set to process the file /var/log/install.log, these files will have to be manually removed.'
  query: SELECT 1 FROM file WHERE path LIKE '/etc/%' OR path LIKE '/var/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Mail Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Apple Mail Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowMailSummary' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Apple Mobile File Integrity
  platforms: macOS
  platform: darwin
  description: Mobile file integrity MUST be enabled.
  resolution: /usr/sbin/nvram boot-args=""
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Network File System Service
  platforms: macOS
  platform: darwin
  description: Support for Network File Systems (NFS) services is non-essential and, therefore, MUST be disabled.
  resolution: '/bin/launchctl disable system/com.apple.nfsd

    /bin/rm -rf /etc/exports

    The system may need to be restarted for the update to take effect.'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_4.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Notes Transcription
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Notes Transcription that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowNotesTranscription' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Notes Transcription Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Notes Transcription Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowNotesTranscriptionSummary' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce On Device Dictation
  platforms: macOS
  platform: darwin
  description: 'Dictation MUST be restricted to on device only to prevent potential data exfiltration.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='forceOnDeviceOnlyDictation' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.18.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Remove Password Hint From User Accounts
  platforms: macOS
  platform: darwin
  description: User accounts MUST not contain password hints.
  resolution: 'for u in $(/usr/bin/dscl . -list /Users UniqueID | /usr/bin/awk ''$2 > 500 {print $1}''); do

    /usr/bin/dscl . -delete /Users/$u hint

    done'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.12.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Power Nap
  platforms: macOS
  platform: darwin
  description: 'Power Nap MUST be disabled.

    NOTE: Power Nap allows your Mac to perform actions while a Mac is asleep. This can interfere with USB power and may cause devices such as smartcards to stop functioning until a reboot and must therefore be disabled on all applicable systems.

    The following Macs support Power Nap:

    MacBook (Early 2015 and later)

    MacBook Air (Late 2010 and later)

    MacBook Pro (all models with Retina display)

    Mac mini (Late 2012 and later)

    iMac (Late 2012 and later)

    Mac Pro (Late 2013 and later)'
  resolution: /usr/bin/pmset -a powernap 0
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.10.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Root Login
  platforms: macOS
  platform: darwin
  description: 'To assure individual accountability and prevent unauthorized access, logging in as root at the login window MUST be disabled.

    The macOS system MUST require individuals to be authenticated with an individual authenticator prior to using a group authenticator, and administrator users MUST never log in directly as root.'
  resolution: /usr/bin/dscl . -create /Users/root UserShell /usr/bin/false
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.6 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Advertising Privacy Protection in Safari Is Enabled
  platforms: macOS
  platform: darwin
  description: Allow privacy-preserving measurement of ad effectiveness MUST be enabled in Safari.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_6.3.6 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Automatic Opening of Safe Files in Safari
  platforms: macOS
  platform: darwin
  description: Open "safe" files after downloading MUST be disabled in Safari.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_6.3.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Prevent Cross-site Tracking in Safari Is Enabled
  platforms: macOS
  platform: darwin
  description: Prevent cross-site tracking MUST be enabled in Safari.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_6.3.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Show Full Website Address in Safari Is Enabled
  platforms: macOS
  platform: darwin
  description: Show full website address MUST be enabled in Safari.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_6.3.7 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Show Safari shows the Status Bar is Enabled
  platforms: macOS
  platform: darwin
  description: Safari MUST be configured to show the status bar.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_6.3.10 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Warn When Visiting A Fraudulent Website in Safari Is Enabled
  platforms: macOS
  platform: darwin
  description: Warn when visiting a fraudulent website MUST be enabled in Safari.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_6.3.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure System Integrity Protection is Enabled
  platforms: macOS
  platform: darwin
  description: 'System Integrity Protection (SIP) MUST be enabled.

    SIP is vital to protecting the integrity of the system as it prevents malicious users and software from making unauthorized and/or unintended modifications to protected files and folders; ensures the presence of an audit record generation capability for defined auditable events for all operating system components; protects audit tools from unauthorized access, modification, and deletion; restricts the root user account and limits the actions that the root user can perform on protected parts of the macOS; and prevents non-privileged users from granting other users direct access to the contents of their home directories and folders.

    NOTE: SIP is enabled by default in macOS.'
  resolution: '/usr/bin/csrutil enable

    NOTE: To reenable "System Integrity Protection", boot the affected system into "Recovery" mode, launch "Terminal" from the "Utilities" menu, and run the command.'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Software Update App Update Updates Automatically
  platforms: macOS
  platform: darwin
  description: Software Update MUST be configured to enforce automatic updates of App Updates is enabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND name='AutomaticallyInstallAppUpdates' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Software Update Deferment Is Less Than or Equal to $ODV Days
  platforms: macOS
  platform: darwin
  description: Software updates MUST be deferred for $ODV days or less.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='enforcedSoftwareUpdateDelay' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.6 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Sudo To Log Events
  platforms: macOS
  platform: darwin
  description: Sudo MUST be configured to log privilege escalation.
  resolution: '/usr/bin/find /etc/sudoers -type f -exec sed -i '''' ''/^Defaults[[:blank:]]\!logallowed/s/^/# /'' ''{}'' \;

    /bin/echo "Defaults logallowed" >> /etc/sudoers.d/mscp'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.11 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Sudo Timeout Period to $ODV
  platforms: macOS
  platform: darwin
  description: The file /etc/sudoers MUST include a timestamp_timeout of $ODV.
  resolution: '/usr/bin/find /etc/sudoers* -type f -exec sed -i '''' ''/timestamptimeout/d'' ''{}'' \;

    /bin/echo "Defaults timestamptimeout=$ODV" >> /etc/sudoers.d/mscp'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Sudoers Timestamp Type
  platforms: macOS
  platform: darwin
  description: 'The file /etc/sudoers MUST be configured to not include a timestamp_type of global or ppid and be configured for timestamp record types of tty.

    This rule ensures that the "sudo" command will prompt for the administrator''s password at least once in each newly opened terminal window. This prevents a malicious user from taking advantage of an unlocked computer or an abandoned logon session by bypassing the normal password prompt requirement.'
  resolution: /usr/bin/find /etc/sudoers* -type f -exec sed -i '' '/timestamptype/d; /!ttytickets/d' '{}' \;
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Appropriate Permissions Are Enabled for System Wide Applications
  platforms: macOS
  platform: darwin
  description: Applications in the System Applications Directory (/Applications) MUST not be world-writable.
  resolution: 'IFS=$''\n''

    for apps in $( /usr/bin/find /Applications -iname "*\.app" -type d -perm -2 ); do

    /bin/chmod -R o-w "$apps"

    done'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Secure Keyboard Entry Terminal.app is Enabled
  platforms: macOS
  platform: darwin
  description: Secure keyboard entry MUST be enabled in Terminal.app.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.Terminal' AND name='SecureKeyboardEntry' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_6.4.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Time Synchronization Daemon
  platforms: macOS
  platform: darwin
  description: 'The macOS time synchronization daemon (timed) MUST be enabled for proper time synchronization to an authorized time server.

    NOTE: The time synchronization daemon is enabled by default on macOS.'
  resolution: '/bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.timed.plist

    NOTE: The service timed cannot be unloaded or loaded while System Integrity Protection (SIP) is enabled.'
  query: SELECT 1 FROM launchd WHERE name LIKE '%audit%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.2.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Login to Other User's Active and Locked Sessions
  platforms: macOS
  platform: darwin
  description: 'The ability to log in to another user''s active or locked session MUST be disabled.

    macOS has a privilege that can be granted to any user that will allow that user to unlock active user''s sessions. Disabling the admins and/or user''s ability to log into another user''s active and locked session prevents unauthorized persons from viewing potentially sensitive and/or personal information.

    NOTE: Configuring this setting will change the user experience and disable TouchID from unlocking the screensaver. A configuration profile will be generated to include the setting that restores the expected behavior. You can also apply the settings using /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.loginwindow screenUnlockMode -int 1.

    WARNING: This rule may cause issues when platformSSO is configured.'
  resolution: 'SSRULE=$(/usr/bin/security -q authorizationdb read system.login.screensaver 2>&1 | /usr/bin/xmllint --xpath "//dict/key[.=''rule'']/following-sibling::array[1]/string/text()" -)

    if [[ "$SSRULE" == psso ]]; then

    /usr/bin/security -q authorizationdb read psso-screensaver > "/tmp/psso-screensaver-mscp.plist"

    /usr/bin/sed -i.bak ''s/<string>authenticate-session-owner-or-admin<\/string>/<string>$ODV<\/string>/'' /tmp/psso-screensaver-mscp.plist

    /usr/bin/security -q authorizationdb write psso-screensaver-mscp < /tmp/psso-screensaver-mscp.plist

    /usr/bin/security -q authorizationdb write system.login.screensaver psso-screensaver-mscp 2>&1

    else

    /usr/bin/security -q authorizationdb write system.login.screensaver "$ODV" 2>&1

    fi'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.7 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure No World Writable Files Exist in the System Folder
  platforms: macOS
  platform: darwin
  description: Folders in /System/Volumes/Data/System MUST not be world-writable.
  resolution: 'IFS=$''\n''

    for sysPermissions in $( /usr/bin/find /System/Volumes/Data/System -type d -perm -2 | /usr/bin/grep -vE "downloadDir|locks" ); do

    /bin/chmod -R o-w "$sysPermissions"

    done'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.6 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Writing Tools
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as writing tools that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowWritingTools' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Limit Consecutive Failed Login Attempts to $ODV
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to limit the number of failed login attempts to a maximum of $ODV. When the maximum number of failed attempts is reached, the account MUST be locked for a period of time after.

    This rule protects against malicious users attempting to gain access to the system via brute-force hacking methods.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Set Account Lockout Time to $ODV Minutes
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to enforce a lockout time period of at least $ODV minutes when the maximum number of failed logon attempts is reached.

    This rule protects against malicious users attempting to gain access to the system via brute-force hacking methods.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prohibit Password Reuse for a Minimum of $ODV Generations
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to enforce a password history of at least $ODV previous passwords when a password is created.

    This rule ensures that users are  not allowed to re-use a password that was used in any of the $ODV previous password generations.

    Limiting password reuse protects against malicious users attempting to gain access to the system via brute-force hacking methods.

    NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.8 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Restrict Maximum Password Lifetime to $ODV Days
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to enforce a maximum password lifetime limit of at least $ODV days.

    This rule ensures that users are forced to change their passwords frequently enough to prevent malicious users from gaining and maintaining access to the system.

    NOTE: To comply with Executive Order 14028, “Improving the Nation''s Cybersecurity”, OMB M-22-09, “Moving the U.S. Government Toward Zero Trust Cybersecurity Principles”, and NIST SP-800-63b, “Digital Identity Guidelines: Authentication and Lifecycle Management” federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.7 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require a Minimum Password Length of $ODV Characters
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to require a minimum of $ODV characters be used when a password is created.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, “Improving the Nation''s Cybersecurity”, OMB M-22-09, “Moving the U.S. Government Toward Zero Trust Cybersecurity Principles”, and NIST SP-800-63b, “Digital Identity Guidelines: Authentication and Lifecycle Management” federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Airplay Receiver
  platforms: macOS
  platform: darwin
  description: 'Airplay Receiver allows you to send content from another Apple device to be displayed on the screen as it''s being played from your other device.

    Support for Airplay Receiver is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowAirPlayIncomingRequests' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.1.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Unattended or Automatic Logon to the System
  platforms: macOS
  platform: darwin
  description: 'Automatic logon MUST be disabled.

    When automatic logons are enabled, the default user account is automatically logged on at boot time without prompting the user for a password. Even if the screen is later locked, a malicious user would be able to reboot the computer and find it already logged in. Disabling automatic logons mitigates this risk.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='com.apple.login.mcx.DisableAutoLoginClient' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Bluetooth Sharing
  platforms: macOS
  platform: darwin
  description: 'Bluetooth Sharing MUST be disabled.

    Bluetooth Sharing allows users to wirelessly transmit files between the macOS and Bluetooth-enabled devices, including personally owned cellphones and tablets. A malicious user might introduce viruses or malware onto the system or extract sensitive files via Bluetooth Sharing. When Bluetooth Sharing is disabled, this risk is mitigated.

    [NOTE]

    ====

    The check and fix are for the last logged in user. To get the last logged in user, run the following.

    CURRENT_USER=$( /usr/bin/defaults read /Library/Preferences/com.apple.loginwindow lastUserName )

    ===='
  resolution: /usr/bin/sudo -u "$CURRENT_USER" /usr/bin/defaults -currentHost write com.apple.Bluetooth PrefKeyServicesEnabled -bool false
  query: SELECT 1 FROM managed_policies;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.10 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Critical Security Updates to be Installed
  platforms: macOS
  platform: darwin
  description: Ensure that security updates are installed as soon as they are available from Apple.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND name='CriticalUpdateInstall' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Sending Diagnostic and Usage Data to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability to submit diagnostic data to Apple MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of diagnostic and usage information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.SubmitDiagInfo' AND name='AutoSubmit' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable External Intelligence Integrations
  platforms: macOS
  platform: darwin
  description: 'Integration with external intelligence systems MUST be disabled unless approved by the organization. Disabling external intelligence integration will mitigate the risk of data being sent to unapproved third party.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowExternalIntelligenceIntegrations' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable External Intelligence Integration Sign In
  platforms: macOS
  platform: darwin
  description: 'The ability to sign into an external intelligence systems MUST be disabled unless approved by the organiztion. Disabling external intelligence integration will mitigate the risk of data being sent to unapproved third party.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowExternalIntelligenceIntegrationsSignIn' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce FileVault
  platforms: macOS
  platform: darwin
  description: 'FileVault MUST be enforced.

    The information system implements cryptographic mechanisms to protect the confidentiality and integrity of information stored on digital media during transport outside of controlled areas.

    NOTE: See the FileVault supplemental to implement this rule.'
  resolution: 'NOTE: See the FileVault supplemental to implement this rule.'
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.MCX' AND name='dontAllowFDEDisable' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.6 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable macOS Application Firewall
  platforms: macOS
  platform: darwin
  description: 'The macOS Application Firewall is the built-in firewall that comes with macOS, and it MUST be enabled.

    When the macOS Application Firewall is enabled, the flow of information within the information system and between interconnected systems will be controlled by approved authorizations.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.security.firewall' AND name='EnableFirewall' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.2.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Firewall Stealth Mode
  platforms: macOS
  platform: darwin
  description: 'Firewall Stealth Mode MUST be enabled.

    When stealth mode is enabled, the Mac will not respond to any probing requests, and only requests from authorized applications will still be authorized.

    [IMPORTANT]

    ====

    Enabling firewall stealth mode may prevent certain remote mechanisms used for maintenance and compliance scanning from properly functioning. Information System Security Officers (ISSOs) are advised to first fully weigh the potential risks posed to their organization before opting not to enable stealth mode.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.security.firewall' AND name='EnableStealthMode' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.2.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Guest Access to Shared SMB Folders
  platforms: macOS
  platform: darwin
  description: 'Guest access to shared Server Message Block (SMB) folders MUST be disabled.

    Turning off guest access prevents anonymous users from accessing files shared via SMB.'
  resolution: /usr/sbin/sysadminctl -smbGuestAccess off
  query: SELECT 1 FROM managed_policies;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Guest Account
  platforms: macOS
  platform: darwin
  description: 'Guest access MUST be disabled.

    Turning off guest access prevents anonymous users from accessing files.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.MCX' AND name='DisableGuestAccount' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Sending Audio Recordings and Transcripts to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability for Apple to store and review audio of your audio recordings and transcripts of your vocal shortcuts and voice control interactions MUST be disabled. This will disable "Improve Assistive Voice Features" in Privacy & Security within System Settings.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of this information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.Accessibility' AND name='AXSAudioDonationSiriImprovementEnabled' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Improve Siri and Dictation Information to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability for Apple to store and review audio of your Siri and Dictation interactions MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of Siri and Dictation information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.assistant.support' AND name='Siri Data Sharing Opt-In Status' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce macOS Updates are Automatically Installed
  platforms: macOS
  platform: darwin
  description: Software Update MUST be configured to enforce automatic installation of macOS updates is enabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND name='AutomaticallyInstallMacOSUpdates' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Internet Sharing
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Internet sharing, support for it is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling Internet sharing helps prevent the unauthorized connection of devices, unauthorized transfer of information, and unauthorized tunneling.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.MCX' AND name='forceInternetSharingOff' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.7 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Location Services Is In the Menu Bar
  platforms: macOS
  platform: darwin
  description: Location Services menu item MUST be enabled.
  resolution: /usr/bin/defaults write /Library/Preferences/com.apple.locationmenu.plist ShowSystemServices -bool true
  query: SELECT 1 FROM managed_policies;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.1.2 (level 2)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Login Window to Show A Custom Message
  platforms: macOS
  platform: darwin
  description: The login window MUST be configured to show a custom access warning message.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='LoginwindowText' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Login Window to Prompt for Username and Password
  platforms: macOS
  platform: darwin
  description: 'The login window MUST be configured to prompt all users for both a username and a password.

    By default, the system displays a list of known users on the login window, which can make it easier for a malicious user to gain access to someone else''s account. Requiring users to type in both their username and password mitigates the risk of unauthorized users gaining access to the information system.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='SHOWFULLNAME' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Password Hints
  platforms: macOS
  platform: darwin
  description: 'Password hints MUST be disabled.

    Password hints leak information about passwords that are currently in use and can lead to loss of confidentiality.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='RetriesUntilHint' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Personalized Advertising
  platforms: macOS
  platform: darwin
  description: 'Ad tracking and targeted ads MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling ad tracking ensures that applications and advertisers are unable to track users'' interests and deliver targeted advertisements.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowApplePersonalizedAdvertising' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Printer Sharing
  platforms: macOS
  platform: darwin
  description: Printer Sharing MUST be disabled.
  resolution: '/usr/sbin/cupsctl --no-share-printers

    /usr/bin/lpstat -p | awk ''{print $2}''| /usr/bin/xargs -I{} lpadmin -p {} -o printer-is-shared=false'
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Remote Apple Events
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Remote Apple Events, support for Apple Remote Events is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling Remote Apple Events helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling.'
  resolution: '/usr/sbin/systemsetup -setremoteappleevents off

    /bin/launchctl disable system/com.apple.AEServer

    NOTE: Systemsetup with -setremoteappleevents flag will fail unless you grant Full Disk Access to systemsetup or its parent process. Requires supervision.'
  query: SELECT 1 FROM launchd WHERE name LIKE '%audit%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.6 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Remote Management
  platforms: macOS
  platform: darwin
  description: Remote Management MUST be disabled.
  resolution: /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -stop
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.5 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Screen Sharing and Apple Remote Desktop
  platforms: macOS
  platform: darwin
  description: 'Support for both Screen Sharing and Apple Remote Desktop (ARD) is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling screen sharing and ARD helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling.'
  resolution: '/bin/launchctl bootout system/com.apple.screensharing

    /bin/launchctl disable system/com.apple.screensharing

    NOTE - This will apply to the whole system'
  query: SELECT 1 FROM launchd WHERE name LIKE '%audit%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Session Lock After Screen Saver is Started
  platforms: macOS
  platform: darwin
  description: 'A screen saver MUST be enabled and the system MUST be configured to require a password to unlock once the screensaver has been on for a maximum of $ODV seconds.

    An unattended system with an excessive grace period is vulnerable to a malicious user.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='askForPasswordDelay' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Screen Saver Timeout
  platforms: macOS
  platform: darwin
  description: 'The screen saver timeout MUST be set to $ODV seconds or a shorter length of time.

    This rule ensures that a full session lock is triggered within no more than $ODV seconds of inactivity.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='idleTime' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Siri
  platforms: macOS
  platform: darwin
  description: 'Support for Siri is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowAssistant' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.2.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Server Message Block Sharing
  platforms: macOS
  platform: darwin
  description: 'Support for Server Message Block (SMB) file sharing is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: '/bin/launchctl disable system/com.apple.smbd

    The system may need to be restarted for the update to take effect.'
  query: SELECT 1 FROM launchd WHERE name LIKE '%audit%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Software Update Downloads Updates Automatically
  platforms: macOS
  platform: darwin
  description: Software Update MUST be configured to enforce automatic downloads of updates is enabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.SoftwareUpdate' AND name='AutomaticDownload' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Software Update is Updated and Current
  platforms: macOS
  platform: darwin
  description: 'Make sure Software Update is updated and current.

    NOTE: Automatic fix can cause unplanned restarts and may lose work.'
  resolution: '/usr/sbin/softwareupdate -i -a

    NOTE - This will apply to the whole system'
  query: SELECT 1 FROM software_update WHERE software_update_required = '0';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable SSH Server for Remote Access Sessions
  platforms: macOS
  platform: darwin
  description: SSH service MUST be disabled for remote access.
  resolution: '/usr/sbin/systemsetup -f -setremotelogin off >/dev/null

    /bin/launchctl disable system/com.openssh.sshd

    NOTE: Systemsetup with -setremotelogin flag will fail unless you grant Full Disk Access to systemsetup or its parent process. Requires supervision.'
  query: SELECT 1 FROM launchd WHERE name LIKE '%audit%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.4 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Administrator Password to Modify System-Wide Preferences
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to require an administrator password in order to modify the system-wide preferences in System Settings.

    Some Preference Panes in System Settings contain settings that affect the entire system. Requiring a password to unlock these system-wide settings reduces the risk of a non-authorized user modifying system configurations.'
  resolution: "authDBs=(\"system.preferences\" \"system.preferences.energysaver\" \"system.preferences.network\" \"system.preferences.printing\" \"system.preferences.sharing\" \"system.preferences.softwareupdate\" \"system.preferences.startupdisk\" \"system.preferences.timemachine\")\nfor section in ${authDBs[@]}; do\n/usr/bin/security -q authorizationdb read \"$section\" > \"/tmp/$section.plist\"\nclasskeyvalue=$(/usr/libexec/PlistBuddy -c \"Print :class\" \"/tmp/$section.plist\" 2>&1)\nif [[ \"$classkeyvalue\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :class string user\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :class user\" \"/tmp/$section.plist\"\nfi\nkeyvalue=$(/usr/libexec/PlistBuddy -c \"Print :shared\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$keyvalue\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :shared bool false\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :shared false\" \"/tmp/$section.plist\"\
    \nfi\nauthuserkey=$(/usr/libexec/PlistBuddy -c \"Print :authenticate-user\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$authuserkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :authenticate-user bool true\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :authenticate-user true\" \"/tmp/$section.plist\"\nfi\nsessionownerkey=$(/usr/libexec/PlistBuddy -c \"Print :session-owner\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$sessionownerkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :session-owner bool false\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :session-owner false\" \"/tmp/$section.plist\"\nfi\ngroupkey=$(/usr/libexec/PlistBuddy -c \"Print :group\" \"/tmp/$section.plist\" 2>&1)\nif [[ \"$groupkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :group string admin\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :group admin\" \"/tmp/$section.plist\"\nfi\n/usr/bin/security\
    \ -q authorizationdb write \"$section\" < \"/tmp/$section.plist\"\ndone"
  query: SELECT 1 FROM software_update WHERE software_update_required = '0';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.8 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Time Machine Volumes are Encrypted
  platforms: macOS
  platform: darwin
  description: Time Machine volumes MUST be encrypted.
  resolution: '. Go to System Settings -> Time Machine

    . Click Select Disk

    . Select existing Backup Disk under Available Disks

    . Click Encrypt Backups

    . Click Use Disk'
  query: SELECT 1 FROM managed_policies;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.4.2 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure macOS to Use an Authorized Time Server
  platforms: macOS
  platform: darwin
  description: 'Approved time server MUST be the only server configured for use. As of macOS 10.13 only one time server is supported.

    This rule ensures the uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.MCX' AND name='timeServer' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.2.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce macOS Time Synchronization
  platforms: macOS
  platform: darwin
  description: 'Time synchronization MUST be enforced on all networked systems.

    This rule ensures the uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.timed' AND name='TMAutomaticTimeOnlyEnabled' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.2.1 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Wake for Network Access Is Disabled
  platforms: macOS
  platform: darwin
  description: Wake for network access MUST be disabled.
  resolution: /usr/bin/pmset -a womp 0
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.10.3 (level 1)
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - CIS Manual Recommendations
  platforms: macOS
  platform: darwin
  description: "List of CIS recommendations that are manual check in the CIS macOS Benchmark.\n[cols=\"15%h, 85%a\"]\n|===\n|Section\n|System Settings\n|Recommendations\n| 1.7 Ensure the System is Managed by a Mobile Device Management (MDM) Software\n|===\n[cols=\"15%h, 85%a\"]\n|===\n|Section\n|System Settings\n|Recommendations\n|2.1.1.1 Audit iCloud Keychain +\n2.1.1.2 Audit iCloud Drive +\n2.1.1.4 Audit Security Keys Used With Apple Accounts +\n2.1.1.5 Audit Freeform Sync to iCloud +\n2.1.1.6 Audit Find My Mac +\n2.1.2 Audit App Store Password Settings +\n2.3.3.11 Ensure Computer Name Does Not Contain PII or Protected Organizational Information +\n2.4.1 Audit Menu Bar and Control Center Icons + \n2.5.2.2 Ensure Listen for Siri is Disabled +\n2.6.1.3 Audit Location Services Access +\n2.6.2.1 Audit Full Disk Access for Applications +\n2.6.3.5 Ensure Share iCloud Analytics Is Disabled +\n2.6.7 Audit Lockdown Mode +\n2.7.2 Audit iPhone Mirroring +\n2.8.1 Audit Universal Control Settings +\n\
    2.10.1.1 Ensure the OS Is Not Active When Resuming from Standby (Intel) +\n2.12.2 Audit Touch ID +\n2.14.1 Audit Game Center Settings +\n2.15.1 Audit Notification & Focus Settings +\n2.16.1 Audit Wallet & Apple Pay Settings +\n2.17.1 Audit Internet Accounts for Authorized Use +\n|===\n[cols=\"15%h, 85%a\"]\n|===\n|Section\n|Logging and Auditing\n|Recommendations\n|3.6 Audit Software Inventory\n|===\n[cols=\"15%h, 85%a\"]\n|===\n|Section\n|System Access, Authentication and Authorization\n|Recommendations\n|5.2.3 Ensure Complex Password Must Contain Alphabetic Characters Is Configured +\n5.2.4 Ensure Complex Password Must Contain Numeric Character Is Configured +\n5.2.5 Ensure Complex Password Must Contain Special Character Is Configured +\n5.2.6 Ensure Complex Password Must Contain Uppercase and Lowercase Characters Is Configured +\n5.3.1 Ensure All User Storage APFS Volumes are Encrypted +\n5.3.2 Ensure All User Storage CoreStorage Volumes are Encrypted +\n|===\n[cols=\"15%h, 85%a\"\
    ]\n|===\n|Section\n|Applications\n|Recommendations\n|6.1.1 Ensure Show All Filename Extensions Setting is Enabled +\n6.2.1 Ensure Protect Mail Activity in Mail Is Enabled +\n6.3.2 Audit History and Remove History Items +\n6.3.5 Audit Hide IP Address in Safari Setting +\n6.3.8 Audit Autofill +\n6.3.9 Audit Pop-up Windows +\n6.5.1 Audit Passwords +\n|==="
  resolution: ''
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - FileVault Supplemental
  platforms: macOS
  platform: darwin
  description: 'The supplemental guidance found in this section is applicable for the following rules:

    * systemsettingsfilevaultenforce

    In macOS the internal Apple File System (APFS) data volume can be protected by FileVault. The system volume is always cryptographically protected (T2 and Apple Silicon) and is a read-only volume.

    NOTE: FileVault uses an AES-XTS data encryption algorithm to protect full volumes of internal and external storage. Macs with a secure enclave (T2 and Apple Silicon) utilize the hardware security features of the architecture.

    FileVault is described in detail here: link:https://support.apple.com/guide/security/volume-encryption-with-filevault-sec4c6dc1b6e/web[].

    FileVault can be enabled in two ways within the macOS. It can be managed using the fdesetup command or by a Configuration Profile. When enabling FileVault via either of the aforementioned methods, you will be required to enter a username and password, which must be a local Open Directory account with a valid SecureToken password.

    [discrete]

    ==== Using the fdesetup Command

    When enabling FileVault via the command line in the Terminal application, you can run the following command.

    /usr/bin/fdesetup enable

    Running this command will prompt you for a username and password and then enable FileVault and return the personal recovery key. There are a number of management features available when managing FileVault via the command line that are not available when using a configuration profile. More information on these management features is available in the man page for fdesetup.

    NOTE: Apple has deprecated fdesetup command line tool from recognizing user name and password for security reasons and may remove the ability in future versions of macOS.

    [discrete]

    ==== Using a Configuration Profile

    When managing FileVault with a configuration profile, you must deploy a profile with the payload type com.apple.MCX.FileVault2. When using the Enable key to enable FileVault with a configuration profile, you must include 1 of the following:

    <key>Enable</key>

    <string>On</string>

    <key>Defer</key>

    <true/>

    <key>Enable</key>

    <string>On</string>

    <key>UserEntersMissingInfo</key>

    <true/>

    If using the Defer key it will prompt for the user name and password at logout.

    The UserEntersMissingInfo key will only work if installed through manual installation, and it will prompt for the username and password immediately.

    When using a configuration profile, you can escrow the Recovery key to a Mobile Device Management (MDM) server. Documentation for that can be found on Apple''s Developer site: link:https://developer.apple.com/documentation/devicemanagement/fderecoverykeyescrow[].

    It''s recommended that you use a Personal Recovery key instead of an Institutional key as it will generate a specific key for each device. You can find more guidance on choosing a recover key here: link:https://docs.jamf.com/technical-papers/jamf-pro/administering-filevault-macos/10.7.1/ChoosingaRecoveryKey.html[].

    NOTE: On Intel Macs, FileVault only supports password-based unlock and cannot be done using a smartcard. Smartcard unlock for FileVault is supported on Apple Silicon Macs.'
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.MCX';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cis_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Password Policy Supplemental
  platforms: macOS
  platform: darwin
  description: "To comply with Executive Order 14028, “Improving the Nation's Cybersecurity”, OMB M-22-09, “Moving the U.S. Government Toward Zero Trust Cybersecurity Principles”, and NIST SP-800-63b, “Digital Identity Guidelines: Authentication and Lifecycle Management” federal, military, and intelligence communities must adopt the following configuration settings: \nPassword policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. \nPassword policies must also not require the use of regular rotation. \nIn accordance with these requirements, the following rules, while they remain on specific benchmarks, have been removed from any of the NIST 800-53r5 baselines as recommendations.\npwpolicyalphanumericenforce\npwpolicycustomregexenforce\npwpolicylowercasecharacterenforce.yaml\npwpolicymaxlifetimeenforce\npwpolicyminimumlifetimeenforce\npwpolicypreventdictionarywords\npwpolicysimplesequencedisable\npwpolicyspecialcharacterenforce\n\
    pwpolicyuppercasecharacterenforce.yaml\nIf an organization has requirements to implement additional password policies, the remainder of this supplemental discusses the following password policy rules:\npwpolicylowercasecharacterenforce\npwpolicyuppercasecharacterenforce\npwpolicyaccountinactivityenforce\npwpolicyminimumlifetimeenforce\nPassword policies should be enforced as much as possible via Configuration Profiles. However, the following policies are currently not enforceable via Configuration Profiles, and must therefore be enabled using the pwpolicy command:\nEnforcing at least 1 lowercase character\nEnforcing at least 1 uppercase character\nDisabling an account after 35 days of inactivity\n* Password minimum lifetime\nTo set the local policy to meet these requirements, save the following XML password policy to a file.\ninclude::../../includes/pwpolicy.xml[]\nRun the following command to load the new policy file, substituting the path to the file in place of \"$pwpolicyfile\".\n\
    /usr/bin/pwpolicy setaccountpolicies $pwpolicy_file\n[NOTE]\n====\nIf directory services is being utilized, password policies should come from the domain.\n====\n[WARNING]\n====\nIn order to apply any password policy, the allowPasscodeModification setting in com.apple.applicationaccess must not be set to false.\n===="
  resolution: ''
  query: SELECT 1;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cis_lvl1
  contributors: macos_security_compliance_project
---
