# Fleet policies for macOS 26.0: Security Configuration - Committee on National Security Systems Instruction No. 1253 (Low)
# Generated from macOS Security Compliance Project

apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files to Not Contain Access Control Lists
  platforms: macOS
  platform: darwin
  description: 'The audit log files MUST not contain access control lists (ACLs).

    This rule ensures that audit information and audit files are configured to be readable and writable only by system administrators, thereby preventing unauthorized access, modification, and deletion of files.'
  resolution: /bin/chmod -RN /var/audit
  query: SELECT 1 FROM file WHERE (path LIKE '/var/audit/%' OR path LIKE '/etc/security/%') AND extended_attributes LIKE '%com.apple.acl%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folder to Not Contain Access Control Lists
  platforms: macOS
  platform: darwin
  description: 'The audit log folder MUST not contain access control lists (ACLs).

    Audit logs contain sensitive data about the system and users. This rule ensures that the audit service is configured to create log folders that are readable and writable only by system administrators in order to prevent normal users from reading audit logs.'
  resolution: /bin/chmod -N /var/audit
  query: SELECT 1 FROM file WHERE (path LIKE '/var/audit/%' OR path LIKE '/etc/security/%') AND type = 'directory' AND extended_attributes LIKE '%com.apple.acl%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Security Auditing
  platforms: macOS
  platform: darwin
  description: 'The information system MUST be configured to generate audit records.

    Audit records establish what types of events have occurred, when they occurred, and which users were involved. These records aid an organization in their efforts to establish, correlate, and investigate the events leading up to an outage or attack.

    The content required to be captured in an audit record varies based on the impact level of an organization''s system. Content that may be necessary to satisfy this requirement includes, for example, time stamps, source addresses, destination addresses, user identifiers, event descriptions, success/fail indications, filenames involved, and access or flow control rules invoked.

    The information system initiates session audits at system start-up.

    NOTE: Security auditing is NOT enabled by default on macOS Tahoe.'
  resolution: 'if [[ ! -e /etc/security/auditcontrol ]] && [[ -e /etc/security/auditcontrol.example ]];then

    /bin/cp /etc/security/auditcontrol.example /etc/security/auditcontrol

    fi

    /bin/launchctl enable system/com.apple.auditd

    /bin/launchctl bootstrap system /System/Library/LaunchDaemons/com.apple.auditd.plist

    /usr/sbin/audit -i'
  query: SELECT 1 FROM launchd WHERE name = 'com.apple.auditd' AND state = 'running';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Capacity Warning
  platforms: macOS
  platform: darwin
  description: 'The audit service MUST be configured to notify the system administrator when the amount of free disk space remaining reaches an organization defined value.

    This rule ensures that the system administrator is notified in advance that action is required to free up more disk space for audit logs.'
  resolution: /usr/bin/sed -i.bak 's/.minfree./minfree:$ODV/' /etc/security/audit_control; /usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/audit_control' AND content LIKE '%minfree%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control to Not Contain Access Control Lists
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ not contain Access Control Lists (ACLs).
  resolution: /bin/chmod -N /etc/security/audit_control
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control Group to Wheel
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ have the group set to wheel.
  resolution: /usr/bin/chgrp wheel /etc/security/audit_control
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control Owner to Mode 440 or Less Permissive
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ be configured so that it is readable only by the root user and group wheel.
  resolution: /bin/chmod 440 /etc/security/audit_control
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit_Control Owner to Root
  platforms: macOS
  platform: darwin
  description: /etc/security/auditcontrol MUST_ have the owner set to root.
  resolution: /usr/sbin/chown root /etc/security/audit_control
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Shut Down Upon Audit Failure
  platforms: macOS
  platform: darwin
  description: 'The audit service MUST be configured to shut down the computer if it is unable to audit system events.

    Once audit failure occurs, user and system activity are no longer recorded, and malicious activity could go undetected. Audit processing failures can occur due to software/hardware errors, failures in the audit capturing mechanisms, and audit storage capacity being reached or exceeded.'
  resolution: '/usr/bin/sed -i.bak ''s/^policy.*/policy: ahlt,argv/'' /etc/security/audit_control; /usr/sbin/audit -s'
  query: SELECT 1 FROM file WHERE path = '/etc/security/audit_control' AND content LIKE '%policy: ahlt%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files Group to Wheel
  platforms: macOS
  platform: darwin
  description: 'Audit log files MUST have the group set to wheel.

    The audit service MUST be configured to create log files with the correct group ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log files are set to be readable and writable only by system administrators, the risk is mitigated.'
  resolution: /usr/bin/chgrp -R wheel /var/audit/*
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' AND gid = 0;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files to Mode 440 or Less Permissive
  platforms: macOS
  platform: darwin
  description: The audit service MUST be configured to create log files that are readable only by the root user and group wheel. To achieve this, audit log files MUST be configured to mode 440 or less permissive; thereby preventing normal users from reading, modifying or deleting audit logs.
  resolution: /bin/chmod 440 /var/audit/*
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' AND mode <= '440';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Files to be Owned by Root
  platforms: macOS
  platform: darwin
  description: 'Audit log files MUST be owned by root.

    The audit service MUST be configured to create log files with the correct ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log files are set to only be readable and writable by system administrators, the risk is mitigated.'
  resolution: /usr/sbin/chown -R root /var/audit/*
  query: SELECT 1 FROM file WHERE path LIKE '/var/audit/%' AND uid = 0;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Authorization and Authentication Events
  platforms: macOS
  platform: darwin
  description: 'The auditing system MUST be configured to flag authorization and authentication (aa) events.

    Authentication events contain information about the identity of a user, server, or client. Authorization events contain information about permissions, rights, and rules. If audit records do not include aa events, it is difficult to identify incidents and to correlate incidents to subsequent events.

    Audit records can be generated from various components within the information system (e.g., via a module or policy filter).'
  resolution: /usr/bin/grep -qE "^flags.*[^-]aa" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,aa/' /etc/security/auditcontrol; /usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%aa%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.2 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Administrative Action Events
  platforms: macOS
  platform: darwin
  description: 'The auditing system MUST be configured to flag administrative action (ad) events.

    Administrative action events include changes made to the system (e.g. modifying authentication policies). If audit records do not include ad events, it is difficult to identify incidents and to correlate incidents to subsequent events.

    Audit records can be generated from various components within the information system (e.g., via a module or policy filter).

    The information system audits the execution of privileged functions.

    NOTE: We recommend changing the line "43127:AUEMACSYSCALL:macsyscall(2):ad" to "43127:AUEMACSYSCALL:macsyscall(2):zz" in the file /etc/security/audit_event. This will prevent sandbox violations from being audited by the ad flag.'
  resolution: /usr/bin/grep -qE "^flags.*[^-]ad" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,ad/' /etc/security/auditcontrol; /usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%ad%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.2 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Failed Program Execution on the System
  platforms: macOS
  platform: darwin
  description: 'The audit system MUST be configured to record enforcement actions of access restrictions, including failed program execute (-ex) attempts.

    Enforcement actions are the methods or mechanisms used to prevent unauthorized access and/or changes to configuration settings. One common and effective enforcement action method is using program execution restrictions (e.g., denying users access to execute certain processes).

    This configuration ensures that audit lists include events in which program execution has failed.

    Without auditing the enforcement of program execution, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation.'
  resolution: /usr/bin/grep -qE "^flags.*-ex" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,-ex/' /etc/security/auditcontrol; /usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%-ex%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.2 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Deletions of Object Attributes
  platforms: macOS
  platform: darwin
  description: 'The audit system MUST be configured to record enforcement actions of attempts to delete file attributes (fd).

    ***Enforcement actions are the methods or mechanisms used to prevent unauthorized changes to configuration settings. One common and effective enforcement action method is using access restrictions (i.e., denying modifications to a file by applying file permissions).

    This configuration ensures that audit lists include events in which enforcement actions prevent attempts to delete a file.

    Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation.'
  resolution: /usr/bin/grep -qE "^flags.*-fd" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,-fd/' /etc/security/auditcontrol;/usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%-fd%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Changes of Object Attributes
  platforms: macOS
  platform: darwin
  description: 'The audit system MUST be configured to record enforcement actions of attempts to modify file attributes (fm).

    Enforcement actions are the methods or mechanisms used to prevent unauthorized changes to configuration settings. One common and effective enforcement action method is using access restrictions (i.e., modifications to a file by applying file permissions).

    This configuration ensures that audit lists include events in which enforcement actions attempts to modify a file.

    Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation.'
  resolution: /usr/bin/grep -qE "^flags.*fm" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,fm/' /etc/security/auditcontrol;/usr/sbin/audit -s
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Failed Change of Object Attributes
  platforms: macOS
  platform: darwin
  description: 'The audit system MUST be configured to record enforcement actions of failed attempts to modify file attributes (-fm).

    Enforcement actions are the methods or mechanisms used to prevent unauthorized changes to configuration settings. One common and effective enforcement action method is using access restrictions (i.e., denying modifications to a file by applying file permissions).

    This configuration ensures that audit lists include events in which enforcement actions prevent attempts to modify a file.

    Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation.'
  resolution: /usr/bin/grep -qE "^flags.*-fm" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,-fm/' /etc/security/auditcontrol;/usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%-fm%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.2 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Failed Read Actions on the System
  platforms: macOS
  platform: darwin
  description: 'The audit system MUST be configured to record enforcement actions of access restrictions, including failed file read (-fr) attempts.

    Enforcement actions are the methods or mechanisms used to prevent unauthorized access and/or changes to configuration settings. One common and effective enforcement action method is using access restrictions (e.g., denying access to a file by applying file permissions).

    This configuration ensures that audit lists include events in which enforcement actions prevent attempts to read a file.

    Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation.'
  resolution: /usr/bin/grep -qE "^flags.*-fr" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,-fr/' /etc/security/auditcontrol;/usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%-fr%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.2 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Failed Write Actions on the System
  platforms: macOS
  platform: darwin
  description: 'The audit system MUST be configured to record enforcement actions of access restrictions, including failed file write (-fw) attempts.

    Enforcement actions are the methods or mechanisms used to prevent unauthorized access and/or changes to configuration settings. One common and effective enforcement action method is using access restrictions (e.g., denying users access to edit a file by applying file permissions).

    This configuration ensures that audit lists include events in which enforcement actions prevent attempts to change a file.

    Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation.'
  resolution: /usr/bin/grep -qE "^flags.*-fw" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,-fw/' /etc/security/auditcontrol;/usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%-fw%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.2 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System to Audit All Log In and Log Out Events
  platforms: macOS
  platform: darwin
  description: 'The audit system MUST be configured to record all attempts to log in and out of the system (lo).

    Frequently, an attacker that successfully gains access to a system has only gained access to an account with limited privileges, such as a guest account or a service account. The attacker must attempt to change to another user account with normal or elevated privileges in order to proceed. Auditing both successful and unsuccessful attempts to switch to another user account (by way of monitoring login and logout events) mitigates this risk.

    The information system monitors login and logout events.'
  resolution: /usr/bin/grep -qE "^flags.*[^-]lo" /etc/security/auditcontrol || /usr/bin/sed -i.bak '/^flags/ s/$/,lo/' /etc/security/auditcontrol; /usr/sbin/audit -s
  query: SELECT 1 FROM file WHERE path = '/etc/security/auditcontrol' AND content LIKE '%lo%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.2 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folders Group to Wheel
  platforms: macOS
  platform: darwin
  description: 'Audit log files MUST have the group set to wheel.

    The audit service MUST be configured to create log files with the correct group ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log files are set to be readable and writable only by system administrators, the risk is mitigated.'
  resolution: /usr/bin/chgrp wheel /var/audit
  query: SELECT 1 FROM file WHERE path = '/var/audit' AND type = 'directory' AND gid = 0;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folders to be Owned by Root
  platforms: macOS
  platform: darwin
  description: 'Audit log folders MUST be owned by root.

    The audit service MUST be configured to create log folders with the correct ownership to prevent normal users from reading audit logs.

    Audit logs contain sensitive data about the system and users. If log folders are set to only be readable and writable by system administrators, the risk is mitigated.'
  resolution: /usr/sbin/chown root /var/audit
  query: SELECT 1 FROM file WHERE path = '/var/audit' AND type = 'directory' AND uid = 0;
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Log Folders to Mode 700 or Less Permissive
  platforms: macOS
  platform: darwin
  description: 'The audit log folder MUST be configured to mode 700 or less permissive so that only the root user is able to read, write, and execute changes to folders.

    Because audit logs contain sensitive data about the system and users, the audit service MUST be configured to mode 700 or less permissive; thereby preventing normal users from reading, modifying or deleting audit logs.'
  resolution: /bin/chmod 700 /var/audit
  query: SELECT 1 FROM file WHERE path = '/var/audit' AND type = 'directory' AND mode <= '700';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Retention to $ODV
  platforms: macOS
  platform: darwin
  description: 'The audit service MUST be configured to require records be kept for a organizational defined value before deletion, unless the system uses a central audit record storage facility.

    When "expire-after" is set to "$ODV", the audit service will not delete audit logs until the log data criteria is met.'
  resolution: /usr/bin/sed -i.bak 's/^expire-after.*/expire-after:$ODV/' /etc/security/audit_control; /usr/sbin/audit -s
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.4 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Audit Failure Notification
  platforms: macOS
  platform: darwin
  description: 'The audit service MUST be configured to immediately print messages to the console or email administrator users when an auditing failure occurs.

    It is critical for the appropriate personnel to be made aware immediately if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of a potentially harmful failure in the auditing system''s capability, and system operation may be adversely affected.'
  resolution: /usr/bin/sed -i.bak 's/logger -p/logger -s -p/' /etc/security/audit_warn; /usr/sbin/audit -s
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Multifactor Authentication for Login
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to enforce multifactor authentication.

    All users MUST go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

    IMPORTANT: Modification of Pluggable Authentication Modules (PAM) now require user authorization, or use of a Privacy Preferences Policy Control (PPPC) profile from MDM that authorizes modifying system administrator files or full disk access.

    NOTE: /etc/pam.d/login will be automatically modified to its original state following any update or major upgrade to the operating system.'
  resolution: '/bin/cat > /etc/pam.d/login << LOGINEND

    # login: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        optional      pamkrb5.so usekcminit

    auth        optional      pamntlm.so tryfirstpass

    auth        optional      pammount.so tryfirstpass

    auth        required      pamopendirectory.so tryfirstpass

    auth        required      pamdeny.so

    account     required      pamnologin.so

    account     required      pamopendirectory.so

    password    required      pamopendirectory.so

    session     required      pamlaunchd.so

    session     required      pamuwtmp.so

    session     optional      pammount.so

    LOGIN_END

    /bin/chmod 644 /etc/pam.d/login

    /usr/sbin/chown root:wheel /etc/pam.d/login'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Multifactor Authentication for the su Command
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured such that, when the su command is used, multifactor authentication is enforced.

    All users MUST go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

    IMPORTANT: Modification of Pluggable Authentication Modules (PAM) now require user authorization, or use of a Privacy Preferences Policy Control (PPPC) profile from MDM that authorizes modifying system administrator files or full disk access.

    NOTE: /etc/pam.d/su will be automatically modified to its original state following any update or major upgrade to the operating system.'
  resolution: '/bin/cat > /etc/pam.d/su << SUEND

    # su: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        required      pamrootok.so

    auth        required      pamgroup.so nowarn group=admin,wheel ruser rootonly failsafe

    account     required      pampermit.so

    account     required      pamopendirectory.so nocheckshell

    password    required      pamopendirectory.so

    session     required      pamlaunchd.so

    SUEND

    # Fix new file ownership and permissions

    /bin/chmod 644 /etc/pam.d/su

    /usr/sbin/chown root:wheel /etc/pam.d/su'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Multifactor Authentication for Privilege Escalation Through the sudo Command
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to enforce multifactor authentication when the sudo command is used to elevate privilege.

    All users MUST go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

    IMPORTANT: Modification of Pluggable Authentication Modules (PAM) now require user authorization, or use of a Privacy Preferences Policy Control (PPPC) profile from MDM that authorizes modifying system administrator files or full disk access.

    NOTE: /etc/pam.d/sudo will be automatically modified to its original state following any update or major upgrade to the operating system.'
  resolution: '/bin/cat > /etc/pam.d/sudo << SUDOEND

    # sudo: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        required      pamopendirectory.so

    auth        required      pamdeny.so

    account     required      pampermit.so

    password    required      pamdeny.so

    session     required      pampermit.so

    SUDOEND

    /bin/chmod 444 /etc/pam.d/sudo

    /usr/sbin/chown root:wheel /etc/pam.d/sudo'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Allow Smartcard Authentication
  platforms: macOS
  platform: darwin
  description: 'Smartcard authentication MUST be allowed.

    The use of smartcard credentials facilitates standardization and reduces the risk of unauthorized access.

    When enabled, the smartcard can be used for login, authorization, and screen saver unlocking.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Set Smartcard Certificate Trust to High
  platforms: macOS
  platform: darwin
  description: 'The macOS system MUST be configured to block access to users who are no longer authorized (i.e., users with revoked certificates).

    To prevent the use of untrusted certificates, the certificates on a smartcard card MUST meet the following criteria: its issuer has a system-trusted certificate, the certificate is not expired, its "valid-after" date is in the past, and it passes Certificate Revocation List (CRL) and Online Certificate Status Protocol (OCSP) checking.

    By setting the smartcard certificate trust level to high, the system will execute a hard revocation, i.e., a network connection is required. A verified positive response from the OSCP/CRL server is required for authentication to succeed.

    NOTE: Before applying this setting, please see the smartcard supplemental guidance.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Set Smartcard Certificate Trust to Moderate
  platforms: macOS
  platform: darwin
  description: 'The macOS system MUST be configured to block access to users who are no longer authorized (i.e., users with revoked certificates).

    To prevent the use of untrusted certificates, the certificates on a smartcard card MUST meet the following criteria: its issuer has a system-trusted certificate, the certificate is not expired, its "valid-after" date is in the past, and it passes Certificate Revocation List (CRL) and Online Certificate Status Protocol (OCSP) checking.

    By setting the smartcard certificate trust level to moderate, the system will execute a soft revocation, i.e., if the OCSP/CRL server is unreachable, authentication will still succeed.

    NOTE: Before applying this setting, please see the smartcard supplemental guidance.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Smartcard Authentication
  platforms: macOS
  platform: darwin
  description: 'Smartcard authentication MUST be enforced.

    The use of smartcard credentials facilitates standardization and reduces the risk of unauthorized access.

    When enforceSmartCard is set to "true", the smartcard must be used for login, authorization, and unlocking the screensaver.

    CAUTION: enforceSmartCard will apply to the whole system. No users will be able to login with their password unless the profile is removed or a user is exempt from smartcard enforcement.

    NOTE: enforceSmartcard requires allowSmartcard to be set to true in order to work.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Password Authentication for SSH
  platforms: macOS
  platform: darwin
  description: 'If remote login through SSH is enabled, password based authentication MUST be disabled for user login.

    All users MUST go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

    NOTE: /etc/ssh/sshd_config will be automatically modified to its original state following any update or major upgrade to the operating system.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    echo "passwordauthentication no" >> "${includedir}01-mscp-sshd.conf"

    echo "kbdinteractiveauthentication no" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Address Book
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Contacts.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data, and, therefore, automated contact synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the System Setting for Apple ID
  platforms: macOS
  platform: darwin
  description: 'The system setting for Apple ID MUST be disabled.

    Disabling the system setting prevents login to Apple ID and iCloud.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Bookmarks
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Safari.app bookmark synchronization via the iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated bookmark synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the iCloud Calendar Services
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Calendar.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated calendar synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Document Sync
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in iCloud document synchronization service MUST be disabled to prevent organizational data from being synchronized to personal or non-approved storage.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated document synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the iCloud Freeform Services
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Freeform.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated calendar synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Game Center
  platforms: macOS
  platform: darwin
  description: 'This works only with supervised devices (MDM) and allows to disable Apple Game Center. The rationale is Game Center is using Apple ID and will shared data on AppleID based services, therefore, Game Center MUST be disabled.

    This setting also prohibits functionality of adding friends to Game Center.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Keychain Sync
  platforms: macOS
  platform: darwin
  description: 'The macOS system''s ability to automatically synchronize a user''s passwords to their iCloud account MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, password management and synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Mail
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Mail.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated mail synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Notes
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Notes.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated Notes synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Photo Library
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Photos.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated photo synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Private Relay
  platforms: macOS
  platform: darwin
  description: 'Enterprise networks may be required to audit all network traffic by policy, therefore, iCloud Private Relay MUST be disabled.

    Network administrators can also prevent the use of this feature by blocking DNS resolution of mask.icloud.com and mask-h2.icloud.com.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Reminders
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Reminders.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated reminders synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Desktop and Document Folder Sync
  platforms: macOS
  platform: darwin
  description: 'The macOS system''s ability to automatically synchronize a user''s desktop and documents folder to their iCloud Drive MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated file synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.1.1.3 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable AppleID and Internet Account Modifications
  platforms: macOS
  platform: darwin
  description: "The system MUST disable account modification. \nAccount modification includes adding additional or modifying internet accounts in Apple Mail, Calendar, Contacts, in the Internet Account System Setting Pane, or the AppleID System Setting Pane.\nThis prevents the addition of unauthorized accounts.\n[IMPORTANT]\n====\nSome organizations may allow the use and configuration of the built-in Mail.app, Calendar.app, and Contacts.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the Internet Accounts System Preference pane to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.\n===="
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable AirDrop
  platforms: macOS
  platform: darwin
  description: 'AirDrop MUST be disabled to prevent file transfers to or from unauthorized devices.

    AirDrop allows users to share and receive files from other nearby Apple devices.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.1.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple ID Setup during Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for Apple ID setup during Setup Assistant MUST be disabled.

    macOS will automatically prompt new users to set up an Apple ID while they are going through Setup Assistant if this is not disabled, misleading new users to think they need to create Apple ID accounts upon their first login.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Apple System Log Files Owned by Root and Group to Wheel
  platforms: macOS
  platform: darwin
  description: 'The Apple System Logs (ASL) MUST be owned by root.

    ASL logs contain sensitive data about the system and users. If ASL log files are set to only be readable and writable by system administrators, the risk is mitigated.'
  resolution: /usr/sbin/chown root:wheel $(/usr/bin/stat -f '%Su:%Sg:%N' $(/usr/bin/grep -e '^>' /etc/asl.conf /etc/asl/* | /usr/bin/awk '{ print $2 }') 2> /dev/null | /usr/bin/awk '!/^root:wheel:/{print $1}' | /usr/bin/awk -F":" '!/^root:wheel:/{print $3}')
  query: SELECT 1 FROM file WHERE path LIKE '/etc/%' OR path LIKE '/var/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Apple System Log Files To Mode 640 or Less Permissive
  platforms: macOS
  platform: darwin
  description: The Apple System Logs (ASL) MUST be configured to be writable by root and readable only by the root user and group wheel. To achieve this, ASL log files MUST be configured to mode 640 permissive or less; thereby preventing normal users from reading, modifying or deleting audit logs. System logs frequently contain sensitive information that could be used by an attacker. Setting the correct permissions mitigates this risk.
  resolution: /bin/chmod 640 $(/usr/bin/stat -f '%A:%N' $(/usr/bin/grep -e '^>' /etc/asl.conf /etc/asl/* | /usr/bin/awk '{ print $2 }') 2> /dev/null | /usr/bin/awk -F":" '!/640/{print $2}')
  query: SELECT 1 FROM file WHERE path LIKE '/etc/%' OR path LIKE '/var/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Authenticated Root
  platforms: macOS
  platform: darwin
  description: 'Authenticated Root MUST be enabled.

    When Authenticated Root is enabled the macOS is booted from a signed volume that is cryptographically protected to prevent tampering with the system volume.

    NOTE: Authenticated Root is enabled by default on macOS systems.

    WARNING: If more than one partition with macOS is detected, the csrutil command will hang awaiting input.'
  resolution: '/usr/bin/csrutil authenticated-root enable

    NOTE: To re-enable "Authenticated Root", boot the affected system into "Recovery" mode, launch "Terminal" from the "Utilities" menu, and run the command.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.4 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Blank Blu Ray
  platforms: macOS
  platform: darwin
  description: 'Blank Blu Ray media MUST be disabled.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Blank CD
  platforms: macOS
  platform: darwin
  description: 'Blank CD media MUST be disabled.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Blank DVD
  platforms: macOS
  platform: darwin
  description: 'Blank DVD media MUST be disabled.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Blu Ray Read Only
  platforms: macOS
  platform: darwin
  description: 'Blu Ray media MUST be set to read only.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Bonjour Multicast
  platforms: macOS
  platform: darwin
  description: Bonjour multicast advertising MUST be disabled to prevent the system from broadcasting its presence and available services over network interfaces.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_4.1 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Burn Support
  platforms: macOS
  platform: darwin
  description: 'Burn support MUST be disabled.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Calendar.app
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Calendar.app MUST be disabled as this application can establish a connection to non-approved services. This rule is in place to prevent inadvertent data transfers.

    [IMPORTANT]

    ====

    Some organizations allow the use of the built-in Calendar.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the macOS built-in Calendar.app to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.applicationaccess.new.yaml#L67-L70[application restriction controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce CD Read Only
  platforms: macOS
  platform: darwin
  description: 'CD media MUST be set to read only.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Issue or Obtain Public Key Certificates from an Approved Service Provider
  platforms: macOS
  platform: darwin
  description: The organization MUST issue or obtain public key certificates from an organization-approved service provider and ensure only approved trust anchors are in the System Keychain.
  resolution: Obtain the approved certificates from the appropriate authority and install them to the System Keychain.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Installation of XProtect Remediator and Gatekeeper Updates Automatically
  platforms: macOS
  platform: darwin
  description: 'Software Update MUST be configured to update XProtect Remediator and Gatekeeper automatically.

    This setting enforces definition updates for XProtect Remediator and Gatekeeper; with this setting in place, new malware and adware that Apple has added to the list of malware or untrusted software will not execute. These updates do not require the computer to be restarted.

    link:https://support.apple.com/en-us/HT207005[]

    NOTE: Software update will automatically update XProtect Remediator and Gatekeeper by default in the macOS.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Installation of Configuration Profiles through the User Interface
  platforms: macOS
  platform: darwin
  description: Installation of configuration profiles through the user interface MUST be disabled and only be permitted through an authorized MDM server.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Dictation
  platforms: macOS
  platform: darwin
  description: Dictation MUST be disabled on Intel based Macs as the feature On Device Dictation is only available on Apple Silicon devices.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Disk Images
  platforms: macOS
  platform: darwin
  description: 'Disk images MUST be disabled.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable DVD-RAM
  platforms: macOS
  platform: darwin
  description: 'DVD-RAM media MUST be disabled.

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Erase Content and Settings
  platforms: macOS
  platform: darwin
  description: Erase Content and Settings MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Access to External Storage Must Be Defined
  platforms: macOS
  platform: darwin
  description: "Access to external storage MUST be managed. \nNOTE: Apple's built in method using declative device management method only allows you to set external storage manament to Allowed, ReadOnly, and Disallowed."
  resolution: This is implemented by Declarative Device Management (DDM).
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable FaceTime.app
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in FaceTime.app MUST be disabled.

    The FaceTime.app establishes a connection to Apple''s iCloud service, even when security controls have been put in place to disable iCloud access.

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.applicationaccess.new.yaml#L67-L70[application restriction controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable FileVault Automatic Login
  platforms: macOS
  platform: darwin
  description: 'If FileVault is enabled, automatic login MUST be disabled, so that both FileVault and login window authentication are required.

    The default behavior of macOS when FileVault is enabled is to automatically log in to the computer once successfully passing your FileVault credentials.

    NOTE: DisableFDEAutoLogin does not have to be set on Apple Silicon based macOS systems that are smartcard enforced as smartcards are available at pre-boot.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Control Connections to Other Systems via a Deny-All and Allow-by-Exception Firewall Policy
  platforms: macOS
  platform: darwin
  description: 'A deny-all and allow-by-exception firewall policy MUST be employed for managing connections to other systems.

    Organizations MUST ensure the built-in packet filter firewall is configured correctly to employ the default deny rule.

    Failure to restrict network connectivity to authorized systems permits inbound connections from malicious systems. It also permits outbound connections that may facilitate the exfiltration of data.

    If you are using a third-party firewall solution, this setting does not apply.

    [IMPORTANT]

    ====

    Configuring the built-in packet filter firewall to employ the default deny rule has the potential to interfere with applications on the system in an unpredictable manner. Information System Security Officers (ISSOs) may make the risk-based decision not to configure the built-in packet filter firewall to employ the default deny rule to avoid losing functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ===='
  resolution: 'NOTE: See the firewall supplemental which includes a script that has an example policy to implement this rule.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Firmware Password
  platforms: macOS
  platform: darwin
  description: 'A firmware password MUST be enabled and set.

    Single user mode, recovery mode, the Startup Manager, and several other tools are available on macOS by holding the "Option" key down during startup. Setting a firmware password restricts access to these tools.

    To set a firmware passcode use the following command:

    /usr/sbin/firmwarepasswd -setpasswd

    NOTE: If firmware password or passcode is forgotten, the only way to reset the forgotten password is through the use of a machine specific binary generated and provided by Apple. Schedule a support call, and provide proof of purchase before the firmware binary will be generated.

    NOTE: Firmware passwords are not supported on Apple Silicon devices. This rule is only applicable to Intel devices.'
  resolution: 'NOTE: See discussion on remediation and how to enable firmware password.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Gatekeeper
  platforms: macOS
  platform: darwin
  description: 'Gatekeeper MUST be enabled.

    Gatekeeper is a security feature that ensures that applications are digitally signed by an Apple-issued certificate before they are permitted to run. Digital signatures allow the macOS host to verify that the application has not been modified by a malicious third party.

    Administrator users will still have the option to override these settings on a case-by-case basis.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Genmoji AI Creation
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Genmoji MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Handoff
  platforms: macOS
  platform: darwin
  description: 'Handoff MUST be disabled.

    Handoff allows you to continue working on a document or project when the user switches from one Apple device to another. Disabling Handoff prevents data transfers to unauthorized devices.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure User's Home Folders to Apple's Default
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to prevent access to other user''s home folders.

    Configuring the operating system to use the most restrictive permissions possible for user home directories helps to protect against inadvertent disclosures.'
  resolution: 'Configure the macOS system to set the appropriate permissions for each user on the system with the following command:

    /usr/sbin/diskutil resetUserPermissions / DeviceNode UID, where "DeviceNode UID" is the ID number for the user whose home directory permissions need to be repaired.

    NOTE: Using the /usr/sbin/diskutil resetUserPermissions command will only reset the permissions on the default folder set. Other folders in the home directory will not be affected.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Secure User's Home Folders
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to prevent access to other user''s home folders.

    The default behavior of macOS is to allow all valid users access to the top level of every other user''s home folder while restricting access only to the Apple default folders within.'
  resolution: 'IFS=$''\n''

    for userDirs in $( /usr/bin/find /System/Volumes/Data/Users -mindepth 1 -maxdepth 1 -type d ! \( -perm 700 -o -perm 711 \) | /usr/bin/grep -v "Shared" | /usr/bin/grep -v "Guest" ); do

    /bin/chmod og-rwx "$userDirs"

    done

    unset IFS'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Built-in Web Server
  platforms: macOS
  platform: darwin
  description: 'The built-in web server which is managed by launchd is a non-essential service built into macOS and MUST be disabled and not running.

    NOTE: The built in web server service is disabled at startup by default macOS.'
  resolution: '/usr/sbin/apachectl stop 2>/dev/null

    /bin/launchctl disable system/org.apache.httpd'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_4.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Storage Setup during Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt to set up iCloud storage services during Setup Assistant MUST be disabled.

    The default behavior of macOS is to prompt new users to set up storage in iCloud. Disabling the iCloud storage setup prompt provides organizations more control over the storage of their data.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Image Playground
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Image Playground MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Install.log Retention to $ODV
  platforms: macOS
  platform: darwin
  description: The install.log MUST be configured to require records be kept for a organizational defined value before deletion, unless the system uses a central audit record storage facility.
  resolution: '/usr/bin/sed -i '''' "s/\ file \/var\/log\/install.log./\* file \/var\/log\/install.log format=''\$\(\(Time\)\(JZ\)\) \$Host \$\(Sender\)\[\$\(PID\\)\]: \$Message'' rotate=utc compress filemax=50M sizeonly ttl=$ODV/g" /etc/asl/com.apple.install

    NOTE: If there are multiple configuration files in /etc/asl that are set to process the file /var/log/install.log, these files will have to be manually removed.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_3.3 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iPhone Mirroring
  platforms: macOS
  platform: darwin
  description: iPhone Mirroing MUST be disabled to prevent file transfers to or from unauthorized devices. Disabling iPhone Mirroring also prevents potentially unauthorized applications from appearing as if they are installed on the Mac.
  resolution: This is implemented by a Configuration Profile
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Infrared (IR) support
  platforms: macOS
  platform: darwin
  description: 'Infrared (IR) support MUST be disabled to prevent users from controlling the system with IR devices.

    By default, if IR is enabled, the system will accept IR control from any remote device.

    NOTE: This is applicable only to models of Mac Mini systems earlier than Mac Mini8,1.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prevent AdminHostInfo from Being Available at Login Window
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to not display sensitive information at the login window. If the key AdminHostInfo is configured with a string value, it will allow the HostName, IP Address, and operating system version and build to be displayed when clicking on the clock area of the login window.

    Configuring this key to be an integer value, since it expects a string value, will effectively disable the behavior.

    NOTE: This configuration requires it to be deployed via Managed Preferences rather than directly to com.apple.loginwindow.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Mail App
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Mail.app MUST be disabled.

    The Mail.app contains functionality that can establish connections to Apple''s iCloud, even when security controls to disable iCloud access have been put in place.

    [IMPORTANT]

    ====

    Some organizations allow the use of the built-in Mail.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the macOS built-in Mail.app to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.applicationaccess.new.yaml#L67-L70[application restriction controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Mail Smart Replies
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Mail Smart Replies that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Mail Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Apple Mail Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.3 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Enrollment in Mobile Device Management
  platforms: macOS
  platform: darwin
  description: 'You MUST enroll your Mac in a Mobile Device Management (MDM) software.

    User Approved MDM (UAMDM) enrollment or enrollment via Apple Business Manager (ABM)/Apple School Manager (ASM) is required to manage certain security settings. Currently these include:

    Allowed Kernel Extensions

    Allowed Approved System Extensions

    Privacy Preferences Policy Control Payload

    ExtensibleSingleSignOn

    FDEFileVault

    In macOS 11, UAMDM grants Supervised status on a Mac, unlocking the following MDM features, which were previously locked behind ABM:

    Activation Lock Bypass

    Access to Bootstrap Tokens

    Scheduling Software Updates

    * Query list and delete local users'
  resolution: Ensure that system is enrolled via UAMDM.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Messages App
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Messages.app MUST be disabled.

    The Messages.app establishes a connection to Apple''s iCloud service, even when security controls to disable iCloud access have been put in place.

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.applicationaccess.new.yaml#L67-L70[application restriction controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System Log Files Owned by Root and Group to Wheel
  platforms: macOS
  platform: darwin
  description: 'The system log files MUST be owned by root.

    System logs contain sensitive data about the system and users. If log files are set to only be readable and writable by system administrators, the risk is mitigated.'
  resolution: /usr/sbin/chown root:wheel $(/usr/bin/stat -f '%Su:%Sg:%N' $(/usr/bin/grep -v '^#' /etc/newsyslog.conf | /usr/bin/awk '{ print $1 }') 2> /dev/null | /usr/bin/awk -F":" '!/^root:wheel:/{print $3}')
  query: SELECT 1 FROM file WHERE path LIKE '/etc/%' OR path LIKE '/var/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure System Log Files to Mode 640 or Less Permissive
  platforms: macOS
  platform: darwin
  description: The system logs MUST be configured to be writable by root and readable only by the root user and group wheel. To achieve this, system log files MUST be configured to mode 640 permissive or less; thereby preventing normal users from reading, modifying or deleting audit logs. System logs frequently contain sensitive information that could be used by an attacker. Setting the correct permissions mitigates this risk.
  resolution: /bin/chmod 640 $(/usr/bin/stat -f '%A:%N' $(/usr/bin/grep -v '^#' /etc/newsyslog.conf | /usr/bin/awk '{ print $1 }') 2> /dev/null | /usr/bin/awk '!/640/{print $1}' | awk -F":" '!/640/{print $2}')
  query: SELECT 1 FROM file WHERE path LIKE '/etc/%' OR path LIKE '/var/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Network File System Service
  platforms: macOS
  platform: darwin
  description: Support for Network File Systems (NFS) services is non-essential and, therefore, MUST be disabled.
  resolution: '/bin/launchctl disable system/com.apple.nfsd

    /bin/rm -rf /etc/exports

    The system may need to be restarted for the update to take effect.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_4.3 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Notes Transcription
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Notes Transcription that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.4 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Notes Transcription Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Notes Transcription Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.4 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce On Device Dictation
  platforms: macOS
  platform: darwin
  description: 'Dictation MUST be restricted to on device only to prevent potential data exfiltration.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.18.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Parental Controls
  platforms: macOS
  platform: darwin
  description: 'Parental Controls MUST be enabled.

    Control of program execution is a mechanism used to prevent program execution of unauthorized programs, which is critical to maintaining a secure system baseline.

    Parental Controls on the macOS consist of many different payloads, which are set individually depending on the type of control required. Enabling parental controls allows for further configuration of these restrictions.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Password Autofill
  platforms: macOS
  platform: darwin
  description: 'Password Autofill MUST be disabled.

    macOS allows users to save passwords and use the Password Autofill feature in Safari and compatible apps. To protect against malicious users gaining access to the system, this feature MUST be disabled to prevent users from being prompted to save passwords in applications.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Remove Password Hint From User Accounts
  platforms: macOS
  platform: darwin
  description: User accounts MUST not contain password hints.
  resolution: 'for u in $(/usr/bin/dscl . -list /Users UniqueID | /usr/bin/awk ''$2 > 500 {print $1}''); do

    /usr/bin/dscl . -delete /Users/$u hint

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.12.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Proximity Based Password Sharing Requests
  platforms: macOS
  platform: darwin
  description: 'Proximity based password sharing requests MUST be disabled.

    The default behavior of macOS is to allow users to request passwords from other known devices (macOS and iOS). This feature MUST be disabled to prevent passwords from being shared.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Password Sharing
  platforms: macOS
  platform: darwin
  description: 'Password Sharing MUST be disabled.

    The default behavior of macOS is to allow users to share a password over Airdrop between other macOS and iOS devices. This feature MUST be disabled to prevent passwords from being shared.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Photos Enhanced Visual Search
  platforms: macOS
  platform: darwin
  description: 'Enhanced Visualed Search MUST be disabled in the Photos app.

    The information system MUST be configured to provide only essential capabilities. Disabling Enhanced Visual Search will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Display Policy Banner at Login Window
  platforms: macOS
  platform: darwin
  description: 'Displaying a standardized and approved use notification before granting access to the operating system ensures that users are provided with privacy and security notification verbiage that is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

    System use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.

    The policy banner will show if a "PolicyBanner.rtf" or "PolicyBanner.rtfd" exists in the "/Library/Security" folder.

    The banner text of the document MUST read:

    $ODV'
  resolution: 'bannerText="$ODV"

    /bin/mkdir /Library/Security/PolicyBanner.rtfd

    /usr/bin/textutil -convert rtf -output /Library/Security/PolicyBanner.rtfd/TXT.rtf -stdin <<EOF

    $bannerText

    EOF'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.8 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Display Policy Banner at Remote Login
  platforms: macOS
  platform: darwin
  description: 'Remote login service MUST be configured to display a policy banner at login.

    Displaying a standardized and approved use notification before granting access to the operating system ensures that users are provided with privacy and security notification verbiage that is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

    System use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.'
  resolution: 'bannerText="$ODV"

    /bin/echo "${bannerText}" > /etc/banner'
  query: SELECT 1 FROM file WHERE path LIKE '/etc/%' OR path LIKE '/var/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce SSH to Display Policy Banner
  platforms: macOS
  platform: darwin
  description: 'SSH MUST be configured to display a policy banner.

    Displaying a standardized and approved use notification before granting access to the operating system ensures that users are provided with privacy and security notification verbiage that is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

    System use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist

    NOTE: /etc/ssh/sshd_config will be automatically modified to its original state following any update or major upgrade to the operating system.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''banner /etc/banner'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "banner /etc/banner" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1 FROM file WHERE path LIKE '/etc/%' OR path LIKE '/var/%';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Power Nap
  platforms: macOS
  platform: darwin
  description: 'Power Nap MUST be disabled.

    NOTE: Power Nap allows your Mac to perform actions while a Mac is asleep. This can interfere with USB power and may cause devices such as smartcards to stop functioning until a reboot and must therefore be disabled on all applicable systems.

    The following Macs support Power Nap:

    MacBook (Early 2015 and later)

    MacBook Air (Late 2010 and later)

    MacBook Pro (all models with Retina display)

    Mac mini (Late 2012 and later)

    iMac (Late 2012 and later)

    Mac Pro (Late 2013 and later)'
  resolution: /usr/bin/pmset -a powernap 0
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.10.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Privacy Setup Services During Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for Privacy Setup services during Setup Assistant MUST be disabled.

    Organizations MUST apply organization-wide configuration settings. The macOS Privacy Setup services prompt guides new users through enabling their own specific privacy settings; this is not essential and, therefore, MUST be disabled to prevent against the risk of individuals electing privacy settings with the potential to override organization-wide settings.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Rapid Security Response Mechanism
  platforms: macOS
  platform: darwin
  description: Rapid security response mechanism MUST be enabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable User Ability from Being Able to Undo Rapid Security Responses
  platforms: macOS
  platform: darwin
  description: Rapid security response (RSR) mechanism MUST be enabled and the ability for the user to disable RSR MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Recovery Lock
  platforms: macOS
  platform: darwin
  description: 'A recovery lock password MUST be enabled and set.

    Single user mode, recovery mode, the Startup Manager, and several other tools are available on macOS by holding down specific key combinations during startup. Setting a recovery lock restricts access to these tools.

    IMPORTANT: Recovery lock passwords are not supported on Intel devices. This rule is only applicable to Apple Silicon devices.'
  resolution: 'NOTE: The SetRecoveryLock command can be used to set a Recovery Lock password and must be from your MDM.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Removable Storage Devices
  platforms: macOS
  platform: darwin
  description: 'Removable media, such as USB connected external hard drives, thumb drives, and optical media, MUST be disabled for users.

    Disabling removable storage devices reduces the risks and known vulnerabilities of such devices (e.g., malicious code insertion)

    [IMPORTANT]

    ====

    Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ====

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.systemuiserver.yaml#L4-L8[media mount controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Root Login
  platforms: macOS
  platform: darwin
  description: 'To assure individual accountability and prevent unauthorized access, logging in as root at the login window MUST be disabled.

    The macOS system MUST require individuals to be authenticated with an individual authenticator prior to using a group authenticator, and administrator users MUST never log in directly as root.'
  resolution: /usr/bin/dscl . -create /Users/root UserShell /usr/bin/false
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.6 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Safari Reader Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Safari Reader Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Screen Saver at Login Window
  platforms: macOS
  platform: darwin
  description: A default screen saver MUST be configured to display at the login window and MUST not display any sensitive information.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce FileVault in Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'FileVault MUST be enforced in Setup Assistant.

    The information system implements cryptographic mechanisms to protect the confidentiality and integrity of information stored on digital media during transport outside of controlled areas.'
  resolution: 'NOTE: See the FileVault supplemental to implement this rule.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure System Integrity Protection is Enabled
  platforms: macOS
  platform: darwin
  description: 'System Integrity Protection (SIP) MUST be enabled.

    SIP is vital to protecting the integrity of the system as it prevents malicious users and software from making unauthorized and/or unintended modifications to protected files and folders; ensures the presence of an audit record generation capability for defined auditable events for all operating system components; protects audit tools from unauthorized access, modification, and deletion; restricts the root user account and limits the actions that the root user can perform on protected parts of the macOS; and prevents non-privileged users from granting other users direct access to the contents of their home directories and folders.

    NOTE: SIP is enabled by default in macOS.'
  resolution: '/usr/bin/csrutil enable

    NOTE: To reenable "System Integrity Protection", boot the affected system into "Recovery" mode, launch "Terminal" from the "Utilities" menu, and run the command.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Siri Setup during Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for Siri during Setup Assistant MUST be disabled.

    Organizations MUST apply organization-wide configuration settings. The macOS Siri Assistant Setup prompt guides new users through enabling their own specific Siri settings; this is not essential and, therefore, MUST be disabled to prevent against the risk of individuals electing Siri settings with the potential to override organization-wide settings.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence During Setup Assistant
  platforms: macOS
  platform: darwin
  description: The prompt for setting up Apple Intelligence during Setup Assistant MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Screen Time Prompt During Setup Assistant
  platforms: macOS
  platform: darwin
  description: The prompt for Screen Time setup during Setup Assistant MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Unlock with Apple Watch During Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for Apple Watch unlock setup during Setup Assistant MUST be disabled.

    Disabling Apple watches is a necessary step to ensuring that the information system retains a session lock until the user reestablishes access using an authorized identification and authentication procedures.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Limit SSH to FIPS Compliant Connections
  platforms: macOS
  platform: darwin
  description: 'SSH MUST be configured to limit the Ciphers, HostbasedAcceptedAlgorithms, HostKeyAlgorithms, KexAlgorithms, MACs, PubkeyAcceptedAlgorithms, CASignatureAlgorithms to algorithms that are FIPS 140 validated.

    FIPS 140-3 is the current standard for validating that mechanisms used to access cryptographic modules utilize authentication that meet federal requirements.

    Operating systems utilizing encryption MUST use FIPS validated mechanisms for authenticating to cryptographic modules.

    NOTE: For more information on FIPS compliance with the version of SSH included in the macOS, the manual page applesshand_fips has additional information.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'if [ -f /etc/ssh/crypto.conf ] && /usr/bin/grep -q "Include /etc/ssh/crypto.conf" /etc/ssh/sshconfig.d/100-macos.conf 2>/dev/null; then

    /bin/ln -fs /etc/ssh/crypto/fips.conf /etc/ssh/crypto.conf

    fi

    includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshconfig | /usr/bin/tr -d '''')

    fipssshconfig=("Ciphers aes128-gcm@openssh.com" "HostbasedAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com" "HostKeyAlgorithms ecdsa-sha2-nistp256-cert-v01@openssh.com,sk-ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp256,sk-ecdsa-sha2-nistp256@openssh.com" "KexAlgorithms ecdh-sha2-nistp256" "MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-256" "PubkeyAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com,sk-ecdsa-sha2-nistp256-cert-v01@openssh.com" "CASignatureAlgorithms ecdsa-sha2-nistp256,sk-ecdsa-sha2-nistp256@openssh.com")

    for sshconfig in $fipssshconfig; do

    sshsetting=$(echo $sshconfig | /usr/bin/cut -d " " -f1)

    /usr/bin/grep -qEi "^$sshsetting" "${includedir}01-mscp-ssh.conf" && /usr/bin/sed -i "" "s/^$sshsetting./${sshconfig}/" "${includedir}01-mscp-ssh.conf" || echo "$sshconfig" >> "${includedir}01-mscp-ssh.conf"

    for u in $(/usr/bin/dscl . list /users shell | /usr/bin/egrep -v ''(^)|(root)|(/usr/bin/false)'' | /usr/bin/awk ''{print $1}''); do

    config=$(/usr/bin/sudo -u $u /usr/bin/ssh -Gv . 2>&1)

    configfiles=$(echo "$config" | /usr/bin/awk ''/Reading configuration data/ {print $NF}''| /usr/bin/tr -d ''\r'')

    configarray=( ${(f)configfiles} )

    if ! echo $config | /usr/bin/grep -q -i "$sshconfig" ; then

    for c in $configarray; do

    if [[ "$c" == "/etc/ssh/crypto.conf" ]]; then

    continue

    fi

    /usr/bin/sudo -u $u /usr/bin/grep -qEi "^$sshsetting" "$c" && /usr/bin/sed -i "" "s/^$sshsetting.*/${sshconfig}/I" "$c"

    if [[ "$c" =~ ".ssh/config" ]]; then

    if /usr/bin/grep -qEi "$sshsetting" "$c" 2> /dev/null; then

    oldfile=$(cat ~$u/.ssh/config)

    echo "$sshconfig" > ~$u/.ssh/config

    echo "$oldfile" >> ~$u/.ssh/config

    fi

    fi

    done

    fi

    done

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Set SSH Active Server Alive Maximum to $ODV
  platforms: macOS
  platform: darwin
  description: 'SSH MUST be configured with an Active Server Alive Maximum Count set to $ODV. Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session or an incomplete login attempt will also free up resources committed by the managed network element.

    NOTE: /etc/ssh/ssh_config will be automatically modified to its original state following any update or major upgrade to the operating system.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshconfig | /usr/bin/tr -d '''')

    sshconfig=("ServerAliveCountMax $ODV")

    sshsetting=$(echo $sshconfig | /usr/bin/cut -d " " -f1)

    /usr/bin/grep -qEi "^$sshsetting" "${includedir}01-mscp-ssh.conf" && /usr/bin/sed -i "" "s/^$sshsetting./${sshconfig}/" "${includedir}01-mscp-ssh.conf" || echo "$sshconfig" >> "${includedir}01-mscp-ssh.conf"

    for u in $(/usr/bin/dscl . list /users shell | /usr/bin/egrep -v ''(^)|(root)|(/usr/bin/false)'' | /usr/bin/awk ''{print $1}''); do

    config=$(/usr/bin/sudo -u $u /usr/bin/ssh -Gv . 2>&1)

    configfiles=$(echo "$config" | /usr/bin/awk ''/Reading configuration data/ {print $NF}''| /usr/bin/tr -d ''\r'')

    configarray=( ${(f)configfiles} )

    if ! echo $config | /usr/bin/grep -q -i "$sshconfig" ; then

    for c in $configarray; do

    if [[ "$c" == "/etc/ssh/crypto.conf" ]]; then

    continue

    fi

    /usr/bin/sudo -u $u /usr/bin/grep -qEi "^$sshsetting" "$c" && /usr/bin/sed -i "" "s/^$sshsetting.*/${sshconfig}/I" "$c"

    if [[ "$c" =~ ".ssh/config" ]]; then

    if /usr/bin/grep -qEi "$sshsetting" "$c" 2> /dev/null; then

    oldfile=$(cat ~$u/.ssh/config)

    echo "$sshconfig" > ~$u/.ssh/config

    echo "$old_file" >> ~$u/.ssh/config

    fi

    fi

    done

    fi

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure SSH ServerAliveInterval option set to $ODV
  platforms: macOS
  platform: darwin
  description: 'SSH MUST be configured with an Active Server Alive Maximum Count set to $ODV.

    Setting the Active Server Alive Maximum Count to $ODV will log users out after a $ODV seconds interval of inactivity.

    NOTE: /etc/ssh/ssh_config will be automatically modified to its original state following any update or major upgrade to the operating system.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshconfig | /usr/bin/tr -d '''')

    sshconfigstring=("ServerAliveInterval $ODV")

    for sshconfig in $sshconfigstring; do

    sshsetting=$(echo $sshconfig | /usr/bin/cut -d " " -f1)

    /usr/bin/grep -qEi "^$sshsetting" "${includedir}01-mscp-ssh.conf" && /usr/bin/sed -i "" "s/^$sshsetting./${sshconfig}/" "${includedir}01-mscp-ssh.conf" || echo "$sshconfig" >> "${includedir}01-mscp-ssh.conf"

    for u in $(/usr/bin/dscl . list /users shell | /usr/bin/egrep -v ''(^)|(root)|(/usr/bin/false)'' | /usr/bin/awk ''{print $1}''); do

    config=$(/usr/bin/sudo -u $u /usr/bin/ssh -Gv . 2>&1)

    configfiles=$(echo "$config" | /usr/bin/awk ''/Reading configuration data/ {print $NF}''| /usr/bin/tr -d ''\r'')

    configarray=( ${(f)configfiles} )

    if ! echo $config | /usr/bin/grep -q -i "$sshconfig" ; then

    for c in $configarray; do

    if [[ "$c" == "/etc/ssh/crypto.conf" ]]; then

    continue

    fi

    /usr/bin/sudo -u $u /usr/bin/grep -qEi "^$sshsetting" "$c" && /usr/bin/sed -i "" "s/^$sshsetting.*/${sshconfig}/I" "$c"

    if [[ "$c" =~ ".ssh/config" ]]; then

    if /usr/bin/grep -qEi "$sshsetting" "$c" 2> /dev/null; then

    oldfile=$(cat ~$u/.ssh/config)

    echo "$sshconfig" > ~$u/.ssh/config

    echo "$old_file" >> ~$u/.ssh/config

    fi

    fi

    done

    fi

    done

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure SSHD Channel Timeout to $ODV
  platforms: macOS
  platform: darwin
  description: 'If SSHD is enabled it MUST be configured with session ChannelTime out set to $ODV.

    This will set the time out when the session is inactive.

    NOTE: /etc/ssh/sshd_config will be automatically modified to its original state following any update or major upgrade to the operating system.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''channeltimeout $ODV'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "channeltimeout $ODV" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure SSHD ClientAliveCountMax to $ODV
  platforms: macOS
  platform: darwin
  description: 'If SSHD is enabled it MUST be configured with the Client Alive Maximum Count set to $ODV.

    This will set the number of client alive messages which may be sent without the SSH server receiving any messages back from the client.  If this threshold is reached while client alive messages are being sent, the SSH server will disconnect the client, terminating the session.  The client alive messages are sent through the encrypted channel and therefore will not be spoofable.  The client alive mechanism is valuable when the client or server depend on knowing when a connection has become unresponsive.

    NOTE: This setting is not intended to manage idle user sessions where there is no input from the client. Its purpose is to monitor for interruptions in network connectivity and force the session to terminate after the connection appears to be broken.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''clientalivecountmax $ODV'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "clientalivecountmax $ODV" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure SSHD ClientAliveInterval to $ODV
  platforms: macOS
  platform: darwin
  description: 'If SSHD is enabled then it MUST be configured with the Client Alive Interval set to $ODV.

    Sets a timeout interval in seconds after which if no data has been received from the client, sshd(8) will send a message through the encrypted channel to request a response from the client.

    This setting works in conjunction with ClientAliveCountMax to determine the termination of the connection after the threshold has been reached.

    NOTE: This setting is not intended to manage idle user sessions where there is no input from the client. Its purpose is to monitor for interruptions in network connectivity and force the session to terminate after the connection appears to be broken.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''clientaliveinterval $ODV'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "clientaliveinterval $ODV" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Limit SSHD to FIPS Compliant Connections
  platforms: macOS
  platform: darwin
  description: 'If SSHD is enabled then it MUST be configured to limit the Ciphers, HostbasedAcceptedAlgorithms, HostKeyAlgorithms, KexAlgorithms, MACs, PubkeyAcceptedAlgorithms, CASignatureAlgorithms to algorithms that are FIPS 140 validated.

    FIPS 140-3 is the current standard for validating that mechanisms used to access cryptographic modules utilize authentication that meet federal requirements.

    Operating systems utilizing encryption MUST use FIPS validated mechanisms for authenticating to cryptographic modules.

    NOTE: For more information on FIPS compliance with the version of SSHD included in the macOS, the manual page applesshand_fips has additional information.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'if [ -f /etc/ssh/crypto.conf ] && /usr/bin/grep -q "Include /etc/ssh/crypto.conf" /etc/ssh/sshdconfig.d/100-macos.conf 2>/bin/null; then

    /bin/ln -fs /etc/ssh/crypto/fips.conf /etc/ssh/crypto.conf

    fi

    includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    fipssshdconfig=("Ciphers aes128-gcm@openssh.com" "HostbasedAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com" "HostKeyAlgorithms ecdsa-sha2-nistp256-cert-v01@openssh.com,sk-ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp256,sk-ecdsa-sha2-nistp256@openssh.com" "KexAlgorithms ecdh-sha2-nistp256" "MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-256" "PubkeyAcceptedAlgorithms ecdsa-sha2-nistp256,ecdsa-sha2-nistp256-cert-v01@openssh.com,sk-ecdsa-sha2-nistp256-cert-v01@openssh.com" "CASignatureAlgorithms ecdsa-sha2-nistp256,sk-ecdsa-sha2-nistp256@openssh.com")

    sshdconfig=$(/usr/sbin/sshd -G)

    for config in $fipssshdconfig; do

    if ! echo $sshdconfig | /usr/bin/grep -q -i "$config" 2>/dev/null; then

    /usr/bin/grep -qxF "$config" "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "$config" >> "${includedir}01-mscp-sshd.conf"

    fi

    done

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${include_dir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Set Login Grace Time to $ODV
  platforms: macOS
  platform: darwin
  description: 'If SSHD is enabled then it MUST be configured to wait only $ODV seconds before timing out logon attempts.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''logingracetime $ODV'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "logingracetime $ODV" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure SSHD PerSourcePenalties
  platforms: macOS
  platform: darwin
  description: 'If SSHD is enabled then it MUST be configured with the Per Source Penalties configured.

    Per Source Penalities controls penalties for various conditions that may represent attacks on sshd.

    Penalties are enabled by default.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''persourcepenalties yes'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "persourcepenalties yes" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Root Login for SSH
  platforms: macOS
  platform: darwin
  description: 'If SSH is enabled to assure individual accountability and prevent unauthorized access, logging in as root via SSH MUST be disabled.

    The macOS system MUST  require individuals to be authenticated with an individual authenticator prior to using a group authenticator, and administrator users MUST never log in directly as root.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''permitrootlogin no'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "permitrootlogin no" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure SSHD Unused Connection Timeout to $ODV
  platforms: macOS
  platform: darwin
  description: 'If SSHD is enabled it MUST be configured with unused connection timeout set to $ODV.

    This will set the time out when there are no open channels within an session.

    NOTE: On macOS 15.2 and higher the SSH configuration can be reset to the macOS default by running /usr/libexec/reset-ssh-configuration.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    /usr/bin/grep -qxF ''unusedconnectiontimeout $ODV'' "${includedir}01-mscp-sshd.conf" 2>/dev/null || echo "unusedconnectiontimeout $ODV" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Sudo To Log Events
  platforms: macOS
  platform: darwin
  description: Sudo MUST be configured to log privilege escalation.
  resolution: '/usr/bin/find /etc/sudoers -type f -exec sed -i '''' ''/^Defaults[[:blank:]]\!logallowed/s/^/# /'' ''{}'' \;

    /bin/echo "Defaults logallowed" >> /etc/sudoers.d/mscp'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.11 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Sudoers Timestamp Type
  platforms: macOS
  platform: darwin
  description: 'The file /etc/sudoers MUST be configured to not include a timestamp_type of global or ppid and be configured for timestamp record types of tty.

    This rule ensures that the "sudo" command will prompt for the administrator''s password at least once in each newly opened terminal window. This prevents a malicious user from taking advantage of an unlocked computer or an abandoned logon session by bypassing the normal password prompt requirement.'
  resolution: /usr/bin/find /etc/sudoers* -type f -exec sed -i '' '/timestamptype/d; /!ttytickets/d' '{}' \;
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure System Volume is Read Only
  platforms: macOS
  platform: darwin
  description: 'The System volume MUST be mounted as read-only in order to ensure that configurations critical to the integrity of the macOS have not been compromised. System Integrity Protection (SIP) will prevent the system volume from being mounted as writable.

    NOTE: The system volume is read only by default in macOS.'
  resolution: 'NOTE: To remount the System volume as Read Only, rebooting the computer will mount it as Read Only.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Trivial File Transfer Protocol Service
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Trivial File Transfer Protocol (TFTP), support it is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling TFTP helps prevent the unauthorized connection of devices and the unauthorized transfer of information.

    NOTE: TFTP service is disabled at startup by default macOS.'
  resolution: "/bin/launchctl bootout system/com.apple.tftpd \n/bin/launchctl disable system/com.apple.tftpd\nThe system may need to be restarted for the update to take effect."
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Time Synchronization Daemon
  platforms: macOS
  platform: darwin
  description: 'The macOS time synchronization daemon (timed) MUST be enabled for proper time synchronization to an authorized time server.

    NOTE: The time synchronization daemon is enabled by default on macOS.'
  resolution: '/bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.timed.plist

    NOTE: The service timed cannot be unloaded or loaded while System Integrity Protection (SIP) is enabled.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.2.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable TouchID Prompt during Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for TouchID during Setup Assistant MUST be disabled.

    macOS prompts new users through enabling TouchID during Setup Assistant; this is not essential and, therefore, MUST be disabled to prevent against the risk of individuals electing to enable TouchID to override organization-wide settings.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Login to Other User's Active and Locked Sessions
  platforms: macOS
  platform: darwin
  description: 'The ability to log in to another user''s active or locked session MUST be disabled.

    macOS has a privilege that can be granted to any user that will allow that user to unlock active user''s sessions. Disabling the admins and/or user''s ability to log into another user''s active and locked session prevents unauthorized persons from viewing potentially sensitive and/or personal information.

    NOTE: Configuring this setting will change the user experience and disable TouchID from unlocking the screensaver. A configuration profile will be generated to include the setting that restores the expected behavior. You can also apply the settings using /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.loginwindow screenUnlockMode -int 1.

    WARNING: This rule may cause issues when platformSSO is configured.'
  resolution: 'SSRULE=$(/usr/bin/security -q authorizationdb read system.login.screensaver 2>&1 | /usr/bin/xmllint --xpath "//dict/key[.=''rule'']/following-sibling::array[1]/string/text()" -)

    if [[ "$SSRULE" == psso ]]; then

    /usr/bin/security -q authorizationdb read psso-screensaver > "/tmp/psso-screensaver-mscp.plist"

    /usr/bin/sed -i.bak ''s/<string>authenticate-session-owner-or-admin<\/string>/<string>$ODV<\/string>/'' /tmp/psso-screensaver-mscp.plist

    /usr/bin/security -q authorizationdb write psso-screensaver-mscp < /tmp/psso-screensaver-mscp.plist

    /usr/bin/security -q authorizationdb write system.login.screensaver psso-screensaver-mscp 2>&1

    else

    /usr/bin/security -q authorizationdb write system.login.screensaver "$ODV" 2>&1

    fi'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.7 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prohibit User Installation of Software into /Users/
  platforms: macOS
  platform: darwin
  description: 'Users MUST not be allowed to install software into /Users/.

    Allowing regular users to install software, without explicit privileges, presents the risk of untested and potentially malicious software being installed on the system. Explicit privileges (escalated or administrative privileges) provide the regular user with explicit capabilities and control that exceeds the rights of a regular user.

    [IMPORTANT]

    ====

    Apple has deprecated the use of link:https://github.com/apple/device-management/blob/eb51fb0cb9626cac4717858556912c257a734ce0/mdm/profiles/com.apple.applicationaccess.new.yaml#L67-L70[application restriction controls], using these controls may not work as expected. Third party software may be required to fulfill the compliance requirements.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Unix-to-Unix Copy Protocol Service
  platforms: macOS
  platform: darwin
  description: 'The system MUST not have the Unix-to-Unix Copy Protocol (UUCP) service active.

    UUCP, a set of programs that enable the sending of files between different UNIX systems as well as sending commands to be executed on another system, is not essential and MUST be disabled in order to prevent the unauthorized connection of devices, transfer of information, and tunneling.

    NOTE: UUCP service is disabled at startup by default macOS.'
  resolution: "/bin/launchctl bootout system/com.apple.uucp \n/bin/launchctl disable system/com.apple.uucp\nThe system may need to be restarted for the update to take effect."
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Writing Tools
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as writing tools that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Limit Consecutive Failed Login Attempts to $ODV
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to limit the number of failed login attempts to a maximum of $ODV. When the maximum number of failed attempts is reached, the account MUST be locked for a period of time after.

    This rule protects against malicious users attempting to gain access to the system via brute-force hacking methods.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Set Account Lockout Time to $ODV Minutes
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to enforce a lockout time period of at least $ODV minutes when the maximum number of failed logon attempts is reached.

    This rule protects against malicious users attempting to gain access to the system via brute-force hacking methods.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Passwords Contain a Minimum of One Numeric Character
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to require at least one numeric character be used when a password is created.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.3 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Passwords to Match the Defined Custom Regular Expression
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to meet complexity requirements defined in $ODV.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.

    NOTE: The configuration profile generated must be installed from an MDM server.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.6 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prohibit Password Reuse for a Minimum of $ODV Generations
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to enforce a password history of at least $ODV previous passwords when a password is created.

    This rule ensures that users are  not allowed to re-use a password that was used in any of the $ODV previous password generations.

    Limiting password reuse protects against malicious users attempting to gain access to the system via brute-force hacking methods.

    NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.8 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Passwords Contain a Minimum of One Lowercase Character
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to require at least one lower-case character be used when a password is created.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.

    NOTE: macOS 14 supports password policy complexity with custom regex deployed with a mobileconfig file. To use a mobileconfig file use pwpolicycustomregex_enforce.'
  resolution: 'This setting may be enforced using local policy or by a directory service.

    To set local policy to require at least $ODV lowercase letter, edit the current password policy to contain the following <dict> within the "policyCategoryPasswordContent":

    <dict>

    <key>policyContent</key>

    <string>policyAttributePassword matches &apos;(.[a-z].){$ODV,}+&apos;</string>

    <key>policyIdentifier</key>

    <string>Must have at least $ODV lowercase letter</string>

    <key>policyParameters</key>

    <dict>

    <key>minimumAlphaCharactersLowerCase</key>

    <integer>$ODV</integer>

    </dict>

    </dict>

    After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the path to the file in place of "$pwpolicyfile".

    /usr/bin/pwpolicy setaccountpolicies $pwpolicyfile

    NOTE: See the password policy supplemental on more information on how to implement password policies on macOS.'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Restrict Maximum Password Lifetime to $ODV Days
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to enforce a maximum password lifetime limit of at least $ODV days.

    This rule ensures that users are forced to change their passwords frequently enough to prevent malicious users from gaining and maintaining access to the system.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.7 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require a Minimum Password Length of $ODV Characters
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to require a minimum of $ODV characters be used when a password is created.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Set Minimum Password Lifetime to $ODV Hours
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to enforce a minimum password lifetime limit of $ODV hours.

    This rule discourages users from cycling through their previous passwords to get back to a preferred one.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.'
  resolution: 'This setting may be enforced using local policy or by a directory service.

    To set local policy to require a minimum password lifetime, edit the current password policy to contain the following <dict> within the "policyCategoryPasswordContent":

    <dict>

    <key>policyContent</key>

    <string>policyAttributeLastPasswordChangeTime &lt; policyAttributeCurrentTime - (policyAttributeMinimumLifetimeHours  60  60)</string>

    <key>policyIdentifier</key>

    <string>Minimum Password Lifetime</string>

    <key>policyParameters</key>

    <dict>

    <key>policyAttributeMinimumLifetimeHours</key>

    <integer>$ODV</integer>

    </dict>

    </dict>

    After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the path to the file in place of "$pwpolicyfile".

    /usr/bin/pwpolicy setaccountpolicies $pwpolicyfile

    NOTE: See the password policy supplemental on more information on how to implement password policies on macOS.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prohibit Repeating, Ascending, and Descending Character Sequences
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to prohibit the use of repeating, ascending, and descending character sequences when a password is created.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.

    NOTE: pwpolicysimplesequence_disable prevents use of passwords which are regularly found in compromised password lists.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Passwords Contain a Minimum of One Special Character
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to require at least one special character be used when a password is created.

    Special characters are those characters that are not alphanumeric. Examples include: ~ ! @ # $ % ^ *.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.2.5 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Passwords Contain a Minimum of One Uppercase Character
  platforms: macOS
  platform: darwin
  description: 'The macOS MUST be configured to require at least one uppercase character be used when a password is created.

    This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

    NOTE: To comply with Executive Order 14028, Improving the Nation''s Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings. Password policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. Password policies must also not require the use of regular rotation. Password policies should define a minimum length. Multifactor authentication should be used where ever possible.

    NOTE: macOS 14 supports password policy complexity with custom regex deployed with a mobileconfig file. To use a mobileconfig file use pwpolicycustomregex_enforce.'
  resolution: 'This setting may be enforced using local policy or by a directory service.

    To set local policy to require at least $ODV lowercase letter, edit the current password policy to contain the following <dict> within the "policyCategoryPasswordContent":

    <dict>

    <key>policyContent</key>

    <string>policyAttributePassword matches &apos;(.[A-Z].){$ODV,}+&apos;</string>

    <key>policyIdentifier</key>

    <string>Must have at least $ODV uppercase letter</string>

    <key>policyParameters</key>

    <dict>

    <key>minimumAlphaCharactersUpperCase</key>

    <integer>$ODV</integer>

    </dict>

    </dict>

    After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the path to the file in place of "$pwpolicyfile".

    /usr/bin/pwpolicy setaccountpolicies $pwpolicyfile

    NOTE: See the password policy supplemental on more information on how to implement password policies on macOS.'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Airplay Receiver
  platforms: macOS
  platform: darwin
  description: 'Airplay Receiver allows you to send content from another Apple device to be displayed on the screen as it''s being played from your other device.

    Support for Airplay Receiver is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.1.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prevent Apple Watch from Terminating a Session Lock
  platforms: macOS
  platform: darwin
  description: 'Apple Watches are not an approved authenticator and their use MUST be disabled.

    Disabling Apple watches is a necessary step to ensuring that the information system retains a session lock until the user reestablishes access using an authorized identification and authentication procedures.

    NOTE: Unlocking the system with an Apple Watch is not an approved authenticator for US Federal Government usage as it has not been verified to meet the strength requirements outlined in NIST SP 800-63.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Unattended or Automatic Logon to the System
  platforms: macOS
  platform: darwin
  description: 'Automatic logon MUST be disabled.

    When automatic logons are enabled, the default user account is automatically logged on at boot time without prompting the user for a password. Even if the screen is later locked, a malicious user would be able to reboot the computer and find it already logged in. Disabling automatic logons mitigates this risk.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.3 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Auto Logout After $ODV Seconds of Inactivity
  platforms: macOS
  platform: darwin
  description: 'Auto logout MUST be configured to automatically terminate a user session and log out the after $ODV seconds of inactivity.

    NOTE:The maximum that macOS can be configured for autologoff is $ODV seconds.

    [IMPORTANT]

    ====

    The automatic logout may cause disruptions to an organization''s workflow and/or loss of data. Information System Security Officers (ISSOs) are advised to first fully weigh the potential risks posed to their organization before opting to disable the automatic logout setting.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Bluetooth When no Approved Device is Connected
  platforms: macOS
  platform: darwin
  description: 'The macOS system MUST be configured to disable Bluetooth unless there is an approved device connected.

    [IMPORTANT]

    ====

    Information System Security Officers (ISSOs) may make the risk-based decision not to disable Bluetooth, so as to maintain necessary functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Bluetooth System Settings Pane
  platforms: macOS
  platform: darwin
  description: The Bluetooth System Setting pane MUST be disabled to prevent access to the bluetooth configuration.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Bluetooth Sharing
  platforms: macOS
  platform: darwin
  description: 'Bluetooth Sharing MUST be disabled.

    Bluetooth Sharing allows users to wirelessly transmit files between the macOS and Bluetooth-enabled devices, including personally owned cellphones and tablets. A malicious user might introduce viruses or malware onto the system or extract sensitive files via Bluetooth Sharing. When Bluetooth Sharing is disabled, this risk is mitigated.

    [NOTE]

    ====

    The check and fix are for the last logged in user. To get the last logged in user, run the following.

    CURRENT_USER=$( /usr/bin/defaults read /Library/Preferences/com.apple.loginwindow lastUserName )

    ===='
  resolution: /usr/bin/sudo -u "$CURRENT_USER" /usr/bin/defaults -currentHost write com.apple.Bluetooth PrefKeyServicesEnabled -bool false
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.10 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Content Caching Service
  platforms: macOS
  platform: darwin
  description: 'Content caching MUST be disabled.

    Content caching is a macOS service that helps reduce Internet data usage and speed up software installation on Mac computers. It is not recommended for devices furnished to employees to act as a caching server.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.8 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Critical Security Updates to be Installed
  platforms: macOS
  platform: darwin
  description: Ensure that security updates are installed as soon as they are available from Apple.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Sending Diagnostic and Usage Data to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability to submit diagnostic data to Apple MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of diagnostic and usage information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable External Intelligence Integrations
  platforms: macOS
  platform: darwin
  description: 'Integration with external intelligence systems MUST be disabled unless approved by the organization. Disabling external intelligence integration will mitigate the risk of data being sent to unapproved third party.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable External Intelligence Integration Sign In
  platforms: macOS
  platform: darwin
  description: 'The ability to sign into an external intelligence systems MUST be disabled unless approved by the organiztion. Disabling external intelligence integration will mitigate the risk of data being sent to unapproved third party.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce FileVault
  platforms: macOS
  platform: darwin
  description: 'FileVault MUST be enforced.

    The information system implements cryptographic mechanisms to protect the confidentiality and integrity of information stored on digital media during transport outside of controlled areas.

    NOTE: See the FileVault supplemental to implement this rule.'
  resolution: 'NOTE: See the FileVault supplemental to implement this rule.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.6 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Find My Service
  platforms: macOS
  platform: darwin
  description: 'The Find My service MUST be disabled.

    A Mobile Device Management (MDM) solution MUST be used to carry out remote locking and wiping instead of Apple''s Find My service.

    Apple''s Find My service uses a personal AppleID for authentication. Organizations should rely on MDM solutions, which have much more secure authentication requirements, to perform remote lock and remote wipe.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable macOS Application Firewall
  platforms: macOS
  platform: darwin
  description: 'The macOS Application Firewall is the built-in firewall that comes with macOS, and it MUST be enabled.

    When the macOS Application Firewall is enabled, the flow of information within the information system and between interconnected systems will be controlled by approved authorizations.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.2.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Firewall Stealth Mode
  platforms: macOS
  platform: darwin
  description: 'Firewall Stealth Mode MUST be enabled.

    When stealth mode is enabled, the Mac will not respond to any probing requests, and only requests from authorized applications will still be authorized.

    [IMPORTANT]

    ====

    Enabling firewall stealth mode may prevent certain remote mechanisms used for maintenance and compliance scanning from properly functioning. Information System Security Officers (ISSOs) are advised to first fully weigh the potential risks posed to their organization before opting not to enable stealth mode.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.security.firewall' AND name='EnableStealthMode' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.2.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Apply Gatekeeper Settings to Block Applications from Unidentified Developers
  platforms: macOS
  platform: darwin
  description: 'The information system implements cryptographic mechanisms to authenticate software prior to installation.

    Gatekeeper settings must be configured correctly to only allow the system to run applications downloaded from the Mac App Store or applications signed with a valid Apple Developer ID code. Administrator users will still have the option to override these settings on a per-app basis. Gatekeeper is a security feature that ensures that applications must be digitally signed by an Apple-issued certificate in order to run. Digital signatures allow the macOS to verify that the application has not been modified by a malicious third party.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Gatekeeper to Disallow End User Override
  platforms: macOS
  platform: darwin
  description: 'Gatekeeper MUST be configured with a configuration profile to prevent normal users from overriding its settings.

    If users are allowed to disable Gatekeeper or set it to a less restrictive setting, malware could be introduced into the system.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Guest Access to Shared SMB Folders
  platforms: macOS
  platform: darwin
  description: 'Guest access to shared Server Message Block (SMB) folders MUST be disabled.

    Turning off guest access prevents anonymous users from accessing files shared via SMB.'
  resolution: /usr/sbin/sysadminctl -smbGuestAccess off
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Guest Account
  platforms: macOS
  platform: darwin
  description: 'Guest access MUST be disabled.

    Turning off guest access prevents anonymous users from accessing files.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Hot Corners
  platforms: macOS
  platform: darwin
  description: 'Hot corners MUST be disabled.

    The information system conceals, via the session lock, information previously visible on the display with a publicly viewable image. Although hot comers can be used to initiate a session lock or to launch useful applications, they can also be configured to disable an automatic session lock from initiating. Such a configuration introduces the risk that a user might forget to manually lock the screen before stepping away from the computer.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Secure Hot Corners
  platforms: macOS
  platform: darwin
  description: 'Hot corners MUST be secured.

    The information system conceals, via the session lock, information previously visible on the display with a publicly viewable image. Although hot comers can be used to initiate a session lock or to launch useful applications, they can also be configured to disable an automatic session lock from initiating. Such a configuration introduces the risk that a user might forget to manually lock the screen before stepping away from the computer.

    [NOTE]

    ====

    The check and fix are for the last logged in user. To get the last logged in user, run the following.

    CURRENT_USER=$( /usr/bin/defaults read /Library/Preferences/com.apple.loginwindow lastUserName )

    ===='
  resolution: '/usr/bin/sudo -u "$CURRENTUSER" /usr/bin/defaults delete /Users/"$CURRENTUSER"/Library/Preferences/com.apple.dock wvous-bl-corner 2>/dev/null

    /usr/bin/sudo -u "$CURRENTUSER" /usr/bin/defaults delete /Users/"$CURRENTUSER"/Library/Preferences/com.apple.dock wvous-tl-corner 2>/dev/null

    /usr/bin/sudo -u "$CURRENTUSER" /usr/bin/defaults delete /Users/"$CURRENTUSER"/Library/Preferences/com.apple.dock wvous-tr-corner 2>/dev/null

    /usr/bin/sudo -u "$CURRENTUSER" /usr/bin/defaults delete /Users/"$CURRENTUSER"/Library/Preferences/com.apple.dock wvous-br-corner 2>/dev/null'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.7.1 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Sending Audio Recordings and Transcripts to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability for Apple to store and review audio of your audio recordings and transcripts of your vocal shortcuts and voice control interactions MUST be disabled. This will disable "Improve Assistive Voice Features" in Privacy & Security within System Settings.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of this information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.3 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Improve Search Information to Apple
  platforms: macOS
  platform: darwin
  description: 'Sending data to Apple to help improve search MUST be disabled. This will disable "Improve Search" within Spotlight in System Settings.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of search data will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.9.1
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Improve Siri and Dictation Information to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability for Apple to store and review audio of your Siri and Dictation interactions MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of Siri and Dictation information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Internet Accounts System Preference Pane
  platforms: macOS
  platform: darwin
  description: 'The Internet Accounts System Setting MUST be disabled to prevent the addition of unauthorized internet accounts.

    [IMPORTANT]

    ====

    Some organizations may allow the use and configuration of the built-in Mail.app, Calendar.app, and Contacts.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the Internet Accounts System Preference pane to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Internet Sharing
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Internet sharing, support for it is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling Internet sharing helps prevent the unauthorized connection of devices, unauthorized transfer of information, and unauthorized tunneling.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.7 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Location Services
  platforms: macOS
  platform: darwin
  description: 'Location Services MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.  Disabling Location Services helps prevent the unauthorized connection of devices, unauthorized transfer of information, and unauthorized tunneling.'
  resolution: "/usr/bin/defaults write /var/db/locationd/Library/Preferences/ByHost/com.apple.locationd LocationServicesEnabled -bool false; \npid=$(/bin/launchctl print system | /usr/bin/awk '/\\tcom.apple.locationd/ {print $1}')\nkill -9 $pid"
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.locationd' AND name='LocationServicesEnabled' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Login Window to Prompt for Username and Password
  platforms: macOS
  platform: darwin
  description: 'The login window MUST be configured to prompt all users for both a username and a password.

    By default, the system displays a list of known users on the login window, which can make it easier for a malicious user to gain access to someone else''s account. Requiring users to type in both their username and password mitigates the risk of unauthorized users gaining access to the information system.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.4 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Media Sharing
  platforms: macOS
  platform: darwin
  description: 'Media sharing MUST be disabled.

    When Media Sharing is enabled, the computer starts a network listening service that shares the contents of the user''s music collection with other users in the same subnet.

    The information system MUST be configured to provide only essential capabilities. Disabling Media Sharing helps prevent the unauthorized connection of devices and the unauthorized transfer of information. Disabling Media Sharing mitigates this risk.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.9 (level 2)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Password Hints
  platforms: macOS
  platform: darwin
  description: 'Password hints MUST be disabled.

    Password hints leak information about passwords that are currently in use and can lead to loss of confidentiality.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Personalized Advertising
  platforms: macOS
  platform: darwin
  description: 'Ad tracking and targeted ads MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling ad tracking ensures that applications and advertisers are unable to track users'' interests and deliver targeted advertisements.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.4 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Printer Sharing
  platforms: macOS
  platform: darwin
  description: Printer Sharing MUST be disabled.
  resolution: '/usr/sbin/cupsctl --no-share-printers

    /usr/bin/lpstat -p | awk ''{print $2}''| /usr/bin/xargs -I{} lpadmin -p {} -o printer-is-shared=false'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.3 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Remote Apple Events
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Remote Apple Events, support for Apple Remote Events is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling Remote Apple Events helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling.'
  resolution: '/usr/sbin/systemsetup -setremoteappleevents off

    /bin/launchctl disable system/com.apple.AEServer

    NOTE: Systemsetup with -setremoteappleevents flag will fail unless you grant Full Disk Access to systemsetup or its parent process. Requires supervision.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.6 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Remote Management
  platforms: macOS
  platform: darwin
  description: Remote Management MUST be disabled.
  resolution: /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -stop
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.5 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Screen Sharing and Apple Remote Desktop
  platforms: macOS
  platform: darwin
  description: 'Support for both Screen Sharing and Apple Remote Desktop (ARD) is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling screen sharing and ARD helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling.'
  resolution: '/bin/launchctl bootout system/com.apple.screensharing

    /bin/launchctl disable system/com.apple.screensharing

    NOTE - This will apply to the whole system'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Session Lock After Screen Saver is Started
  platforms: macOS
  platform: darwin
  description: 'A screen saver MUST be enabled and the system MUST be configured to require a password to unlock once the screensaver has been on for a maximum of $ODV seconds.

    An unattended system with an excessive grace period is vulnerable to a malicious user.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Screen Saver Password
  platforms: macOS
  platform: darwin
  description: 'Users MUST authenticate when unlocking the screen saver.

    The screen saver acts as a session lock and prevents unauthorized users from accessing the current user''s account.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Screen Saver Timeout
  platforms: macOS
  platform: darwin
  description: 'The screen saver timeout MUST be set to $ODV seconds or a shorter length of time.

    This rule ensures that a full session lock is triggered within no more than $ODV seconds of inactivity.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='idleTime' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Automatic Installs of Available Security Updates using DDM.
  platforms: macOS
  platform: darwin
  description: Ensure that available security updates are installed as soon as they are available from Apple and that the user cannot modify the setting within System Settings.
  resolution: This is implemented by Declarative Device Management (DDM).
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Siri
  platforms: macOS
  platform: darwin
  description: 'Support for Siri is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.2.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the System Settings Pane for Siri
  platforms: macOS
  platform: darwin
  description: 'The System Settings pane for Siri MUST be hidden.

    Hiding the System Settings pane prevents the users from configuring Siri.

    NOTE: Disabling the Siri System Settings pane blocks the user from opting into Apple Intelligence.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Server Message Block Sharing
  platforms: macOS
  platform: darwin
  description: 'Support for Server Message Block (SMB) file sharing is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: '/bin/launchctl disable system/com.apple.smbd

    The system may need to be restarted for the update to take effect.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.2 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable SSH Server for Remote Access Sessions
  platforms: macOS
  platform: darwin
  description: SSH service MUST be disabled for remote access.
  resolution: '/usr/sbin/systemsetup -f -setremotelogin off >/dev/null

    /bin/launchctl disable system/com.openssh.sshd

    NOTE: Systemsetup with -setremotelogin flag will fail unless you grant Full Disk Access to systemsetup or its parent process. Requires supervision.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.4 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable SSH Server for Remote Access Sessions
  platforms: macOS
  platform: darwin
  description: Remote access sessions MUST use encrypted methods to protect unauthorized individuals from gaining access.
  resolution: /bin/launchctl enable system/com.openssh.sshd
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Administrator Password to Modify System-Wide Preferences
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to require an administrator password in order to modify the system-wide preferences in System Settings.

    Some Preference Panes in System Settings contain settings that affect the entire system. Requiring a password to unlock these system-wide settings reduces the risk of a non-authorized user modifying system configurations.'
  resolution: "authDBs=(\"system.preferences\" \"system.preferences.energysaver\" \"system.preferences.network\" \"system.preferences.printing\" \"system.preferences.sharing\" \"system.preferences.softwareupdate\" \"system.preferences.startupdisk\" \"system.preferences.timemachine\")\nfor section in ${authDBs[@]}; do\n/usr/bin/security -q authorizationdb read \"$section\" > \"/tmp/$section.plist\"\nclasskeyvalue=$(/usr/libexec/PlistBuddy -c \"Print :class\" \"/tmp/$section.plist\" 2>&1)\nif [[ \"$classkeyvalue\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :class string user\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :class user\" \"/tmp/$section.plist\"\nfi\nkeyvalue=$(/usr/libexec/PlistBuddy -c \"Print :shared\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$keyvalue\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :shared bool false\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :shared false\" \"/tmp/$section.plist\"\
    \nfi\nauthuserkey=$(/usr/libexec/PlistBuddy -c \"Print :authenticate-user\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$authuserkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :authenticate-user bool true\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :authenticate-user true\" \"/tmp/$section.plist\"\nfi\nsessionownerkey=$(/usr/libexec/PlistBuddy -c \"Print :session-owner\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$sessionownerkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :session-owner bool false\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :session-owner false\" \"/tmp/$section.plist\"\nfi\ngroupkey=$(/usr/libexec/PlistBuddy -c \"Print :group\" \"/tmp/$section.plist\" 2>&1)\nif [[ \"$groupkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :group string admin\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :group admin\" \"/tmp/$section.plist\"\nfi\n/usr/bin/security\
    \ -q authorizationdb write \"$section\" < \"/tmp/$section.plist\"\ndone"
  query: SELECT 1 FROM software_update WHERE software_update_required = '0';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.8 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure macOS to Use an Authorized Time Server
  platforms: macOS
  platform: darwin
  description: 'Approved time server MUST be the only server configured for use. As of macOS 10.13 only one time server is supported.

    This rule ensures the uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.2.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce macOS Time Synchronization
  platforms: macOS
  platform: darwin
  description: 'Time synchronization MUST be enforced on all networked systems.

    This rule ensures the uniformity of time stamps for information systems with multiple system clocks and systems connected over a network.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.2.1 (level 1)
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure User Session Lock When a Smart Token is Removed
  platforms: macOS
  platform: darwin
  description: 'The screen lock MUST be configured to initiate automatically when the smart token is removed from the system.

    Session locks are temporary actions taken when users stop work and move away from the immediate vicinity of the information system but do not want to log out because of the temporary nature of their absences. While a session lock is not an acceptable substitute for logging out of an information system for longer periods of time, they prevent a malicious user from accessing the information system when a user has removed their smart token.

    [IMPORTANT]

    ====

    Information System Security Officers (ISSOs) may make the risk-based decision not to enforce a session lock when a smart token is removed, so as to maintain necessary workflow capabilities, but they are advised to first fully weigh the potential risks posed to their organization.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Touch ID System Settings Pane
  platforms: macOS
  platform: darwin
  description: 'The System Settings pane for Touch ID MUST be disabled.

    Disabling the System Settings pane prevents the users from configuring Touch ID.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable TouchID for Unlocking the Device
  platforms: macOS
  platform: darwin
  description: 'TouchID enables the ability to unlock a Mac system with a user''s fingerprint.

    TouchID MUST be disabled for "Unlocking your Mac" on all macOS devices that are capable of using Touch ID.

    The system MUST remain locked until the user establishes access using an authorized identification and authentication method.

    NOTE: TouchID is not an approved biometric authenticator for US Federal Government usage as it has not been verified to meet the strength requirements outlined in NIST SP 800-63.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - USB Devices Must be Authorized Before Allowing
  platforms: macOS
  platform: darwin
  description: 'USB devices connected to a Mac MUST be authorized.

    [IMPORTANT]

    ====

    This feature is removed if a smartcard is paired or smartcard attribute mapping is configured.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the System Settings Pane for Wallet and Apple Pay
  platforms: macOS
  platform: darwin
  description: 'The System Settings pane for Wallet and Apple Pay MUST be disabled.

    Disabling the System Settings pane prevents the users from configuring Wallet and Apple Pay.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Wi-Fi Interface
  platforms: macOS
  platform: darwin
  description: 'The macOS system must be configured with Wi-Fi support software disabled if not connected to an authorized trusted network.

    Allowing devices and users to connect to or from the system without first authenticating them allows untrusted access and can lead to a compromise or attack. Since wireless communications can be intercepted it is necessary to use encryption to protect the confidentiality of information in transit. Wireless technologies include for example  microwave packet radio (UHF/VHF) 802.11x and Bluetooth. Wireless networks use authentication protocols (e.g. EAP/TLS PEAP) which provide credential protection and mutual authentication.

    NOTE: If the system requires Wi-Fi to connect to an authorized network, this is not applicable.'
  resolution: 'To disable Wi-Fi on a macOS system, run the following command.

    /usr/sbin/networksetup -setnetworkserviceenabled "Wi-Fi" off'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Allow Information Transfer with Other Operating Systems
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to allow the transfer of information to and from other operating systems and users.

    The macOS is a UNIX 03-compliant operating system, which allows owners of object to have discretion over who should be authorized to access information.

    link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Permissions/Permissions.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure Separate Execution Domain for Processes
  platforms: macOS
  platform: darwin
  description: 'The inherent configuration of the macOS IS in compliance as Apple has implemented multiple features Mandatory access controls (MAC), System Integrity Protection (SIP), and application sandboxing.

    link:https://support.apple.com/guide/security/system-integrity-protection-secb7ea06b49/web[]

    link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AppSandboxDesignGuide/AboutAppSandbox/AboutAppSandbox.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Allow Administrators to Modify Security Settings and System Attributes
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to allow administrators to modify security settings and system attributes.

    The macOS is a UNIX 03-compliant operating system, which allows administrators of the system to change security settings and system attributes, including those which are kept within preference panes that are locked for standard users. .

    link:https://support.apple.com/guide/mac-help/change-permissions-for-files-folders-or-disks-mchlp1203/mac[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Allow Administrators to Promote Other Users to Administrator Status
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to allow current administrators to promote standard users to administrator user status.

    The macOS is a UNIX 03-compliant operating system which allows administrators of the system to grant privileges to other users.

    link:https://support.apple.com/guide/mac-help/set-up-other-users-on-your-mac-mtusr001/mac[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure the System to Implement Approved Cryptography to Protect Information
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to implement approved cryptography to protect information.

    Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. The operating system must implement cryptographic modules that adhere to the higher standards that have been tested, validated, and approved by the federal government.

    Apple is committed to the FIPS validation process and historically has always submitted and validated the cryptographic modules in macOS. macOS Tahoe for Apple Silicion will be submitted for FIPS validation. macOS Tahoe for Intel based processors will NOT be submitted for FIPS validation.

    link:https://csrc.nist.gov/Projects/cryptographic-module-validation-program/validated-modules[]

    link:https://support.apple.com/guide/sccc/welcome/web[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Approved Authorization for Logical Access
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to enforce an approved authorization process before granting users logical access.

    The inherent configuration of the macOS does not grant users logical access without authorization. Authorization is achieved on the macOS through permissions, which are controlled at many levels, from the Mach and BSD components of the kernel, through higher levels of the operating system and, for networked applications, through the networking protocols. Permissions can be granted at the level of directories, subdirectories, files or applications, or specific data within files or functions within applications.

    link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Permissions/Permissions.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Display logoff capability and message to prevent exploitation
  platforms: macOS
  platform: darwin
  description: 'Provides a logout capability for user-initiated communications sessions whenever authentication is used to gain access to the system.

    Displays an explicit logout message to users indicating the reliable termination of authenticated communications sessions.'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure the System Implements Malicious Code Protection Mechanisms
  platforms: macOS
  platform: darwin
  description: "The inherent configuration of the macOS IS in compliance as Apple has designed the system with three layers of protection against malware. Each layer of protection is comprised of one or more malicious code protection mechanisms, which are automatically implemented and which, collectively, meet the requirements of all applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance for malicious code prevention.\n1. This  first layer of defense targets the distribution of malware; the aim is to prevent malware from ever launching.\nThe following mechanisms are inherent to the macOS design and constitute the first layer of protection against malicious code:\nThe Apple App Store: the safest way to add new applications to a Mac is by downloading them from the App Store; all apps available for download from the App Store have been reviewed for signs of tampering and signed by Apple to indicate that the app meets security requirements and does\
    \ not contain malware.\nXProtect: a built-in, signature-based, anti-virus, anti-malware technology inherent to all Macs. XProtect automatically detects and blocks the execution of known malware.\nIn macOS 10.15 and all subsequent releases, XProtect checks for known malicious content when:\nan app is first launched,\nan app has been changed (in the file system), and\nXProtect signatures are updated.\nYARA: another built-in tool (inherent to all Macs), which conducts signature-based detection of malware. Apple updates YARA rules regularly.\nGatekeeper: a security feature inherent to all Macs; Gatekeeper scans apps to detect malware and/or revocations of a developer's signing certificate and prevents unsafe apps from running.\nNotarization: Apple performs regular, automated scans to detect signs of malicious content and to verify developer ID-signed software; when no issues are found, Apple notarizes the software and delivers the results of scans to the system owner.\n2. The second layer\
    \ of defense targets malware that manages to appear on a Mac before it runs; the aim is to quickly identify and block any malware present on a Mac in order to prevent the malware from running and further spreading.\nThe following mechanisms are inherent to the macOS design and constitute the second layer of protection against malicious code:\nXProtect (defined above).\nGatekeeper (defined above).\nNotarization (defined above).\n3.  The third layer of defense targets infected Mac system(s); the aim is to remediate Macs on which malware has managed to successfully execute.\nThe following mechanism is inherent to the macOS design and constitutes the third layer of protection against malicious code:\n*\tApple's XProtect: a technology included on all macOS systems. XProtect will remediate infections upon receiving updated information delivered and when infections are detected\nlink:https://support.apple.com/guide/security/protecting-against-malware-sec469d47bd8/1/web/1[]\nlink:https://support.apple.com/guide/security/app-security-overview-sec35dd877d0/web[]"
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Obscure Passwords
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to obscure feedback of authentication information during the authentication process to protect the information from possible exploitation by unauthorized individuals.

    The inherent configuration of a macOS uses NSSecureTextField for any text field that receives a password, which automatically obscures text which is entered.

    link:https://developer.apple.com/documentation/appkit/nssecuretextfield[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Must behave in predictable and documented manner
  platforms: macOS
  platform: darwin
  description: The information system behaves in a predictable and documented manner that reflects organizational and system objectives when invalid inputs are received.
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prevent Software From Executing at Higher Privilege Levels than Users Executing The Software
  platforms: macOS
  platform: darwin
  description: 'In certain situations, software applications/programs need to execute with elevated privileges to perform required functions. However, if the privileges required for execution are at a higher level than the privileges assigned to organizational users invoking such applications/programs, those users are indirectly provided with greater privileges than assigned by the organizations.Some programs and processes are required to operate at a higher privilege level and therefore should be excluded from the organization-defined software list after review.

    The inherent configuration of the macOS does not allow for non-privileged users to be able to execute functions requiring privilege.

    link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Permissions/Permissions.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure the System to Block Non-Privileged Users from Executing Privileged Functions
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to block standard users from executing privileged functions.

    Privileged functions include disabling, circumventing, or altering implemented security safeguards and countermeasures.

    The inherent configuration of the macOS does not allow for non-privileged users to be able to execute functions requiring privilege.

    link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Introduction/Introduction.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure the System to Prevent the Unauthorized Disclosure of Data via Shared Resources
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to ensure that the unauthorized disclosure of data does not occur when resources are shared.

    The inherent configuration of the macOS does not allow for resources to be shared between users without authorization.

    link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Permissions/Permissions.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Prohibit Remote Activation of Collaborative Computing Devices
  platforms: macOS
  platform: darwin
  description: 'The inherent configuration of the macOS IS in compliance.

    Apple has implemented a green light physically next to your camera that will glow when the camera is activated. There is an orange dot indicator by the Control Center pull down menu item to indicate when the system''s microphone is listening or activated.

    The macOS has built into the system, the ability to grant or deny access to the camera and microphone which requires the application to have an entitlement to use the device.

    link:https://support.apple.com/guide/mac-help/use-the-built-in-camera-mchlp2980/mac[]

    link:https://support.apple.com/guide/mac-help/control-access-to-your-camera-mchlf6d108da/mac[]

    link:https://support.apple.com/guide/mac-help/control-access-to-your-microphone-on-mac-mchla1b1e1fe/12.0/mac/12.0[]'
  resolution: The technology partially meets this requirement. An appropriate mitigation for the system must be implemented for full compliance.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Provide Ability to Disconnect or Disable Remote Access
  platforms: macOS
  platform: darwin
  description: Without the ability to immediately disconnect or disable remote access, an attack or other compromise taking place would not be immediately stopped.Operating system remote access functionality must have the capability to immediately disconnect current users remotely accessing the information system and/or disable further remote access. The speed of disconnect or disablement varies based on the criticality of missions functions and the need to eliminate immediate or future remote access to organizational information systems.The remote access functionality (e.g., SSH) may implement features such as automatic disconnect (or user-initiated disconnect) in case of adverse information based on an indicator of compromise or attack.
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require users to reauthenticate for privilege escalation
  platforms: macOS
  platform: darwin
  description: Without reauthentication, users may access resources or perform tasks for which they do not have authorization. When operating systems provide the capability to escalate a functional capability, it is critical the user reauthenticate.
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require users to reauthenticate when changing authenticators
  platforms: macOS
  platform: darwin
  description: Without reauthentication, users may access resources or perform tasks for which they do not have authorization. When operating systems provide the capability to change user authenticators, it is critical the user reauthenticate.
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Must remove all software components after updated versions installed
  platforms: macOS
  platform: darwin
  description: Previous versions of software components that are not removed from the information system after updates have been installed may be exploited by adversaries. Some information technology products may remove older versions of software automatically from the information system.
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure all Federal Laws, Executive Orders, Directives, Policies, Regulations, Standards, and Guidance for Authentication to a Cryptographic Module are Met
  platforms: macOS
  platform: darwin
  description: 'The inherent configuration of the macOS IS in compliance by implementing mechanisms for authentication to a cryptographic module that meet the requirements of all applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance for such authentication

    macOS contains many open source projects that may use their own cryptographic libraries typically for the purposes of maintaining platform independence. These services are not covered by the Apple FIPS Validation of the CoreCrypto and CoreCrypto Kernel modules.

    Apple is committed to the FIPS validation process and historically has always submitted and validated the cryptographic modules in macOS. macOS Tahoe for Apple Silicion will be submitted for FIPS validation. macOS Tahoe for Intel based processors will NOT be submitted for FIPS validation.

    link:https://csrc.nist.gov/Projects/cryptographic-module-validation-program/validated-modules[]

    link:https://support.apple.com/guide/sccc/welcome/web[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Protected Storage for Cryptographic Keys
  platforms: macOS
  platform: darwin
  description: 'A system IS configured to provide protected storage for cryptographic keys either by hardware protected key store or an organizationally defined safeguard.

    Macs with Apple Silicon or T2 processors provide protected storage for cryptographic keys via the secure enclave.

    link:https://support.apple.com/guide/security/secure-enclave-sec59b0b31ff/1/web/1[]

    NOTE: This will only return a proper result on a T2 or Apple Silicon Macs.'
  resolution: The hardware does not support the requirement.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure the System to Separate User and System Functionality
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to separate user and system functionality.

    Operating system management functionality includes functions necessary for administration and requires privileged user access. Allowing non-privileged users to access operating system management functionality capabilities increases the risk that non-privileged users may obtain elevated privileges. Operating system management functionality includes functions necessary to administer console, network components, workstations, or servers and typically requires privileged user access.

    The inherent configuration of the macOS allows only privileged users to access operating system management functionalities.

    link:https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/DesigningDaemons.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Encrypt Stored Passwords
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to encrypt stored passwords.

    Passwords need to be protected at all times, and encryption is the standard method for protecting passwords. If passwords are not encrypted, they can be plainly read (i.e., clear text) and easily compromised.

    link:https://developer.apple.com/documentation/opendirectory/kodattributetypeauthenticationauthority[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Uniquely Identify Users and Processes
  platforms: macOS
  platform: darwin
  description: The macOS is a UNIX 03-compliant operating system. The system uniquely identifies and authenticates organizational users or processes.
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Verify remote disconnection of sessions
  platforms: macOS
  platform: darwin
  description: The information system implements remote disconnect verification at the termination of non-local maintenance and diagnostic sessions.
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Force Password Change at Next Logon
  platforms: macOS
  platform: darwin
  description: 'The macOS is able to be configured to force users to change their password at next logon.

    Temporary passwords are often used for new users when accounts are created. However, once logged in to the system, users must be immediately prompted to change to a permanent password of their creation.

    For a user to change their password at next logon, run the following command:

    /usr/bin/pwpolicy -u [USER] -setpolicy "newPasswordRequired=1"

    NOTE: Replace [USER] with the username that must change the password at next logon'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Off-Load Audit Records
  platforms: macOS
  platform: darwin
  description: 'Audit records should be off-loaded onto a different system or media from the system being audited.

    Information stored in only one location is vulnerable to accidental or incidental deletion or alteration. Off-loading is a common process in information systems with limited audit storage capacity.

    To secure audit records by off-loading, many operating systems can be integrated with enterprise-level auditing mechanisms that meet or exceed this requirement.'
  resolution: This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Must Authenticate Before Establishing a Connection
  platforms: macOS
  platform: darwin
  description: Organizational devices requiring unique device-to-device identification and authentication may be defined by type, by device, or by a combination of type/device. Information systems typically use either shared known information (e.g., Media Access Control [MAC] or Transmission Control Protocol/Internet Protocol [TCP/IP] addresses) for device identification or organizational authentication solutions (e.g., IEEE 802.1x and Extensible Authentication Protocol [EAP], Radius server with EAP-Transport Layer Security [TLS] authentication, Kerberos) to identify/authenticate devices on local and/or wide area networks. Organizations determine the required strength of authentication mechanisms by the security categories of information systems. Because of the challenges of applying this control on large scale, organizations are encouraged to only apply the control to those limited number (and type) of devices that truly need to support this capability.
  resolution: This requirement is a permanent finding and can be fixed by implementing a third party solution.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Automated Flaw Remediation
  platforms: macOS
  platform: darwin
  description: The macOS system MUST be configured to determine the state of system components with regard to flaw remediation.
  resolution: This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Protect Against Denial of Service Attacks by Ensuring Rate-Limiting Measures on Network Interfaces
  platforms: macOS
  platform: darwin
  description: 'The macOS should be configured to prevent Denial of Service (DoS) attacks by enforcing rate-limiting measures on network interfaces.

    DoS attacks leave authorized users unable to access information systems, devices, or other network resources due to the actions of a malicious cyber threat actor. When this occurs, the organization must operate at degraded capacity; often resulting in an inability to accomplish its mission.

    To prevent DoS attacks by ensuring rate-limiting measures on network interfaces, many operating systems can be integrated with enterprise-level firewalls and networking equipment that meet or exceed this requirement.'
  resolution: This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Devices to Reauthenticate when Changing Authenticators
  platforms: macOS
  platform: darwin
  description: 'The macOS should be configured to require users to reauthenticate when the device authenticator is changed.

    Without reauthentication, users may access resources or perform tasks for which they are not authorization. When operating systems provide the capability to change device authenticators, it is critical the device reauthenticate.'
  resolution: This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Secure Name Address Resolution Service
  platforms: macOS
  platform: darwin
  description: 'The information system requests and performs data origin authentication and data integrity verification on the name/address resolution responses the system receives from authoritative sources.

    NOTE: macOS supports encrypted DNS settings with the com.apple.dnsSettings.managed payload, however, the system must be integrated with a DNS server that supports encrypted DNS. link:https://developer.apple.com/documentation/devicemanagement/dnssettings[]'
  resolution: This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Wi-Fi When Connected to Ethernet
  platforms: macOS
  platform: darwin
  description: 'The macOS should be configured to automatically disable Wi-Fi when connected to ethernet.

    The use of Wi-Fi to connect to unauthorized networks may facilitate the exfiltration of mission data. Therefore, wireless networking capabilities internally embedded within information system components should be disabled when not intended to be used.

    NOTE: If the system requires Wi-Fi to connect to an authorized network, this is not applicable.'
  resolution: This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Access Control for Mobile Devices
  platforms: macOS
  platform: darwin
  description: 'A mobile device is a computing device that has a small form factor such that it can easily be carried by a single individual; is designed to operate without a physical connection; possesses local, non-removable or removable data storage; and includes a self-contained power source. Mobile device functionality may also include voice communication capabilities, on-board sensors that allow the device to capture information, and/or built-in features for synchronizing local data with remote locations. Examples include smart phones and tablets. Mobile devices are typically associated with a single individual. The processing, storage, and transmission capability of the mobile device may be comparable to or merely a subset of notebook/desktop systems, depending on the nature and intended purpose of the device. Protection and control of mobile devices is behavior or policy-based and requires users to take physical action to protect and control such devices when outside of controlled
    areas. Controlled areas are spaces for which organizations provide physical or procedural controls to meet the requirements established for protecting information and systems.

    Due to the large variety of mobile devices with different characteristics and capabilities, organizational restrictions may vary for the different classes or types of such devices. Usage restrictions and specific implementation guidance for mobile devices include configuration management, device identification and authentication, implementation of mandatory protective software, scanning devices for malicious code, updating virus protection software, scanning for critical software updates and patches, conducting primary operating system (and possibly other resident software) integrity checks, and disabling unnecessary hardware.

    Usage restrictions and authorization to connect may vary among organizational systems. For example, the organization may authorize the connection of mobile devices to its network and impose a set of usage restrictions, while a system owner may withhold authorization for mobile device connection to specific applications or impose additional usage restrictions before allowing mobile device connections to a system.'
  resolution: This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure the System to Uniquely Identify and Authenticate Non-Organizational Users
  platforms: macOS
  platform: darwin
  description: The information system uniquely identifies and authenticates non-organizational users (or processes acting on behalf of non-organizational users).
  resolution: The requirement is NA. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Information Input Validation
  platforms: macOS
  platform: darwin
  description: 'Check the validity of the following information inputs: organization-defined information inputs to the systems.

    Checking the valid syntax and semantics of system inputsincluding character set, length, numerical range, and acceptable valuesverifies that inputs match specified definitions for format and content. For example, if the organization specifies that numerical values between 1-100 are the only acceptable inputs for a field in a given application, inputs of "387," "abc," or "%K%" are invalid inputs and are not accepted as input to the system. Valid inputs are likely to vary from field to field within a software application. Applications typically follow well-defined protocols that use structured messages (i.e., commands or queries) to communicate between software modules or system components. Structured messages can contain raw or unstructured data interspersed with metadata or control information. If software applications use attacker-supplied inputs to construct structured messages without properly encoding such messages, then the attacker could insert malicious commands or special characters
    that can cause the data to be interpreted as control information or metadata. Consequently, the module or component that receives the corrupted output will perform the wrong operations or otherwise interpret the data incorrectly. Prescreening inputs prior to passing them to interpreters prevents the content from being unintentionally interpreted as commands. Input validation ensures accurate and correct inputs and prevents attacks such as cross-site scripting and a variety of injection attacks.'
  resolution: The requirement is NA. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Managed Access Control Points
  platforms: macOS
  platform: darwin
  description: 'Route remote accesses through authorized and managed network access control points.

    Organizations consider the Trusted Internet Connections (TIC) initiative requirements for external network connections since limiting the number of access control points for remote access reduces attack surfaces.'
  resolution: The requirement is NA. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure the System for Non-local Maintenance
  platforms: macOS
  platform: darwin
  description: Non-local maintenance and diagnostic activities are those activities conducted by individuals communicating through a network, either an external network or an internal network.
  resolution: The requirement is NA. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Out of Scope Supplemental
  platforms: macOS
  platform: darwin
  description: 'There are several requirements defined in National Institute of Standards and Technology (NIST) Special Publication (SP) 800-53, Security and Privacy Controls for Information Systems and Organizations, Revision 5 that can be met by making configuration changes to the operating system. However, NIST SP 800-53 (Rev. 5) contains a broad set of guidelines that attempt to address all aspects of an information system or systems within an organization. Because the macOS Security Compliance Project is tailored specifically to macOS, some requirements defined in NIST SP 800-53 (Rev. 5) are not applicable.

    This supplemental contains those controls that are assigned to a baseline in NIST SP 800-53 (Rev. 5) which cannot be addressed with a technical configuration for macOS. These controls can be accomplished though administrative or procedural processes within an organization or via integration of the macOS system into enterprise information systems which are configured to protect the systems within.

    [cols="15%h, 85%a"]

    |===

    |Family

    |Access Control (AC)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-1[AC-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-2[AC-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-3[AC-3(14)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-14[AC-14], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-17[AC-17(4)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-22[AC-22]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Awareness and Training (AT)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-1[AT-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-2[AT-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-3[AT-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-4[AT-4]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Audit and Accountability (AU)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AU-1[AU-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AU-6[AU-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AU-9[AU-9(2)]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Security Assessment and Authorization (CA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-1[CA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-2[CA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-3[CA-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-3[CA-3(6)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-5[CA-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-6[CA-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-7[CA-7], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-7[CA-7(4)],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-9[CA-9]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Configuration Management (CM)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-1[CM-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-4[CM-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-8[CM-8], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-10[CM-10], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-11[CM-11]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Contingency Planning (CP)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-1[CP-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-2[CP-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-3[CP-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-4[CP-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-9[CP-9], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-10[CP-10]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Identification and Authentication (IA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-1[IA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(1)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(3)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(4)]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Incident Response (IR)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-1[IR-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-2[IR-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-4[IR-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-5[IR-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-6[IR-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-7[IR-7], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-8[IR-8]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Maintenance (MA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MA-1[MA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MA-2[MA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MA-5[MA-5]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Media Protection (MP)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-1[MP-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-2[MP-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-6[MP-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-7[MP-7]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Physical and Environmental Protection (PE)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-1[PE-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-2[PE-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-3[PE-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-6[PE-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-8[PE-8], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-12[PE-12], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-13[PE-13], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-14[PE-14],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-15[PE-15],  link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-16[PE-16]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Planning (PL)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PL-1[PL-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PL-2[PL-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PL-4[PL-4]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Personnel Security (PS)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-1[PS-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-2[PS-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-3[PS-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-4[PS-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-5[PS-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-6[PS-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-7[PS-7], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-8[PS-8]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Risk Assessment (RA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-1[RA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-2[RA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-3[RA-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-5[RA-5]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |System and Services Acquisition (SA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-1[SA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-2[SA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-3[SA-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-4[SA-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-4[SA-4(10)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-5[SA-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-9[SA-9]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |System and Communications Protection (SC)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-1[SC-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(3)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(7)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(8)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(18)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(21)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-12[SC-12], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-12[SC-12(1)],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-20[SC-20], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-22[SC-22], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-23[SC-23]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |System and Information Integrity (SI)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-1[SI-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(4)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(5)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(12)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(14)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(20)],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(22)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-5[SI-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-7[SI-7(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-8[SI-8(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-12[SI-12]

    |==='
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - FileVault Supplemental
  platforms: macOS
  platform: darwin
  description: 'The supplemental guidance found in this section is applicable for the following rules:

    * systemsettingsfilevaultenforce

    In macOS the internal Apple File System (APFS) data volume can be protected by FileVault. The system volume is always cryptographically protected (T2 and Apple Silicon) and is a read-only volume.

    NOTE: FileVault uses an AES-XTS data encryption algorithm to protect full volumes of internal and external storage. Macs with a secure enclave (T2 and Apple Silicon) utilize the hardware security features of the architecture.

    FileVault is described in detail here: link:https://support.apple.com/guide/security/volume-encryption-with-filevault-sec4c6dc1b6e/web[].

    FileVault can be enabled in two ways within the macOS. It can be managed using the fdesetup command or by a Configuration Profile. When enabling FileVault via either of the aforementioned methods, you will be required to enter a username and password, which must be a local Open Directory account with a valid SecureToken password.

    [discrete]

    ==== Using the fdesetup Command

    When enabling FileVault via the command line in the Terminal application, you can run the following command.

    /usr/bin/fdesetup enable

    Running this command will prompt you for a username and password and then enable FileVault and return the personal recovery key. There are a number of management features available when managing FileVault via the command line that are not available when using a configuration profile. More information on these management features is available in the man page for fdesetup.

    NOTE: Apple has deprecated fdesetup command line tool from recognizing user name and password for security reasons and may remove the ability in future versions of macOS.

    [discrete]

    ==== Using a Configuration Profile

    When managing FileVault with a configuration profile, you must deploy a profile with the payload type com.apple.MCX.FileVault2. When using the Enable key to enable FileVault with a configuration profile, you must include 1 of the following:

    <key>Enable</key>

    <string>On</string>

    <key>Defer</key>

    <true/>

    <key>Enable</key>

    <string>On</string>

    <key>UserEntersMissingInfo</key>

    <true/>

    If using the Defer key it will prompt for the user name and password at logout.

    The UserEntersMissingInfo key will only work if installed through manual installation, and it will prompt for the username and password immediately.

    When using a configuration profile, you can escrow the Recovery key to a Mobile Device Management (MDM) server. Documentation for that can be found on Apple''s Developer site: link:https://developer.apple.com/documentation/devicemanagement/fderecoverykeyescrow[].

    It''s recommended that you use a Personal Recovery key instead of an Institutional key as it will generate a specific key for each device. You can find more guidance on choosing a recover key here: link:https://docs.jamf.com/technical-papers/jamf-pro/administering-filevault-macos/10.7.1/ChoosingaRecoveryKey.html[].

    NOTE: On Intel Macs, FileVault only supports password-based unlock and cannot be done using a smartcard. Smartcard unlock for FileVault is supported on Apple Silicon Macs.'
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Packet Filter (pf) Supplemental
  platforms: macOS
  platform: darwin
  description: 'The supplemental guidance found in this section is applicable for the following rules:

    osfirewalldefaultdenyrequire

    macOS contains an application layer firewall (ALF) and a packet filter (PF) firewall.

    The ALF can block incoming traffic on a per-application basis and prevent applications from gaining control of network ports, but it cannot be configured to block outgoing traffic.

    * More information on the ALF can be found here: https://support.apple.com/en-ca/HT201642

    The PF firewall can manipulate virtually any packet data and is highly configurable.

    ** More information on the BF firewall can be found here: https://www.openbsd.org/faq/pf/index.html

    Below is a script that configures ALF and the PF firewall to meet the requirements defined in NIST SP 800-53 (Rev. 5). The script will make sure the application layer firewall is enabled, set logging to "detailed", set built-in signed applications to automatically receive incoming connections, and set downloaded signed applications to automatically receive incoming connections. It will then create a custom rule set and copy com.apple.pfctl.plis from /System/Library/LaunchDaemons/ into the /Library/LaunchDaemons folder and name it 800-53.pfctl.plist. This is done to not conflict with the system''s pf ruleset.

    The custom pf rules are created at /etc/pf.anchors/80053pf_anchors.

    The ruleset will block connections on the following ports:

    [%header,width="100%",cols="3,7"]

    |===

    ^.^|Port

    ^.^|Service

    |548

    |Apple File Protocol (AFP)

    |1900

    |Bonjour

    |79

    |Finger

    |20, 21

    |File Transfer Protocol (FTP)

    |80

    |HTTP

    |icmp

    |ping

    |143

    |Internet Message Access Protocol (IMAP)

    |993

    |Internet Message Access Protocol over SSL (IMAPS)

    |3689

    |Music Sharing

    |5353

    |mDNSResponder

    |2049

    |Network File System (NFS)

    |49152

    |Optical Media Sharing

    |110

    |Post Office Protocol (POP3)

    |995

    |Post Office Protocol Secure (POP3S)

    |631

    |Printer Sharing

    |3031

    |Remote Apple Events

    |5900

    |Screen Sharing

    |137, 138, 138, 445

    |Samba (SMB)

    |25

    |Simple Mail Transfer Protocol (SMTP)

    |22

    |Secure Shell (SSH)

    |23

    |Telnet

    |69

    |Trivial File Transfer Protocol (TFTP)

    |540

    |Unix-to-Unix Copy (UUCP)

    |===

    For more on configuring the PF firewall check out the man pages on pf.conf and pfctl.

    include::../../includes/enablePF-mscp.sh[]'
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Password Policy Supplemental
  platforms: macOS
  platform: darwin
  description: "To comply with Executive Order 14028, Improving the Nation's Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings: \nPassword policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. \nPassword policies must also not require the use of regular rotation. \nIn accordance with these requirements, the following rules, while they remain on specific benchmarks, have been removed from any of the NIST 800-53r5 baselines as recommendations.\npwpolicyalphanumericenforce\npwpolicycustomregexenforce\npwpolicylowercasecharacterenforce.yaml\npwpolicymaxlifetimeenforce\npwpolicyminimumlifetimeenforce\npwpolicypreventdictionarywords\npwpolicysimplesequencedisable\npwpolicyspecialcharacterenforce\n\
    pwpolicyuppercasecharacterenforce.yaml\nIf an organization has requirements to implement additional password policies, the remainder of this supplemental discusses the following password policy rules:\npwpolicylowercasecharacterenforce\npwpolicyuppercasecharacterenforce\npwpolicyaccountinactivityenforce\npwpolicyminimumlifetimeenforce\nPassword policies should be enforced as much as possible via Configuration Profiles. However, the following policies are currently not enforceable via Configuration Profiles, and must therefore be enabled using the pwpolicy command:\nEnforcing at least 1 lowercase character\nEnforcing at least 1 uppercase character\nDisabling an account after 35 days of inactivity\n* Password minimum lifetime\nTo set the local policy to meet these requirements, save the following XML password policy to a file.\ninclude::../../includes/pwpolicy.xml[]\nRun the following command to load the new policy file, substituting the path to the file in place of \"$pwpolicyfile\".\n\
    /usr/bin/pwpolicy setaccountpolicies $pwpolicy_file\n[NOTE]\n====\nIf directory services is being utilized, password policies should come from the domain.\n====\n[WARNING]\n====\nIn order to apply any password policy, the allowPasscodeModification setting in com.apple.applicationaccess must not be set to false.\n===="
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Smartcard Supplemental
  platforms: macOS
  platform: darwin
  description: 'The supplemental guidance found in this section is applicable for the following rules:

    authsshpasswordauthenticationdisable

    authsmartcardenforce

    authsmartcardcertificatetrustenforcemoderate

    authsmartcardcertificatetrustenforcehigh

    authsmartcardallow

    authpamsudosmartcardenforce

    authpamsusmartcardenforce

    authpamloginsmartcardenforce

    macOS supports smartcards, such as U.S. Personal Identity Verification (PIV) cards and U.S. Department of Defense Common Access Cards (CAC). Smartcards can be used on a macOS for the following:

    Authentication (Loginwindow, Screensaver, SSH, PKINIT, Safari, Finder, and PAM Authorization (sudo, login, and su) )

    Digital Encryption

    Digital Signing

    Remote Access (VPN:L2TP)

    Port-based Network Access Control (802.1X)

    Keychain Unlock

    macOS has built-in support for USB CCID class-compliant smartcard readers.

    [discrete]

    ==== Smartcard Pairing

    The default method for using smartcards in macOS is a method called "local account pairing". Local account pairing is automatically initiated when a user inserts a smartcard into the Mac. The user is prompted to pair their smartcard with their account. If a user receives a new smartcard, the previous card must be unpaired, and the new card paired to the account. Local account pairing employs fixed key mapping with the hash of a public key on the user''s smartcard with a local account.

    [discrete]

    ==== Smartcard Attribute Mapping

    Smartcards can be used to authenticate against a directory via attribute mapping configured in /private/etc/SmartcardLogin.plist. This file takes precedence over local account pairing. Attribute mapping matches the configured certificate field values from the smart card to the value in a directory. This may be used with network accounts, mobile accounts, or local accounts.

    [discrete]

    ==== Smartcard Management in macOS

    The following settings are available to manage smartcards (com.apple.security.smartcard):

    [%header,cols="2,1,7"]

    |===

    |Key

    |Type

    |Value

    <.^|userPairing

    ^.^|bool

    |If false, users will not get the pairing dialog, although existing pairings will still work.

    <.^|allowSmartCard

    ^.^|bool

    |If false, the SmartCard is disabled for logins, authorizations, and screensaver unlocking. It is still allowed for other functions, such as signing emails and web access. A restart is required for a change of setting to take effect.

    <.^|checkCertificateTrust

    ^.^|int

    a|Valid values are 0-3:

    - 0: certificate trust check is turned off

    - 1: certificate trust check is turned on. Standard validity check is being performed but this does not include additional revocation checks.

    - 2: certificate trust check is turned on, and a soft revocation check is performed. Until the certificate is explicitly rejected by CRL/OCSP, it is considered valid. This implies that unavailable/unreachable CRL/OCSP allows this check to succeed.

    - 3: certificate trust check is turned on, plus a hard revocation check is performed. Unless CRL/OCSP explicitly states that "this certificate is OK", the certificate is considered invalid. This is the most secure value for this setting.

    <.^|oneCardPerUser

    ^.^|bool

    |If true, a user can pair with only one smartcard, although existing pairings will be allowed if already set up.

    <.^|enforceSmartCard

    ^.^|bool

    |If true, a user can only login or authenticate with a smartcard.

    <.^|tokenRemovalAction

    ^.^|int

    |If 1, the screen saver will automatically when the smartcard is removed.

    <.^|allowUnmappedUsers

    ^.^|int

    |If 1, allows users who are in a directory group to be exempt from smartcard-only enforcement. The group allowed for exemption is defined in /private/etc/SmartcardLogin.plist

    |===

    A custom configuration profile (com.apple.loginwindow) should be created to disable automatic login when FileVault is enabled. This ensures that authorized users boot their Macs, enter a password at the pre-boot screen (which decrypts the boot volume), and are then presented with a login window where they can authenticate with a smartcard.

    [%header,cols="2,1,7"]

    |===

    |Key

    |Type

    |Value

    <.^|DisableFDEAutoLogin

    ^.^|bool

    |If true, both Extensible Firmware Interface (EFI) login password and loginwindow PIN are required.

    |===

    NOTE: DisableFDEAutoLogin does not have to be set on Apple Silicon based macOS systems that are smartcard enforced as smartcards are available at pre-boot.

    [discrete]

    ==== Trusted Authorities

    The macOS allows users to specify which certificate authorities (CA) can be used for trust evaluation during smartcard authentication. Only CAs listed in the TrustedAuthorities section of the SmartcardLogin.plist will be evaluated as trusted. This setting only works if checkCertificateTrust is set to either 1, 2, or 3 in com.apple.security.smartcard.

    To get the SHA-256 hash in the correct format, run the following command within terminal:

    /usr/bin/openssl x509 -noout -fingerprint -sha256 -inform pem -in <issuer cert> | /usr/bin/awk -F ''='' ''{print $2}'' |  /usr/bin/sed ''s/://g''

    To configure Trusted Authorities, the SmartcardLogin.plist should be minimally configured as below:

    <?xml version="1.0" encoding="UTF-8"?>

    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">

    <plist version="1.0">

    <dict>

    <key>AttributeMapping</key>

    <dict>

    <key>fields</key>

    <array>

    <string>NT Principal Name</string>

    </array>

    <key>formatString</key>

    <string>Kerberos:$1</string>

    <key>dsAttributeString</key>

    <string>dsAttrTypeStandard:AltSecurityIdentities</string>

    </dict>

    <key>TrustedAuthorities</key>

    <array>

    <string>SHA256HASHOFCERTDOMAIN1,SHA256HASHOFCERTDOMAIN2</string>

    </array>

    </dict>

    </plist>

    [discrete]

    ==== Smartcard Enforcement Exemption

    [discrete]

    ===== Group Exemption

    Starting in macOS 10.15, enforcement on a system can be granularly configured by adding a field to /private/etc/SmartcardLogin.plist. The NotEnforcedGroup can be added to the file to list a Directory group that will not be included in smartcard enforcement. In order to activate this feature, enforceSmartCard and allowUnmappedUsers must be applied via a configuration profile (com.apple.security.smartcard).

    To configure the NotEnforcedGroup, the SmartcardLogin.plist should be minimally configured as follows:

    <?xml version="1.0" encoding="UTF-8"?>

    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">

    <plist version="1.0">

    <dict>

    <key>AttributeMapping</key>

    <dict>

    <key>fields</key>

    <array>

    <string>NT Principal Name</string>

    </array>

    <key>formatString</key>

    <string>Kerberos:$1</string>

    <key>dsAttributeString</key>

    <string>dsAttrTypeStandard:AltSecurityIdentities</string>

    </dict>

    <key>TrustedAuthorities</key>

    <array>

    <string>SHA256HASHOFCERTDOMAIN1,SHA256HASHOFCERTDOMAIN2</string>

    </array>

    <key>NotEnforcedGroup</key>

    <string>EXEMPTGROUP</key>

    </dict>

    </plist>

    Once a system is configured for the NotEnforcedGroup a user can be added to the assigned group by running the following:

    /usr/sbin/dseditgroup -o edit -a <exemptuser> -t user <notenforcegroup>

    [discrete]

    ===== User Exemption

    Alternatively, if a single user needs to be exempt for a period of time, kDSNativeAttrTypePrefix:SmartCardEnforcement can be set in the user''s Open Directory record. The following values can be set:

    0 - The system default is respected.

    1 - Smartcard enforcement is enabled.

    * 2 - Smartcard enforcement is disabled.

    NOTE: In Active Directory environments, the value of the userAccountControl attribute is respected.

    Run the following command to set the exemption when booted from macOS:

    /usr/bin/dscl . -append /Users/<username> SmartCardEnforcement 2

    Run the following command to set the exemption when booted from Recovery:

    /usr/bin/defaults write /Volumes/Macintosh\ HD/var/db/dslocal/nodes/Default/users/<username> SmartCardEnforcement -array-add 2

    NOTE: When booted to recovery on an Apple Silicon Mac, run the following after setting the exemption.

    /usr/sbin/diskutil apfs updatePreboot /Volumes/Macintosh\ HD

    [discrete]

    ===== Temporary Exemption

    On an Apple Silicon Mac, if a temporary exemption is needed, security filevault skip-sc-enforcement will disable smartcard enforcement on next boot only.

    Run the following command to set the temporary exemption when booted from Recovery:

    /usr/bin/security filevault skip-sc-enforcement <data volume UUID> set

    To obtain the data volume UUID run the following:

    /usr/sbin/diskutil apfs listGroups | /usr/bin/awk -F: ''/ Data/ { getline; gsub(/ /,""); print $2}''

    [discrete]

    ==== Pluggable Authentication Module (PAM)

    Terminal sessions in macOS can be configured for smartcard enforcement by modifying the PAM modules for sudo, su, and login.

    /etc/pam.d/sudo

    # sudo: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        required      pamopendirectory.so

    auth        required      pamdeny.so

    account     required      pampermit.so

    password    required      pamdeny.so

    session     required      pampermit.so

    /etc/pam.d/su

    # su: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        required      pamrootok.so

    auth        required      pamgroup.so nowarn group=admin,wheel ruser rootonly failsafe

    account     required      pampermit.so

    account     required      pamopendirectory.so nocheckshell

    password    required      pamopendirectory.so

    session     required      pamlaunchd.so

    /etc/pam.d/login

    # login: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        optional      pamkrb5.so usekcminit

    auth        optional      pamntlm.so tryfirstpass

    auth        optional      pammount.so tryfirstpass

    auth        required      pamopendirectory.so tryfirstpass

    auth        required      pamdeny.so

    account     required      pamnologin.so

    account     required      pamopendirectory.so

    password    required      pamopendirectory.so

    session     required      pamlaunchd.so

    session     required      pamuwtmp.so

    session     optional      pammount.so

    [discrete]

    ==== Screen Sharing and Screen Recording

    macOS will disable support for TouchID, Watch, or Smartcard authentication when being watched or recorded. This can cause certain portions of the system to not recognize your smartcard.

    In Unified Logging you''ll notice an entry such as

    2022-07-14 16:45:46.880038-0400 0x2F97 Info 0xC8D2 1600 SecurityAgent: (SecurityAgent) [com.apple.Authorization:SecurityAgent] Screen is being watched, no Touch ID, Watch or SmartCard support is allowed

    This can be remediated by writing the preference domain com.apple.authorization with the key ignoreARD.

    defaults write com.apple.Authorization ignoreARD -bool true

    Or applied system wide with a configuration profile named com.apple.security.authorization.mobileconfig in the project''s includes folder.

    <key>PayloadType</key>

    <string>com.apple.security.authorization</string>

    <key>ignoreArd</key>

    <true/>'
  resolution: ''
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cnssi_1253_low
  contributors: macos_security_compliance_project
---
