# Fleet policies for macOS 26.0: Security Configuration - US CMMC 2.0 Level 1
# Generated from macOS Security Compliance Project

apiVersion: v1
kind: policy
spec:
  name: macOS Security - Allow Smartcard Authentication
  platforms: macOS
  platform: darwin
  description: 'Smartcard authentication MUST be allowed.

    The use of smartcard credentials facilitates standardization and reduces the risk of unauthorized access.

    When enabled, the smartcard can be used for login, authorization, and screen saver unlocking.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Smartcard Authentication
  platforms: macOS
  platform: darwin
  description: 'Smartcard authentication MUST be enforced.

    The use of smartcard credentials facilitates standardization and reduces the risk of unauthorized access.

    When enforceSmartCard is set to "true", the smartcard must be used for login, authorization, and unlocking the screensaver.

    CAUTION: enforceSmartCard will apply to the whole system. No users will be able to login with their password unless the profile is removed or a user is exempt from smartcard enforcement.

    NOTE: enforceSmartcard requires allowSmartcard to be set to true in order to work.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Password Authentication for SSH
  platforms: macOS
  platform: darwin
  description: 'If remote login through SSH is enabled, password based authentication MUST be disabled for user login.

    All users MUST go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

    NOTE: /etc/ssh/sshd_config will be automatically modified to its original state following any update or major upgrade to the operating system.'
  resolution: 'includedir=$(/usr/bin/awk ''/^Include/ {print $2}'' /etc/ssh/sshdconfig | /usr/bin/tr -d '''')

    if [[ -z $includedir ]]; then

    /usr/bin/sed -i.bk "1s/./Include \/etc\/ssh\/sshdconfig.d\/\*/" /etc/ssh/sshdconfig

    fi

    echo "passwordauthentication no" >> "${includedir}01-mscp-sshd.conf"

    echo "kbdinteractiveauthentication no" >> "${includedir}01-mscp-sshd.conf"

    for file in $(ls ${includedir}); do

    if [[ "$file" == "100-macos.conf" ]]; then

    continue

    fi

    if [[ "$file" == "01-mscp-sshd.conf" ]]; then

    break

    fi

    /bin/mv ${includedir}${file} ${includedir}20-${file}

    done'
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Address Book
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Contacts.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data, and, therefore, automated contact synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the System Setting for Apple ID
  platforms: macOS
  platform: darwin
  description: 'The system setting for Apple ID MUST be disabled.

    Disabling the system setting prevents login to Apple ID and iCloud.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Bookmarks
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Safari.app bookmark synchronization via the iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated bookmark synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the iCloud Calendar Services
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Calendar.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated calendar synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Document Sync
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in iCloud document synchronization service MUST be disabled to prevent organizational data from being synchronized to personal or non-approved storage.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated document synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the iCloud Freeform Services
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Freeform.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated calendar synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Game Center
  platforms: macOS
  platform: darwin
  description: 'This works only with supervised devices (MDM) and allows to disable Apple Game Center. The rationale is Game Center is using Apple ID and will shared data on AppleID based services, therefore, Game Center MUST be disabled.

    This setting also prohibits functionality of adding friends to Game Center.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Keychain Sync
  platforms: macOS
  platform: darwin
  description: 'The macOS system''s ability to automatically synchronize a user''s passwords to their iCloud account MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, password management and synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Mail
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Mail.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated mail synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Notes
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Notes.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated Notes synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Photo Library
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Photos.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated photo synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Private Relay
  platforms: macOS
  platform: darwin
  description: 'Enterprise networks may be required to audit all network traffic by policy, therefore, iCloud Private Relay MUST be disabled.

    Network administrators can also prevent the use of this feature by blocking DNS resolution of mask.icloud.com and mask-h2.icloud.com.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Reminders
  platforms: macOS
  platform: darwin
  description: 'The macOS built-in Reminders.app connection to Apple''s iCloud service MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated reminders synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Desktop and Document Folder Sync
  platforms: macOS
  platform: darwin
  description: 'The macOS system''s ability to automatically synchronize a user''s desktop and documents folder to their iCloud Drive MUST be disabled.

    Apple''s iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated file synchronization MUST be controlled by an organization approved service.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.1.1.3 (level 2)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable AppleID and Internet Account Modifications
  platforms: macOS
  platform: darwin
  description: "The system MUST disable account modification. \nAccount modification includes adding additional or modifying internet accounts in Apple Mail, Calendar, Contacts, in the Internet Account System Setting Pane, or the AppleID System Setting Pane.\nThis prevents the addition of unauthorized accounts.\n[IMPORTANT]\n====\nSome organizations may allow the use and configuration of the built-in Mail.app, Calendar.app, and Contacts.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the Internet Accounts System Preference pane to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.\n===="
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable AirDrop
  platforms: macOS
  platform: darwin
  description: 'AirDrop MUST be disabled to prevent file transfers to or from unauthorized devices.

    AirDrop allows users to share and receive files from other nearby Apple devices.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.1.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple ID Setup during Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for Apple ID setup during Setup Assistant MUST be disabled.

    macOS will automatically prompt new users to set up an Apple ID while they are going through Setup Assistant if this is not disabled, misleading new users to think they need to create Apple ID accounts upon their first login.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Authenticated Root
  platforms: macOS
  platform: darwin
  description: 'Authenticated Root MUST be enabled.

    When Authenticated Root is enabled the macOS is booted from a signed volume that is cryptographically protected to prevent tampering with the system volume.

    NOTE: Authenticated Root is enabled by default on macOS systems.

    WARNING: If more than one partition with macOS is detected, the csrutil command will hang awaiting input.'
  resolution: '/usr/bin/csrutil authenticated-root enable

    NOTE: To re-enable "Authenticated Root", boot the affected system into "Recovery" mode, launch "Terminal" from the "Utilities" menu, and run the command.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.4 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Installation of XProtect Remediator and Gatekeeper Updates Automatically
  platforms: macOS
  platform: darwin
  description: 'Software Update MUST be configured to update XProtect Remediator and Gatekeeper automatically.

    This setting enforces definition updates for XProtect Remediator and Gatekeeper; with this setting in place, new malware and adware that Apple has added to the list of malware or untrusted software will not execute. These updates do not require the computer to be restarted.

    link:https://support.apple.com/en-us/HT207005[]

    NOTE: Software update will automatically update XProtect Remediator and Gatekeeper by default in the macOS.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.5 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Dictation
  platforms: macOS
  platform: darwin
  description: Dictation MUST be disabled on Intel based Macs as the feature On Device Dictation is only available on Apple Silicon devices.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable FileVault Automatic Login
  platforms: macOS
  platform: darwin
  description: 'If FileVault is enabled, automatic login MUST be disabled, so that both FileVault and login window authentication are required.

    The default behavior of macOS when FileVault is enabled is to automatically log in to the computer once successfully passing your FileVault credentials.

    NOTE: DisableFDEAutoLogin does not have to be set on Apple Silicon based macOS systems that are smartcard enforced as smartcards are available at pre-boot.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Firmware Password
  platforms: macOS
  platform: darwin
  description: 'A firmware password MUST be enabled and set.

    Single user mode, recovery mode, the Startup Manager, and several other tools are available on macOS by holding the "Option" key down during startup. Setting a firmware password restricts access to these tools.

    To set a firmware passcode use the following command:

    /usr/sbin/firmwarepasswd -setpasswd

    NOTE: If firmware password or passcode is forgotten, the only way to reset the forgotten password is through the use of a machine specific binary generated and provided by Apple. Schedule a support call, and provide proof of purchase before the firmware binary will be generated.

    NOTE: Firmware passwords are not supported on Apple Silicon devices. This rule is only applicable to Intel devices.'
  resolution: 'NOTE: See discussion on remediation and how to enable firmware password.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Gatekeeper
  platforms: macOS
  platform: darwin
  description: 'Gatekeeper MUST be enabled.

    Gatekeeper is a security feature that ensures that applications are digitally signed by an Apple-issued certificate before they are permitted to run. Digital signatures allow the macOS host to verify that the application has not been modified by a malicious third party.

    Administrator users will still have the option to override these settings on a case-by-case basis.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.5 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Genmoji AI Creation
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Genmoji MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Handoff
  platforms: macOS
  platform: darwin
  description: 'Handoff MUST be disabled.

    Handoff allows you to continue working on a document or project when the user switches from one Apple device to another. Disabling Handoff prevents data transfers to unauthorized devices.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Secure User's Home Folders
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to prevent access to other user''s home folders.

    The default behavior of macOS is to allow all valid users access to the top level of every other user''s home folder while restricting access only to the Apple default folders within.'
  resolution: 'IFS=$''\n''

    for userDirs in $( /usr/bin/find /System/Volumes/Data/Users -mindepth 1 -maxdepth 1 -type d ! \( -perm 700 -o -perm 711 \) | /usr/bin/grep -v "Shared" | /usr/bin/grep -v "Guest" ); do

    /bin/chmod og-rwx "$userDirs"

    done

    unset IFS'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Built-in Web Server
  platforms: macOS
  platform: darwin
  description: 'The built-in web server which is managed by launchd is a non-essential service built into macOS and MUST be disabled and not running.

    NOTE: The built in web server service is disabled at startup by default macOS.'
  resolution: '/usr/sbin/apachectl stop 2>/dev/null

    /bin/launchctl disable system/org.apache.httpd'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_4.2 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iCloud Storage Setup during Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt to set up iCloud storage services during Setup Assistant MUST be disabled.

    The default behavior of macOS is to prompt new users to set up storage in iCloud. Disabling the iCloud storage setup prompt provides organizations more control over the storage of their data.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Image Playground
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Image Playground MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable iPhone Mirroring
  platforms: macOS
  platform: darwin
  description: iPhone Mirroing MUST be disabled to prevent file transfers to or from unauthorized devices. Disabling iPhone Mirroring also prevents potentially unauthorized applications from appearing as if they are installed on the Mac.
  resolution: This is implemented by a Configuration Profile
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Mail Smart Replies
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Mail Smart Replies that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Mail Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Apple Mail Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.3 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Network File System Service
  platforms: macOS
  platform: darwin
  description: Support for Network File Systems (NFS) services is non-essential and, therefore, MUST be disabled.
  resolution: '/bin/launchctl disable system/com.apple.nfsd

    /bin/rm -rf /etc/exports

    The system may need to be restarted for the update to take effect.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_4.3 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Notes Transcription
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Notes Transcription that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.4 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Notes Transcription Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Notes Transcription Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.4 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce On Device Dictation
  platforms: macOS
  platform: darwin
  description: 'Dictation MUST be restricted to on device only to prevent potential data exfiltration.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.18.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Photos Enhanced Visual Search
  platforms: macOS
  platform: darwin
  description: 'Enhanced Visualed Search MUST be disabled in the Photos app.

    The information system MUST be configured to provide only essential capabilities. Disabling Enhanced Visual Search will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Rapid Security Response Mechanism
  platforms: macOS
  platform: darwin
  description: Rapid security response mechanism MUST be enabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable User Ability from Being Able to Undo Rapid Security Responses
  platforms: macOS
  platform: darwin
  description: Rapid security response (RSR) mechanism MUST be enabled and the ability for the user to disable RSR MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Recovery Lock
  platforms: macOS
  platform: darwin
  description: 'A recovery lock password MUST be enabled and set.

    Single user mode, recovery mode, the Startup Manager, and several other tools are available on macOS by holding down specific key combinations during startup. Setting a recovery lock restricts access to these tools.

    IMPORTANT: Recovery lock passwords are not supported on Intel devices. This rule is only applicable to Apple Silicon devices.'
  resolution: 'NOTE: The SetRecoveryLock command can be used to set a Recovery Lock password and must be from your MDM.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Root Login
  platforms: macOS
  platform: darwin
  description: 'To assure individual accountability and prevent unauthorized access, logging in as root at the login window MUST be disabled.

    The macOS system MUST require individuals to be authenticated with an individual authenticator prior to using a group authenticator, and administrator users MUST never log in directly as root.'
  resolution: /usr/bin/dscl . -create /Users/root UserShell /usr/bin/false
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.6 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Safari Reader Summary
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as Safari Reader Summary that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure System Integrity Protection is Enabled
  platforms: macOS
  platform: darwin
  description: 'System Integrity Protection (SIP) MUST be enabled.

    SIP is vital to protecting the integrity of the system as it prevents malicious users and software from making unauthorized and/or unintended modifications to protected files and folders; ensures the presence of an audit record generation capability for defined auditable events for all operating system components; protects audit tools from unauthorized access, modification, and deletion; restricts the root user account and limits the actions that the root user can perform on protected parts of the macOS; and prevents non-privileged users from granting other users direct access to the contents of their home directories and folders.

    NOTE: SIP is enabled by default in macOS.'
  resolution: '/usr/bin/csrutil enable

    NOTE: To reenable "System Integrity Protection", boot the affected system into "Recovery" mode, launch "Terminal" from the "Utilities" menu, and run the command.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.1.2 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Siri Setup during Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for Siri during Setup Assistant MUST be disabled.

    Organizations MUST apply organization-wide configuration settings. The macOS Siri Assistant Setup prompt guides new users through enabling their own specific Siri settings; this is not essential and, therefore, MUST be disabled to prevent against the risk of individuals electing Siri settings with the potential to override organization-wide settings.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence During Setup Assistant
  platforms: macOS
  platform: darwin
  description: The prompt for setting up Apple Intelligence during Setup Assistant MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Unlock with Apple Watch During Setup Assistant
  platforms: macOS
  platform: darwin
  description: 'The prompt for Apple Watch unlock setup during Setup Assistant MUST be disabled.

    Disabling Apple watches is a necessary step to ensuring that the information system retains a session lock until the user reestablishes access using an authorized identification and authentication procedures.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Trivial File Transfer Protocol Service
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Trivial File Transfer Protocol (TFTP), support it is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling TFTP helps prevent the unauthorized connection of devices and the unauthorized transfer of information.

    NOTE: TFTP service is disabled at startup by default macOS.'
  resolution: "/bin/launchctl bootout system/com.apple.tftpd \n/bin/launchctl disable system/com.apple.tftpd\nThe system may need to be restarted for the update to take effect."
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Login to Other User's Active and Locked Sessions
  platforms: macOS
  platform: darwin
  description: 'The ability to log in to another user''s active or locked session MUST be disabled.

    macOS has a privilege that can be granted to any user that will allow that user to unlock active user''s sessions. Disabling the admins and/or user''s ability to log into another user''s active and locked session prevents unauthorized persons from viewing potentially sensitive and/or personal information.

    NOTE: Configuring this setting will change the user experience and disable TouchID from unlocking the screensaver. A configuration profile will be generated to include the setting that restores the expected behavior. You can also apply the settings using /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.loginwindow screenUnlockMode -int 1.

    WARNING: This rule may cause issues when platformSSO is configured.'
  resolution: 'SSRULE=$(/usr/bin/security -q authorizationdb read system.login.screensaver 2>&1 | /usr/bin/xmllint --xpath "//dict/key[.=''rule'']/following-sibling::array[1]/string/text()" -)

    if [[ "$SSRULE" == psso ]]; then

    /usr/bin/security -q authorizationdb read psso-screensaver > "/tmp/psso-screensaver-mscp.plist"

    /usr/bin/sed -i.bak ''s/<string>authenticate-session-owner-or-admin<\/string>/<string>$ODV<\/string>/'' /tmp/psso-screensaver-mscp.plist

    /usr/bin/security -q authorizationdb write psso-screensaver-mscp < /tmp/psso-screensaver-mscp.plist

    /usr/bin/security -q authorizationdb write system.login.screensaver psso-screensaver-mscp 2>&1

    else

    /usr/bin/security -q authorizationdb write system.login.screensaver "$ODV" 2>&1

    fi'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_5.7 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Unix-to-Unix Copy Protocol Service
  platforms: macOS
  platform: darwin
  description: 'The system MUST not have the Unix-to-Unix Copy Protocol (UUCP) service active.

    UUCP, a set of programs that enable the sending of files between different UNIX systems as well as sending commands to be executed on another system, is not essential and MUST be disabled in order to prevent the unauthorized connection of devices, transfer of information, and tunneling.

    NOTE: UUCP service is disabled at startup by default macOS.'
  resolution: "/bin/launchctl bootout system/com.apple.uucp \n/bin/launchctl disable system/com.apple.uucp\nThe system may need to be restarted for the update to take effect."
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Apple Intelligence Writing Tools
  platforms: macOS
  platform: darwin
  description: Apple Intelligence features such as writing tools that use off device AI MUST be disabled.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.2 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Unattended or Automatic Logon to the System
  platforms: macOS
  platform: darwin
  description: 'Automatic logon MUST be disabled.

    When automatic logons are enabled, the default user account is automatically logged on at boot time without prompting the user for a password. Even if the screen is later locked, a malicious user would be able to reboot the computer and find it already logged in. Disabling automatic logons mitigates this risk.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.3 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Bluetooth Sharing
  platforms: macOS
  platform: darwin
  description: 'Bluetooth Sharing MUST be disabled.

    Bluetooth Sharing allows users to wirelessly transmit files between the macOS and Bluetooth-enabled devices, including personally owned cellphones and tablets. A malicious user might introduce viruses or malware onto the system or extract sensitive files via Bluetooth Sharing. When Bluetooth Sharing is disabled, this risk is mitigated.

    [NOTE]

    ====

    The check and fix are for the last logged in user. To get the last logged in user, run the following.

    CURRENT_USER=$( /usr/bin/defaults read /Library/Preferences/com.apple.loginwindow lastUserName )

    ===='
  resolution: /usr/bin/sudo -u "$CURRENT_USER" /usr/bin/defaults -currentHost write com.apple.Bluetooth PrefKeyServicesEnabled -bool false
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.10 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Critical Security Updates to be Installed
  platforms: macOS
  platform: darwin
  description: Ensure that security updates are installed as soon as they are available from Apple.
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_1.5 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Sending Diagnostic and Usage Data to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability to submit diagnostic data to Apple MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of diagnostic and usage information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable External Intelligence Integrations
  platforms: macOS
  platform: darwin
  description: 'Integration with external intelligence systems MUST be disabled unless approved by the organization. Disabling external intelligence integration will mitigate the risk of data being sent to unapproved third party.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable External Intelligence Integration Sign In
  platforms: macOS
  platform: darwin
  description: 'The ability to sign into an external intelligence systems MUST be disabled unless approved by the organiztion. Disabling external intelligence integration will mitigate the risk of data being sent to unapproved third party.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.1.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Find My Service
  platforms: macOS
  platform: darwin
  description: 'The Find My service MUST be disabled.

    A Mobile Device Management (MDM) solution MUST be used to carry out remote locking and wiping instead of Apple''s Find My service.

    Apple''s Find My service uses a personal AppleID for authentication. Organizations should rely on MDM solutions, which have much more secure authentication requirements, to perform remote lock and remote wipe.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable macOS Application Firewall
  platforms: macOS
  platform: darwin
  description: 'The macOS Application Firewall is the built-in firewall that comes with macOS, and it MUST be enabled.

    When the macOS Application Firewall is enabled, the flow of information within the information system and between interconnected systems will be controlled by approved authorizations.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.2.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable Firewall Stealth Mode
  platforms: macOS
  platform: darwin
  description: 'Firewall Stealth Mode MUST be enabled.

    When stealth mode is enabled, the Mac will not respond to any probing requests, and only requests from authorized applications will still be authorized.

    [IMPORTANT]

    ====

    Enabling firewall stealth mode may prevent certain remote mechanisms used for maintenance and compliance scanning from properly functioning. Information System Security Officers (ISSOs) are advised to first fully weigh the potential risks posed to their organization before opting not to enable stealth mode.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 WHERE EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.security.firewall' AND name='EnableStealthMode' AND (value = 1 OR value = 'true'));
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.2.2 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Guest Access to Shared SMB Folders
  platforms: macOS
  platform: darwin
  description: 'Guest access to shared Server Message Block (SMB) folders MUST be disabled.

    Turning off guest access prevents anonymous users from accessing files shared via SMB.'
  resolution: /usr/sbin/sysadminctl -smbGuestAccess off
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.2 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Guest Account
  platforms: macOS
  platform: darwin
  description: 'Guest access MUST be disabled.

    Turning off guest access prevents anonymous users from accessing files.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.13.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Sending Audio Recordings and Transcripts to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability for Apple to store and review audio of your audio recordings and transcripts of your vocal shortcuts and voice control interactions MUST be disabled. This will disable "Improve Assistive Voice Features" in Privacy & Security within System Settings.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of this information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.3 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Improve Search Information to Apple
  platforms: macOS
  platform: darwin
  description: 'Sending data to Apple to help improve search MUST be disabled. This will disable "Improve Search" within Spotlight in System Settings.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of search data will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.9.1
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Improve Siri and Dictation Information to Apple
  platforms: macOS
  platform: darwin
  description: 'The ability for Apple to store and review audio of your Siri and Dictation interactions MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling the submission of Siri and Dictation information will mitigate the risk of unwanted data being sent to Apple.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.3.2 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable the Internet Accounts System Preference Pane
  platforms: macOS
  platform: darwin
  description: 'The Internet Accounts System Setting MUST be disabled to prevent the addition of unauthorized internet accounts.

    [IMPORTANT]

    ====

    Some organizations may allow the use and configuration of the built-in Mail.app, Calendar.app, and Contacts.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the Internet Accounts System Preference pane to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.

    ===='
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Internet Sharing
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Internet sharing, support for it is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling Internet sharing helps prevent the unauthorized connection of devices, unauthorized transfer of information, and unauthorized tunneling.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.7 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Configure Login Window to Prompt for Username and Password
  platforms: macOS
  platform: darwin
  description: 'The login window MUST be configured to prompt all users for both a username and a password.

    By default, the system displays a list of known users on the login window, which can make it easier for a malicious user to gain access to someone else''s account. Requiring users to type in both their username and password mitigates the risk of unauthorized users gaining access to the information system.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.11.4 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Media Sharing
  platforms: macOS
  platform: darwin
  description: 'Media sharing MUST be disabled.

    When Media Sharing is enabled, the computer starts a network listening service that shares the contents of the user''s music collection with other users in the same subnet.

    The information system MUST be configured to provide only essential capabilities. Disabling Media Sharing helps prevent the unauthorized connection of devices and the unauthorized transfer of information. Disabling Media Sharing mitigates this risk.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.9 (level 2)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Personalized Advertising
  platforms: macOS
  platform: darwin
  description: 'Ad tracking and targeted ads MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling ad tracking ensures that applications and advertisers are unable to track users'' interests and deliver targeted advertisements.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.4 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Remote Apple Events
  platforms: macOS
  platform: darwin
  description: 'If the system does not require Remote Apple Events, support for Apple Remote Events is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling Remote Apple Events helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling.'
  resolution: '/usr/sbin/systemsetup -setremoteappleevents off

    /bin/launchctl disable system/com.apple.AEServer

    NOTE: Systemsetup with -setremoteappleevents flag will fail unless you grant Full Disk Access to systemsetup or its parent process. Requires supervision.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.6 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Screen Sharing and Apple Remote Desktop
  platforms: macOS
  platform: darwin
  description: 'Support for both Screen Sharing and Apple Remote Desktop (ARD) is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities. Disabling screen sharing and ARD helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling.'
  resolution: '/bin/launchctl bootout system/com.apple.screensharing

    /bin/launchctl disable system/com.apple.screensharing

    NOTE - This will apply to the whole system'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Automatic Installs of Available Security Updates using DDM.
  platforms: macOS
  platform: darwin
  description: Ensure that available security updates are installed as soon as they are available from Apple and that the user cannot modify the setting within System Settings.
  resolution: This is implemented by Declarative Device Management (DDM).
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Siri
  platforms: macOS
  platform: darwin
  description: 'Support for Siri is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: This is implemented by a Configuration Profile.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.5.2.1 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable Server Message Block Sharing
  platforms: macOS
  platform: darwin
  description: 'Support for Server Message Block (SMB) file sharing is non-essential and MUST be disabled.

    The information system MUST be configured to provide only essential capabilities.'
  resolution: '/bin/launchctl disable system/com.apple.smbd

    The system may need to be restarted for the update to take effect.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.2 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Disable SSH Server for Remote Access Sessions
  platforms: macOS
  platform: darwin
  description: SSH service MUST be disabled for remote access.
  resolution: '/usr/sbin/systemsetup -f -setremotelogin off >/dev/null

    /bin/launchctl disable system/com.openssh.sshd

    NOTE: Systemsetup with -setremotelogin flag will fail unless you grant Full Disk Access to systemsetup or its parent process. Requires supervision.'
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.3.3.4 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enable SSH Server for Remote Access Sessions
  platforms: macOS
  platform: darwin
  description: Remote access sessions MUST use encrypted methods to protect unauthorized individuals from gaining access.
  resolution: /bin/launchctl enable system/com.openssh.sshd
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Require Administrator Password to Modify System-Wide Preferences
  platforms: macOS
  platform: darwin
  description: 'The system MUST be configured to require an administrator password in order to modify the system-wide preferences in System Settings.

    Some Preference Panes in System Settings contain settings that affect the entire system. Requiring a password to unlock these system-wide settings reduces the risk of a non-authorized user modifying system configurations.'
  resolution: "authDBs=(\"system.preferences\" \"system.preferences.energysaver\" \"system.preferences.network\" \"system.preferences.printing\" \"system.preferences.sharing\" \"system.preferences.softwareupdate\" \"system.preferences.startupdisk\" \"system.preferences.timemachine\")\nfor section in ${authDBs[@]}; do\n/usr/bin/security -q authorizationdb read \"$section\" > \"/tmp/$section.plist\"\nclasskeyvalue=$(/usr/libexec/PlistBuddy -c \"Print :class\" \"/tmp/$section.plist\" 2>&1)\nif [[ \"$classkeyvalue\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :class string user\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :class user\" \"/tmp/$section.plist\"\nfi\nkeyvalue=$(/usr/libexec/PlistBuddy -c \"Print :shared\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$keyvalue\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :shared bool false\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :shared false\" \"/tmp/$section.plist\"\
    \nfi\nauthuserkey=$(/usr/libexec/PlistBuddy -c \"Print :authenticate-user\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$authuserkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :authenticate-user bool true\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :authenticate-user true\" \"/tmp/$section.plist\"\nfi\nsessionownerkey=$(/usr/libexec/PlistBuddy -c \"Print :session-owner\" \"/tmp/$section.plist\" 2>&1)  \t\nif [[ \"$sessionownerkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :session-owner bool false\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :session-owner false\" \"/tmp/$section.plist\"\nfi\ngroupkey=$(/usr/libexec/PlistBuddy -c \"Print :group\" \"/tmp/$section.plist\" 2>&1)\nif [[ \"$groupkey\" == \"Does Not Exist\" ]]; then\n/usr/libexec/PlistBuddy -c \"Add :group string admin\" \"/tmp/$section.plist\"\nelse\n/usr/libexec/PlistBuddy -c \"Set :group admin\" \"/tmp/$section.plist\"\nfi\n/usr/bin/security\
    \ -q authorizationdb write \"$section\" < \"/tmp/$section.plist\"\ndone"
  query: SELECT 1 FROM software_update WHERE software_update_required = '0';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_2.6.8 (level 1)
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Enforce Approved Authorization for Logical Access
  platforms: macOS
  platform: darwin
  description: 'The information system IS configured to enforce an approved authorization process before granting users logical access.

    The inherent configuration of the macOS does not grant users logical access without authorization. Authorization is achieved on the macOS through permissions, which are controlled at many levels, from the Mach and BSD components of the kernel, through higher levels of the operating system and, for networked applications, through the networking protocols. Permissions can be granted at the level of directories, subdirectories, files or applications, or specific data within files or functions within applications.

    link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Permissions/Permissions.html[]'
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Ensure the System Implements Malicious Code Protection Mechanisms
  platforms: macOS
  platform: darwin
  description: "The inherent configuration of the macOS IS in compliance as Apple has designed the system with three layers of protection against malware. Each layer of protection is comprised of one or more malicious code protection mechanisms, which are automatically implemented and which, collectively, meet the requirements of all applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance for malicious code prevention.\n1. This  first layer of defense targets the distribution of malware; the aim is to prevent malware from ever launching.\nThe following mechanisms are inherent to the macOS design and constitute the first layer of protection against malicious code:\nThe Apple App Store: the safest way to add new applications to a Mac is by downloading them from the App Store; all apps available for download from the App Store have been reviewed for signs of tampering and signed by Apple to indicate that the app meets security requirements and does\
    \ not contain malware.\nXProtect: a built-in, signature-based, anti-virus, anti-malware technology inherent to all Macs. XProtect automatically detects and blocks the execution of known malware.\nIn macOS 10.15 and all subsequent releases, XProtect checks for known malicious content when:\nan app is first launched,\nan app has been changed (in the file system), and\nXProtect signatures are updated.\nYARA: another built-in tool (inherent to all Macs), which conducts signature-based detection of malware. Apple updates YARA rules regularly.\nGatekeeper: a security feature inherent to all Macs; Gatekeeper scans apps to detect malware and/or revocations of a developer's signing certificate and prevents unsafe apps from running.\nNotarization: Apple performs regular, automated scans to detect signs of malicious content and to verify developer ID-signed software; when no issues are found, Apple notarizes the software and delivers the results of scans to the system owner.\n2. The second layer\
    \ of defense targets malware that manages to appear on a Mac before it runs; the aim is to quickly identify and block any malware present on a Mac in order to prevent the malware from running and further spreading.\nThe following mechanisms are inherent to the macOS design and constitute the second layer of protection against malicious code:\nXProtect (defined above).\nGatekeeper (defined above).\nNotarization (defined above).\n3.  The third layer of defense targets infected Mac system(s); the aim is to remediate Macs on which malware has managed to successfully execute.\nThe following mechanism is inherent to the macOS design and constitutes the third layer of protection against malicious code:\n*\tApple's XProtect: a technology included on all macOS systems. XProtect will remediate infections upon receiving updated information delivered and when infections are detected\nlink:https://support.apple.com/guide/security/protecting-against-malware-sec469d47bd8/1/web/1[]\nlink:https://support.apple.com/guide/security/app-security-overview-sec35dd877d0/web[]"
  resolution: The technology inherently meets this requirement. No fix is required.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Must Authenticate Before Establishing a Connection
  platforms: macOS
  platform: darwin
  description: Organizational devices requiring unique device-to-device identification and authentication may be defined by type, by device, or by a combination of type/device. Information systems typically use either shared known information (e.g., Media Access Control [MAC] or Transmission Control Protocol/Internet Protocol [TCP/IP] addresses) for device identification or organizational authentication solutions (e.g., IEEE 802.1x and Extensible Authentication Protocol [EAP], Radius server with EAP-Transport Layer Security [TLS] authentication, Kerberos) to identify/authenticate devices on local and/or wide area networks. Organizations determine the required strength of authentication mechanisms by the security categories of information systems. Because of the challenges of applying this control on large scale, organizations are encouraged to only apply the control to those limited number (and type) of devices that truly need to support this capability.
  resolution: This requirement is a permanent finding and can be fixed by implementing a third party solution.
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - CIS_N/A
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Out of Scope Supplemental
  platforms: macOS
  platform: darwin
  description: 'There are several requirements defined in National Institute of Standards and Technology (NIST) Special Publication (SP) 800-53, Security and Privacy Controls for Information Systems and Organizations, Revision 5 that can be met by making configuration changes to the operating system. However, NIST SP 800-53 (Rev. 5) contains a broad set of guidelines that attempt to address all aspects of an information system or systems within an organization. Because the macOS Security Compliance Project is tailored specifically to macOS, some requirements defined in NIST SP 800-53 (Rev. 5) are not applicable.

    This supplemental contains those controls that are assigned to a baseline in NIST SP 800-53 (Rev. 5) which cannot be addressed with a technical configuration for macOS. These controls can be accomplished though administrative or procedural processes within an organization or via integration of the macOS system into enterprise information systems which are configured to protect the systems within.

    [cols="15%h, 85%a"]

    |===

    |Family

    |Access Control (AC)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-1[AC-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-2[AC-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-3[AC-3(14)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-14[AC-14], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-17[AC-17(4)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AC-22[AC-22]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Awareness and Training (AT)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-1[AT-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-2[AT-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-3[AT-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AT-4[AT-4]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Audit and Accountability (AU)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AU-1[AU-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AU-6[AU-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=AU-9[AU-9(2)]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Security Assessment and Authorization (CA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-1[CA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-2[CA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-3[CA-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-3[CA-3(6)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-5[CA-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-6[CA-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-7[CA-7], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-7[CA-7(4)],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CA-9[CA-9]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Configuration Management (CM)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-1[CM-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-4[CM-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-8[CM-8], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-10[CM-10], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CM-11[CM-11]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Contingency Planning (CP)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-1[CP-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-2[CP-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-3[CP-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-4[CP-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-9[CP-9], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=CP-10[CP-10]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Identification and Authentication (IA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-1[IA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(1)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(3)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IA-8[IA-8(4)]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Incident Response (IR)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-1[IR-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-2[IR-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-4[IR-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-5[IR-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-6[IR-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-7[IR-7], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=IR-8[IR-8]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Maintenance (MA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MA-1[MA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MA-2[MA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MA-5[MA-5]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Media Protection (MP)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-1[MP-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-2[MP-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-6[MP-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=MP-7[MP-7]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Physical and Environmental Protection (PE)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-1[PE-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-2[PE-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-3[PE-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-6[PE-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-8[PE-8], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-12[PE-12], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-13[PE-13], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-14[PE-14],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-15[PE-15],  link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PE-16[PE-16]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Planning (PL)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PL-1[PL-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PL-2[PL-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PL-4[PL-4]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Personnel Security (PS)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-1[PS-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-2[PS-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-3[PS-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-4[PS-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-5[PS-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-6[PS-6], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-7[PS-7], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=PS-8[PS-8]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |Risk Assessment (RA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-1[RA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-2[RA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-3[RA-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=RA-5[RA-5]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |System and Services Acquisition (SA)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-1[SA-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-2[SA-2], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-3[SA-3], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-4[SA-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-4[SA-4(10)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-5[SA-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SA-9[SA-9]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |System and Communications Protection (SC)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-1[SC-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(3)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(7)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(8)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(18)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-7[SC-7(21)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-12[SC-12], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-12[SC-12(1)],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-20[SC-20], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-22[SC-22], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SC-23[SC-23]

    |===

    [cols="15%h, 85%a"]

    |===

    |Family

    |System and Information Integrity (SI)

    |Controls

    |link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-1[SI-1], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(4)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(5)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(12)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(14)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(20)],
    link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-4[SI-4(22)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-5[SI-5], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-7[SI-7(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-8[SI-8(2)], link:https://csrc.nist.gov/Projects/risk-management/sp800-53-controls/release-search#!/control?version=5.1&number=SI-12[SI-12]

    |==='
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - FileVault Supplemental
  platforms: macOS
  platform: darwin
  description: 'The supplemental guidance found in this section is applicable for the following rules:

    * systemsettingsfilevaultenforce

    In macOS the internal Apple File System (APFS) data volume can be protected by FileVault. The system volume is always cryptographically protected (T2 and Apple Silicon) and is a read-only volume.

    NOTE: FileVault uses an AES-XTS data encryption algorithm to protect full volumes of internal and external storage. Macs with a secure enclave (T2 and Apple Silicon) utilize the hardware security features of the architecture.

    FileVault is described in detail here: link:https://support.apple.com/guide/security/volume-encryption-with-filevault-sec4c6dc1b6e/web[].

    FileVault can be enabled in two ways within the macOS. It can be managed using the fdesetup command or by a Configuration Profile. When enabling FileVault via either of the aforementioned methods, you will be required to enter a username and password, which must be a local Open Directory account with a valid SecureToken password.

    [discrete]

    ==== Using the fdesetup Command

    When enabling FileVault via the command line in the Terminal application, you can run the following command.

    /usr/bin/fdesetup enable

    Running this command will prompt you for a username and password and then enable FileVault and return the personal recovery key. There are a number of management features available when managing FileVault via the command line that are not available when using a configuration profile. More information on these management features is available in the man page for fdesetup.

    NOTE: Apple has deprecated fdesetup command line tool from recognizing user name and password for security reasons and may remove the ability in future versions of macOS.

    [discrete]

    ==== Using a Configuration Profile

    When managing FileVault with a configuration profile, you must deploy a profile with the payload type com.apple.MCX.FileVault2. When using the Enable key to enable FileVault with a configuration profile, you must include 1 of the following:

    <key>Enable</key>

    <string>On</string>

    <key>Defer</key>

    <true/>

    <key>Enable</key>

    <string>On</string>

    <key>UserEntersMissingInfo</key>

    <true/>

    If using the Defer key it will prompt for the user name and password at logout.

    The UserEntersMissingInfo key will only work if installed through manual installation, and it will prompt for the username and password immediately.

    When using a configuration profile, you can escrow the Recovery key to a Mobile Device Management (MDM) server. Documentation for that can be found on Apple''s Developer site: link:https://developer.apple.com/documentation/devicemanagement/fderecoverykeyescrow[].

    It''s recommended that you use a Personal Recovery key instead of an Institutional key as it will generate a specific key for each device. You can find more guidance on choosing a recover key here: link:https://docs.jamf.com/technical-papers/jamf-pro/administering-filevault-macos/10.7.1/ChoosingaRecoveryKey.html[].

    NOTE: On Intel Macs, FileVault only supports password-based unlock and cannot be done using a smartcard. Smartcard unlock for FileVault is supported on Apple Silicon Macs.'
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Packet Filter (pf) Supplemental
  platforms: macOS
  platform: darwin
  description: 'The supplemental guidance found in this section is applicable for the following rules:

    osfirewalldefaultdenyrequire

    macOS contains an application layer firewall (ALF) and a packet filter (PF) firewall.

    The ALF can block incoming traffic on a per-application basis and prevent applications from gaining control of network ports, but it cannot be configured to block outgoing traffic.

    * More information on the ALF can be found here: https://support.apple.com/en-ca/HT201642

    The PF firewall can manipulate virtually any packet data and is highly configurable.

    ** More information on the BF firewall can be found here: https://www.openbsd.org/faq/pf/index.html

    Below is a script that configures ALF and the PF firewall to meet the requirements defined in NIST SP 800-53 (Rev. 5). The script will make sure the application layer firewall is enabled, set logging to "detailed", set built-in signed applications to automatically receive incoming connections, and set downloaded signed applications to automatically receive incoming connections. It will then create a custom rule set and copy com.apple.pfctl.plis from /System/Library/LaunchDaemons/ into the /Library/LaunchDaemons folder and name it 800-53.pfctl.plist. This is done to not conflict with the system''s pf ruleset.

    The custom pf rules are created at /etc/pf.anchors/80053pf_anchors.

    The ruleset will block connections on the following ports:

    [%header,width="100%",cols="3,7"]

    |===

    ^.^|Port

    ^.^|Service

    |548

    |Apple File Protocol (AFP)

    |1900

    |Bonjour

    |79

    |Finger

    |20, 21

    |File Transfer Protocol (FTP)

    |80

    |HTTP

    |icmp

    |ping

    |143

    |Internet Message Access Protocol (IMAP)

    |993

    |Internet Message Access Protocol over SSL (IMAPS)

    |3689

    |Music Sharing

    |5353

    |mDNSResponder

    |2049

    |Network File System (NFS)

    |49152

    |Optical Media Sharing

    |110

    |Post Office Protocol (POP3)

    |995

    |Post Office Protocol Secure (POP3S)

    |631

    |Printer Sharing

    |3031

    |Remote Apple Events

    |5900

    |Screen Sharing

    |137, 138, 138, 445

    |Samba (SMB)

    |25

    |Simple Mail Transfer Protocol (SMTP)

    |22

    |Secure Shell (SSH)

    |23

    |Telnet

    |69

    |Trivial File Transfer Protocol (TFTP)

    |540

    |Unix-to-Unix Copy (UUCP)

    |===

    For more on configuring the PF firewall check out the man pages on pf.conf and pfctl.

    include::../../includes/enablePF-mscp.sh[]'
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Password Policy Supplemental
  platforms: macOS
  platform: darwin
  description: "To comply with Executive Order 14028, Improving the Nation's Cybersecurity, OMB M-22-09, Moving the U.S. Government Toward Zero Trust Cybersecurity Principles, and NIST SP-800-63b, Digital Identity Guidelines: Authentication and Lifecycle Management federal, military, and intelligence communities must adopt the following configuration settings: \nPassword policies must not require the use of complexity policies such as upper characters, lower characters, or special characters. \nPassword policies must also not require the use of regular rotation. \nIn accordance with these requirements, the following rules, while they remain on specific benchmarks, have been removed from any of the NIST 800-53r5 baselines as recommendations.\npwpolicyalphanumericenforce\npwpolicycustomregexenforce\npwpolicylowercasecharacterenforce.yaml\npwpolicymaxlifetimeenforce\npwpolicyminimumlifetimeenforce\npwpolicypreventdictionarywords\npwpolicysimplesequencedisable\npwpolicyspecialcharacterenforce\n\
    pwpolicyuppercasecharacterenforce.yaml\nIf an organization has requirements to implement additional password policies, the remainder of this supplemental discusses the following password policy rules:\npwpolicylowercasecharacterenforce\npwpolicyuppercasecharacterenforce\npwpolicyaccountinactivityenforce\npwpolicyminimumlifetimeenforce\nPassword policies should be enforced as much as possible via Configuration Profiles. However, the following policies are currently not enforceable via Configuration Profiles, and must therefore be enabled using the pwpolicy command:\nEnforcing at least 1 lowercase character\nEnforcing at least 1 uppercase character\nDisabling an account after 35 days of inactivity\n* Password minimum lifetime\nTo set the local policy to meet these requirements, save the following XML password policy to a file.\ninclude::../../includes/pwpolicy.xml[]\nRun the following command to load the new policy file, substituting the path to the file in place of \"$pwpolicyfile\".\n\
    /usr/bin/pwpolicy setaccountpolicies $pwpolicy_file\n[NOTE]\n====\nIf directory services is being utilized, password policies should come from the domain.\n====\n[WARNING]\n====\nIn order to apply any password policy, the allowPasscodeModification setting in com.apple.applicationaccess must not be set to false.\n===="
  resolution: ''
  query: SELECT 1 FROM managed_policies WHERE domain = 'com.apple.applicationaccess';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
apiVersion: v1
kind: policy
spec:
  name: macOS Security - Smartcard Supplemental
  platforms: macOS
  platform: darwin
  description: 'The supplemental guidance found in this section is applicable for the following rules:

    authsshpasswordauthenticationdisable

    authsmartcardenforce

    authsmartcardcertificatetrustenforcemoderate

    authsmartcardcertificatetrustenforcehigh

    authsmartcardallow

    authpamsudosmartcardenforce

    authpamsusmartcardenforce

    authpamloginsmartcardenforce

    macOS supports smartcards, such as U.S. Personal Identity Verification (PIV) cards and U.S. Department of Defense Common Access Cards (CAC). Smartcards can be used on a macOS for the following:

    Authentication (Loginwindow, Screensaver, SSH, PKINIT, Safari, Finder, and PAM Authorization (sudo, login, and su) )

    Digital Encryption

    Digital Signing

    Remote Access (VPN:L2TP)

    Port-based Network Access Control (802.1X)

    Keychain Unlock

    macOS has built-in support for USB CCID class-compliant smartcard readers.

    [discrete]

    ==== Smartcard Pairing

    The default method for using smartcards in macOS is a method called "local account pairing". Local account pairing is automatically initiated when a user inserts a smartcard into the Mac. The user is prompted to pair their smartcard with their account. If a user receives a new smartcard, the previous card must be unpaired, and the new card paired to the account. Local account pairing employs fixed key mapping with the hash of a public key on the user''s smartcard with a local account.

    [discrete]

    ==== Smartcard Attribute Mapping

    Smartcards can be used to authenticate against a directory via attribute mapping configured in /private/etc/SmartcardLogin.plist. This file takes precedence over local account pairing. Attribute mapping matches the configured certificate field values from the smart card to the value in a directory. This may be used with network accounts, mobile accounts, or local accounts.

    [discrete]

    ==== Smartcard Management in macOS

    The following settings are available to manage smartcards (com.apple.security.smartcard):

    [%header,cols="2,1,7"]

    |===

    |Key

    |Type

    |Value

    <.^|userPairing

    ^.^|bool

    |If false, users will not get the pairing dialog, although existing pairings will still work.

    <.^|allowSmartCard

    ^.^|bool

    |If false, the SmartCard is disabled for logins, authorizations, and screensaver unlocking. It is still allowed for other functions, such as signing emails and web access. A restart is required for a change of setting to take effect.

    <.^|checkCertificateTrust

    ^.^|int

    a|Valid values are 0-3:

    - 0: certificate trust check is turned off

    - 1: certificate trust check is turned on. Standard validity check is being performed but this does not include additional revocation checks.

    - 2: certificate trust check is turned on, and a soft revocation check is performed. Until the certificate is explicitly rejected by CRL/OCSP, it is considered valid. This implies that unavailable/unreachable CRL/OCSP allows this check to succeed.

    - 3: certificate trust check is turned on, plus a hard revocation check is performed. Unless CRL/OCSP explicitly states that "this certificate is OK", the certificate is considered invalid. This is the most secure value for this setting.

    <.^|oneCardPerUser

    ^.^|bool

    |If true, a user can pair with only one smartcard, although existing pairings will be allowed if already set up.

    <.^|enforceSmartCard

    ^.^|bool

    |If true, a user can only login or authenticate with a smartcard.

    <.^|tokenRemovalAction

    ^.^|int

    |If 1, the screen saver will automatically when the smartcard is removed.

    <.^|allowUnmappedUsers

    ^.^|int

    |If 1, allows users who are in a directory group to be exempt from smartcard-only enforcement. The group allowed for exemption is defined in /private/etc/SmartcardLogin.plist

    |===

    A custom configuration profile (com.apple.loginwindow) should be created to disable automatic login when FileVault is enabled. This ensures that authorized users boot their Macs, enter a password at the pre-boot screen (which decrypts the boot volume), and are then presented with a login window where they can authenticate with a smartcard.

    [%header,cols="2,1,7"]

    |===

    |Key

    |Type

    |Value

    <.^|DisableFDEAutoLogin

    ^.^|bool

    |If true, both Extensible Firmware Interface (EFI) login password and loginwindow PIN are required.

    |===

    NOTE: DisableFDEAutoLogin does not have to be set on Apple Silicon based macOS systems that are smartcard enforced as smartcards are available at pre-boot.

    [discrete]

    ==== Trusted Authorities

    The macOS allows users to specify which certificate authorities (CA) can be used for trust evaluation during smartcard authentication. Only CAs listed in the TrustedAuthorities section of the SmartcardLogin.plist will be evaluated as trusted. This setting only works if checkCertificateTrust is set to either 1, 2, or 3 in com.apple.security.smartcard.

    To get the SHA-256 hash in the correct format, run the following command within terminal:

    /usr/bin/openssl x509 -noout -fingerprint -sha256 -inform pem -in <issuer cert> | /usr/bin/awk -F ''='' ''{print $2}'' |  /usr/bin/sed ''s/://g''

    To configure Trusted Authorities, the SmartcardLogin.plist should be minimally configured as below:

    <?xml version="1.0" encoding="UTF-8"?>

    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">

    <plist version="1.0">

    <dict>

    <key>AttributeMapping</key>

    <dict>

    <key>fields</key>

    <array>

    <string>NT Principal Name</string>

    </array>

    <key>formatString</key>

    <string>Kerberos:$1</string>

    <key>dsAttributeString</key>

    <string>dsAttrTypeStandard:AltSecurityIdentities</string>

    </dict>

    <key>TrustedAuthorities</key>

    <array>

    <string>SHA256HASHOFCERTDOMAIN1,SHA256HASHOFCERTDOMAIN2</string>

    </array>

    </dict>

    </plist>

    [discrete]

    ==== Smartcard Enforcement Exemption

    [discrete]

    ===== Group Exemption

    Starting in macOS 10.15, enforcement on a system can be granularly configured by adding a field to /private/etc/SmartcardLogin.plist. The NotEnforcedGroup can be added to the file to list a Directory group that will not be included in smartcard enforcement. In order to activate this feature, enforceSmartCard and allowUnmappedUsers must be applied via a configuration profile (com.apple.security.smartcard).

    To configure the NotEnforcedGroup, the SmartcardLogin.plist should be minimally configured as follows:

    <?xml version="1.0" encoding="UTF-8"?>

    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">

    <plist version="1.0">

    <dict>

    <key>AttributeMapping</key>

    <dict>

    <key>fields</key>

    <array>

    <string>NT Principal Name</string>

    </array>

    <key>formatString</key>

    <string>Kerberos:$1</string>

    <key>dsAttributeString</key>

    <string>dsAttrTypeStandard:AltSecurityIdentities</string>

    </dict>

    <key>TrustedAuthorities</key>

    <array>

    <string>SHA256HASHOFCERTDOMAIN1,SHA256HASHOFCERTDOMAIN2</string>

    </array>

    <key>NotEnforcedGroup</key>

    <string>EXEMPTGROUP</key>

    </dict>

    </plist>

    Once a system is configured for the NotEnforcedGroup a user can be added to the assigned group by running the following:

    /usr/sbin/dseditgroup -o edit -a <exemptuser> -t user <notenforcegroup>

    [discrete]

    ===== User Exemption

    Alternatively, if a single user needs to be exempt for a period of time, kDSNativeAttrTypePrefix:SmartCardEnforcement can be set in the user''s Open Directory record. The following values can be set:

    0 - The system default is respected.

    1 - Smartcard enforcement is enabled.

    * 2 - Smartcard enforcement is disabled.

    NOTE: In Active Directory environments, the value of the userAccountControl attribute is respected.

    Run the following command to set the exemption when booted from macOS:

    /usr/bin/dscl . -append /Users/<username> SmartCardEnforcement 2

    Run the following command to set the exemption when booted from Recovery:

    /usr/bin/defaults write /Volumes/Macintosh\ HD/var/db/dslocal/nodes/Default/users/<username> SmartCardEnforcement -array-add 2

    NOTE: When booted to recovery on an Apple Silicon Mac, run the following after setting the exemption.

    /usr/sbin/diskutil apfs updatePreboot /Volumes/Macintosh\ HD

    [discrete]

    ===== Temporary Exemption

    On an Apple Silicon Mac, if a temporary exemption is needed, security filevault skip-sc-enforcement will disable smartcard enforcement on next boot only.

    Run the following command to set the temporary exemption when booted from Recovery:

    /usr/bin/security filevault skip-sc-enforcement <data volume UUID> set

    To obtain the data volume UUID run the following:

    /usr/sbin/diskutil apfs listGroups | /usr/bin/awk -F: ''/ Data/ { getline; gsub(/ /,""); print $2}''

    [discrete]

    ==== Pluggable Authentication Module (PAM)

    Terminal sessions in macOS can be configured for smartcard enforcement by modifying the PAM modules for sudo, su, and login.

    /etc/pam.d/sudo

    # sudo: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        required      pamopendirectory.so

    auth        required      pamdeny.so

    account     required      pampermit.so

    password    required      pamdeny.so

    session     required      pampermit.so

    /etc/pam.d/su

    # su: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        required      pamrootok.so

    auth        required      pamgroup.so nowarn group=admin,wheel ruser rootonly failsafe

    account     required      pampermit.so

    account     required      pamopendirectory.so nocheckshell

    password    required      pamopendirectory.so

    session     required      pamlaunchd.so

    /etc/pam.d/login

    # login: auth account password session

    auth        sufficient    pamsmartcard.so

    auth        optional      pamkrb5.so usekcminit

    auth        optional      pamntlm.so tryfirstpass

    auth        optional      pammount.so tryfirstpass

    auth        required      pamopendirectory.so tryfirstpass

    auth        required      pamdeny.so

    account     required      pamnologin.so

    account     required      pamopendirectory.so

    password    required      pamopendirectory.so

    session     required      pamlaunchd.so

    session     required      pamuwtmp.so

    session     optional      pammount.so

    [discrete]

    ==== Screen Sharing and Screen Recording

    macOS will disable support for TouchID, Watch, or Smartcard authentication when being watched or recorded. This can cause certain portions of the system to not recognize your smartcard.

    In Unified Logging you''ll notice an entry such as

    2022-07-14 16:45:46.880038-0400 0x2F97 Info 0xC8D2 1600 SecurityAgent: (SecurityAgent) [com.apple.Authorization:SecurityAgent] Screen is being watched, no Touch ID, Watch or SmartCard support is allowed

    This can be remediated by writing the preference domain com.apple.authorization with the key ignoreARD.

    defaults write com.apple.Authorization ignoreARD -bool true

    Or applied system wide with a configuration profile named com.apple.security.authorization.mobileconfig in the project''s includes folder.

    <key>PayloadType</key>

    <string>com.apple.security.authorization</string>

    <key>ignoreArd</key>

    <true/>'
  resolution: ''
  query: SELECT 1; FROM file WHERE (path LIKE \'/var/audit/%\' OR path LIKE \'/etc/security/%\') AND extended_attributes LIKE \'%com.apple.acl%\';
  purpose: Informational
  tags:
  - compliance
  - macOS_Security_Compliance
  - cmmc_lvl1
  contributors: macos_security_compliance_project
---
